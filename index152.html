<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∏–ø–æ–≥—Ä–∞—Ñ—Å–∫–∏–π –ú–∞–≥–Ω–∞—Ç</title>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.9/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.9/plugin/duration.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.9/plugin/relativeTime.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
    <style>
        /* === –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò === */
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #e67e22;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --text: #ecf0f1;
            --light: #7f8c8d;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-text-size-adjust: 100%;
        }

        body {
            font-family: Arial, sans-serif;
            background: var(--primary);
            color: var(--text);
            line-height: 1.4;
            overflow-x: hidden;
            padding: 0;
            margin: 0;
            font-size: 14px;
        }

        /* === –ö–û–ú–ü–ê–ö–¢–ù–ê–Ø –®–ê–ü–ö–ê === */
        .compact-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--secondary);
            padding: 5px;
            z-index: 1000;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 3px;
            border-bottom: 2px solid var(--accent);
        }

        .compact-resource {
            background: rgba(255,255,255,0.1);
            padding: 4px 6px;
            border-radius: 4px;
            text-align: center;
            font-size: 11px;
        }

        .resource-value {
            font-weight: bold;
            font-size: 12px;
        }

        /* === –ü–ê–ù–ï–õ–¨ –ü–û–ö–ê–ó–ê–¢–ï–õ–ï–ô === */
        .indicators-panel {
            position: fixed;
            top: 55px;
            left: 0;
            right: 0;
            background: var(--primary);
            padding: 5px;
            z-index: 999;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 3px;
            border-bottom: 1px solid var(--secondary);
        }

        .indicator {
            background: rgba(52, 73, 94, 0.7);
            padding: 4px 6px;
            border-radius: 4px;
            text-align: center;
            font-size: 11px;
            cursor: pointer;
        }

        /* === –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø === */
        .controls-panel {
            position: fixed;
            top: 95px;
            left: 0;
            right: 0;
            background: var(--secondary);
            padding: 5px;
            z-index: 998;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 3px;
            border-bottom: 1px solid var(--accent);
        }

        .control-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 6px 4px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            white-space: nowrap;
        }

        /* === –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ === */
        .main-content {
            margin-top: 130px;
            padding: 5px;
            padding-bottom: 60px;
        }

        /* === –ü–†–û–ò–ó–í–û–î–°–¢–í–ï–ù–ù–ê–Ø –õ–ò–ù–ò–Ø === */
        .production-line {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
            margin-bottom: 10px;
            background: rgba(52, 73, 94, 0.5);
            padding: 8px 3px;
            border-radius: 6px;
        }

        .production-stage {
            background: var(--secondary);
            border-radius: 4px;
            padding: 6px 3px;
            text-align: center;
            border: 1px solid transparent;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .stage-active {
            border-color: var(--accent);
        }

        .stage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .stage-icon {
            font-size: 16px;
        }

        .stage-queue {
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }

        .stage-name {
            font-size: 9px;
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .employee-slot {
            width: 20px;
            height: 20px;
            margin: 0 auto;
            border: 1px dashed var(--light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
        }

        .has-employee {
            border-color: var(--success);
            background: rgba(39, 174, 96, 0.2);
        }

        /* === –û–ë–õ–ê–°–¢–¨ –ó–ê–ö–ê–ó–û–í === */
        .orders-section {
            background: rgba(52, 73, 94, 0.5);
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 10px;
        }

        .orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 5px;
        }

        .order-card {
            background: var(--secondary);
            padding: 6px;
            border-radius: 4px;
            border-left: 2px solid var(--accent);
            cursor: pointer;
        }

        .order-selected {
            background: rgba(230, 126, 34, 0.3);
        }

        /* === –ö–ê–õ–ï–ù–î–ê–†–¨ –ò –í–†–ï–ú–Ø === */
        .time-section {
            background: rgba(52, 73, 94, 0.5);
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 10px;
            text-align: center;
        }

        /* === –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê === */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            padding: 10px;
            overflow-y: auto;
        }

        .modal-content {
            background: var(--secondary);
            border-radius: 8px;
            padding: 15px;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text);
            font-size: 20px;
            cursor: pointer;
        }

        /* === –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø === */
        .notification {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            z-index: 3000;
            display: none;
            font-size: 12px;
        }

        /* === –ü–†–û–ì–†–ï–°–° –ë–ê–†–´ === */
        .progress-container {
            background: var(--primary);
            height: 6px;
            border-radius: 3px;
            margin: 5px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--accent);
            transition: width 0.3s;
        }

        /* === –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ === */
        @media (min-width: 768px) {
            body {
                font-size: 16px;
            }
            
            .compact-resource, .indicator, .control-btn {
                font-size: 12px;
                padding: 6px 8px;
            }
            
            .production-stage {
                min-height: 70px;
                padding: 8px 4px;
            }
            
            .stage-name {
                font-size: 10px;
            }
        }

        @media (max-width: 320px) {
            .compact-header {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .indicators-panel, .controls-panel {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .production-line {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* === –¢–ê–ë–õ–ò–¶–´ === */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 12px;
        }

        .data-table th, .data-table td {
            border: 1px solid var(--light);
            padding: 6px;
            text-align: center;
        }

        .data-table th {
            background: var(--primary);
        }

        /* === –ö–ù–û–ü–ö–ò –° –ò–ö–û–ù–ö–ê–ú–ò === */
        .icon-btn {
            background: none;
            border: none;
            color: var(--text);
            cursor: pointer;
            padding: 4px;
            font-size: 16px;
        }

        .level-display {
            background: linear-gradient(90deg, var(--accent) 0%, var(--warning) 100%);
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- –ö–û–ú–ü–ê–ö–¢–ù–ê–Ø –®–ê–ü–ö–ê –° –†–ï–°–£–†–°–ê–ú–ò -->
    <div class="compact-header">
        <div class="compact-resource">
            <div>‚≠ê RATING</div>
            <div class="resource-value" id="rating">1</div>
        </div>
        <div class="compact-resource">
            <div>üí∞ BYN</div>
            <div class="resource-value" id="money">2,000</div>
        </div>
        <div class="compact-resource">
            <div>üèÉ DRIVE</div>
            <div class="resource-value" id="drive">80/80</div>
        </div>
        <div class="compact-resource">
            <div>üî• ZEAL</div>
            <div class="resource-value" id="zeal">0</div>
        </div>
    </div>

    <!-- –ü–ê–ù–ï–õ–¨ –ü–û–ö–ê–ó–ê–¢–ï–õ–ï–ô -->
    <div class="indicators-panel">
        <div class="indicator" onclick="game.showModal('level-modal')">
            <div>üìä –£—Ä–æ–≤–µ–Ω—å</div>
            <div class="resource-value" id="level">1</div>
        </div>
        <div class="indicator" onclick="game.showModal('employees-modal')">
            <div>üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</div>
            <div class="resource-value" id="employees">0/1</div>
        </div>
        <div class="indicator" onclick="game.showModal('advertising-modal')">
            <div>üì¢ –†–µ–∫–ª–∞–º–∞</div>
            <div class="resource-value" id="active-ads">0</div>
        </div>
        <div class="indicator" onclick="game.showModal('bonus-modal')">
            <div>üéØ –ë–æ–Ω—É—Å—ã</div>
            <div class="resource-value" id="streak">0</div>
        </div>
    </div>

    <!-- –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
    <div class="controls-panel">
        <button class="control-btn" onclick="game.nextDay()">üìÖ –°–ª–µ–¥. –¥–µ–Ω—å</button>
        <button class="control-btn" onclick="game.toggleAutoDay()">‚ö° –ê–≤—Ç–æ-–¥–µ–Ω—å</button>
        <button class="control-btn" onclick="game.showModal('zeal-modal')">üöÄ ZEAL</button>
        <button class="control-btn" onclick="game.corporateEvent()">üéâ –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤</button>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
    <div class="main-content">
        <!-- –ö–ê–õ–ï–ù–î–ê–†–¨ –ò –í–†–ï–ú–Ø -->
        <div class="time-section">
            <div id="current-date">1 —Å–µ–Ω—Ç—è–±—Ä—è 2025</div>
            <div id="game-time">08:00</div>
            <div class="progress-container">
                <div id="day-progress" class="progress-bar" style="width: 0%"></div>
            </div>
        </div>

        <!-- –ü–†–û–ò–ó–í–û–î–°–¢–í–ï–ù–ù–ê–Ø –õ–ò–ù–ò–Ø -->
        <div class="production-line" id="production-line">
            <!-- –≠—Ç–∞–ø—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>

        <!-- –î–û–°–¢–£–ü–ù–´–ï –ó–ê–ö–ê–ó–´ -->
        <div class="orders-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <h3>üì¶ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h3>
                <div class="level-display">–£—Ä. <span id="current-level">1</span> | <span id="level-progress">0%</span></div>
            </div>
            <div class="orders-grid" id="available-orders">
                <!-- –ó–∞–∫–∞–∑—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>

        <!-- –ê–ö–¢–ò–í–ù–´–ï –ó–ê–ö–ê–ó–´ -->
        <div class="orders-section">
            <h3 style="margin-bottom: 8px;">üéØ –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h3>
            <div id="active-orders-list">
                <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –£–†–û–í–ù–ï–ô -->
    <div id="level-modal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="game.hideModal('level-modal')">√ó</button>
            <h2 style="margin-bottom: 15px; text-align: center;">üìä –£—Ä–æ–≤–µ–Ω—å –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å</h2>
            
            <div style="background: var(--primary); padding: 10px; border-radius: 6px; margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å:</span>
                    <span id="modal-level">1</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>–†–µ–π—Ç–∏–Ω–≥ –¥–æ —Å–ª–µ–¥. —É—Ä–æ–≤–Ω—è:</span>
                    <span id="rating-to-next">100</span>
                </div>
                <div class="progress-container">
                    <div id="level-progress-bar" class="progress-bar" style="width: 0%"></div>
                </div>
            </div>

            <h3 style="margin-bottom: 10px;">–ë–æ–Ω—É—Å—ã —É—Ä–æ–≤–Ω—è:</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>–£—Ä–æ–≤–µ–Ω—å</th>
                        <th>–ú–∞–∫—Å. —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</th>
                        <th>–ë–æ–Ω—É—Å —Ä–µ–π—Ç–∏–Ω–≥–∞</th>
                    </tr>
                </thead>
                <tbody id="level-table">
                    <!-- –î–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–µ–π -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û ZEAL -->
    <div id="zeal-modal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="game.hideModal('zeal-modal')">√ó</button>
            <h2 style="margin-bottom: 15px; text-align: center;">üöÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ZEAL</h2>
            
            <div style="background: var(--primary); padding: 10px; border-radius: 6px; margin-bottom: 15px;">
                <div style="text-align: center; margin-bottom: 10px;">
                    <div>–¢–µ–∫—É—â–∏–π ZEAL: <strong id="modal-zeal">0</strong></div>
                    <div>–¢–µ–∫—É—â–∏–π REST: <strong id="modal-rest">100</strong></div>
                </div>
                
                <button class="control-btn" onclick="game.exchangeRestToZeal()" style="width: 100%; margin-bottom: 8px;">
                    üîÑ –û–±–º–µ–Ω—è—Ç—å 10 REST ‚Üí 1 ZEAL
                </button>
                <button class="control-btn" onclick="game.activateZeal()" style="width: 100%; background: var(--warning);">
                    üöÄ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å ZEAL (–±–æ–Ω—É—Å: +<span id="zeal-bonus">0</span> DRIVE)
                </button>
            </div>

            <div style="background: var(--primary); padding: 10px; border-radius: 6px;">
                <h4 style="margin-bottom: 8px;">–≠—Ñ—Ñ–µ–∫—Ç ZEAL:</h4>
                <div style="font-size: 12px;">
                    ‚Ä¢ –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π DRIVE –Ω–∞ (—É—Ä–æ–≤–µ–Ω—å √ó 2)<br>
                    ‚Ä¢ –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ –∫–æ–Ω—Ü–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è<br>
                    ‚Ä¢ –ú–æ–∂–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
                </div>
            </div>
        </div>
    </div>

    <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø -->
    <div class="notification" id="notification"></div>

    <script>
        // === –û–°–ù–û–í–ù–û–ô –û–ë–™–ï–ö–¢ –ò–ì–†–´ ===
        const game = {
            // –ò–ì–†–û–í–´–ï –î–ê–ù–ù–´–ï
            state: {
                money: 2000,
                rating: 1,
                drive: 80,
                maxDrive: 80,
                zeal: 0,
                rest: 100,
                currentDay: 1,
                gameDate: new Date('2025-09-01'),
                employees: [],
                activeOrders: [],
                orderQueue: Array(7).fill().map(() => []),
                employeePositions: Array(7).fill(null),
                activeAds: [],
                level: 1,
                streak: 0,
                autoDay: false,
                autoInterval: null,
                timeInterval: null,
                currentHour: 8,
                upgrades: {
                    efficiency: 1,
                    driveCost: 1
                }
            },

            // –î–ê–ù–ù–´–ï –£–†–û–í–ù–ï–ô
            levels: [
                { level: 1, maxEmployees: 1, ratingBonus: 0 },
                { level: 10, maxEmployees: 10, ratingBonus: 10 },
                { level: 15, maxEmployees: 15, ratingBonus: 20 },
                { level: 20, maxEmployees: 20, ratingBonus: 40 },
                { level: 30, maxEmployees: 30, ratingBonus: 80 },
                { level: 40, maxEmployees: 80, ratingBonus: 60 },
                { level: 50, maxEmployees: 100, ratingBonus: 120 },
                { level: 55, maxEmployees: 110, ratingBonus: 240 },
                { level: 60, maxEmployees: 180, ratingBonus: 480 },
                { level: 75, maxEmployees: 300, ratingBonus: 960 },
                { level: 80, maxEmployees: 400, ratingBonus: 1920 }
            ],

            // –ü–†–û–ò–ó–í–û–î–°–¢–í–ï–ù–ù–´–ï –≠–¢–ê–ü–´
            productionStages: [
                { name: 'ORDER', icon: 'üìã', cost: 1 },
                { name: 'LAYOUT', icon: 'üé®', cost: 1 },
                { name: 'PREPRESS', icon: 'üñ®Ô∏è', cost: 1 },
                { name: 'PRESS', icon: 'üì†', cost: 1 },
                { name: 'POST_PRESS', icon: '‚úÇÔ∏è', cost: 1 },
                { name: 'PRODUCT', icon: 'üì¶', cost: 1 },
                { name: 'SHIPMENT', icon: 'üöö', cost: 1 }
            ],

            // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´
            async init() {
                dayjs.extend(window.dayjs_plugin_duration);
                dayjs.extend(window.dayjs_plugin_relativeTime);
                
                await this.loadGame();
                this.createProductionLine();
                this.generateOrders();
                this.startTimeSystem();
                this.updateUI();
                
                if (this.state.autoDay) {
                    this.toggleAutoDay();
                }

                // –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏
                setInterval(() => this.processEmployeeWork(), 500);
            },

            // –°–û–ó–î–ê–ù–ò–ï –ü–†–û–ò–ó–í–û–î–°–¢–í–ï–ù–ù–û–ô –õ–ò–ù–ò–ò
            createProductionLine() {
                const container = document.getElementById('production-line');
                container.innerHTML = '';
                
                this.productionStages.forEach((stage, index) => {
                    const stageElement = document.createElement('div');
                    stageElement.className = 'production-stage';
                    stageElement.innerHTML = `
                        <div class="stage-header">
                            <div class="stage-icon">${stage.icon}</div>
                            <div class="stage-queue" id="queue-${index}">0</div>
                        </div>
                        <div class="stage-name">${stage.name}</div>
                        <div class="employee-slot" onclick="game.assignEmployee(${index})" id="employee-slot-${index}">
                            ${this.state.employeePositions[index] ? 'üë§' : '+'}
                        </div>
                    `;
                    container.appendChild(stageElement);
                });
            },

            // –°–ò–°–¢–ï–ú–ê –í–†–ï–ú–ï–ù–ò
            startTimeSystem() {
                this.state.timeInterval = setInterval(() => {
                    this.state.currentHour++;
                    if (this.state.currentHour > 16) { // 8 —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤
                        this.state.currentHour = 8;
                    }
                    this.updateTimeUI();
                    
                    // –†–∞—Å—Ö–æ–¥ DRIVE –∫–∞–∂–¥—ã–π —á–∞—Å
                    if (this.state.currentHour === 9 || this.state.currentHour === 11 || 
                        this.state.currentHour === 13 || this.state.currentHour === 15) {
                        this.consumeDrive();
                    }
                }, 15000); // 15 —Å–µ–∫—É–Ω–¥ = 1 –∏–≥—Ä–æ–≤–æ–π —á–∞—Å
            },

            // –ü–û–¢–†–ï–ë–õ–ï–ù–ò–ï DRIVE
            consumeDrive() {
                const driveCost = this.state.employees.length + 1; // –ò–≥—Ä–æ–∫ + —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
                this.state.drive = Math.max(0, this.state.drive - driveCost);
                this.updateUI();
                
                if (this.state.drive === 0) {
                    this.showNotification('‚ö° DRIVE –∑–∞–∫–æ–Ω—á–∏–ª—Å—è! –ñ–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è.');
                }
            },

            // –û–ë–†–ê–ë–û–¢–ö–ê –†–ê–ë–û–¢–´ –°–û–¢–†–£–î–ù–ò–ö–û–í
            processEmployeeWork() {
                this.state.employeePositions.forEach((employee, stageIndex) => {
                    if (employee && this.state.orderQueue[stageIndex].length > 0) {
                        // –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–¥–∏–Ω –∑–∞–∫–∞–∑
                        const orderId = this.state.orderQueue[stageIndex][0];
                        this.processOrderStage(orderId, stageIndex);
                    }
                });
            },

            // –í–´–ë–û–† –ó–ê–ö–ê–ó–ê
            selectOrder(order) {
                if (this.state.drive < 1) {
                    this.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ DRIVE!');
                    return;
                }

                this.state.activeOrders.push({
                    ...order,
                    currentStage: 0,
                    progress: 0
                });

                this.state.orderQueue[0].push(order.id);
                this.state.drive -= 1;
                this.updateUI();
                this.showNotification(`‚úÖ –í–∑—è—Ç –∑–∞–∫–∞–∑ –∑–∞ ${order.reward} BYN`);
            },

            // –û–ë–†–ê–ë–û–¢–ö–ê –≠–¢–ê–ü–ê –ó–ê–ö–ê–ó–ê
            processOrderStage(orderId, stageIndex) {
                const order = this.state.activeOrders.find(o => o.id === orderId);
                if (!order) return;

                // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∑–∞–∫–∞–∑ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø
                const currentQueueIndex = this.state.orderQueue[stageIndex].indexOf(orderId);
                if (currentQueueIndex > -1) {
                    this.state.orderQueue[stageIndex].splice(currentQueueIndex, 1);
                }

                if (stageIndex < 6) {
                    this.state.orderQueue[stageIndex + 1].push(orderId);
                    order.currentStage = stageIndex + 1;
                } else {
                    // –ó–∞–∫–∞–∑ –∑–∞–≤–µ—Ä—à–µ–Ω
                    this.completeOrder(orderId);
                }

                this.updateUI();
            },

            // –ó–ê–í–ï–†–®–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê
            completeOrder(orderId) {
                const orderIndex = this.state.activeOrders.findIndex(o => o.id === orderId);
                if (orderIndex === -1) return;

                const order = this.state.activeOrders[orderIndex];
                this.state.money += order.reward;
                this.state.rating += this.calculateRating(order.reward);
                this.state.streak += 1;

                // –ë–æ–Ω—É—Å –∑–∞ —Å–µ—Ä–∏—é
                if (this.state.streak % 10 === 0) {
                    const bonus = Math.floor(this.state.streak / 10) * 50;
                    this.state.rating += bonus;
                    this.showNotification(`üéØ –ë–æ–Ω—É—Å –∑–∞ —Å–µ—Ä–∏—é! +${bonus} —Ä–µ–π—Ç–∏–Ω–≥–∞`);
                }

                this.state.activeOrders.splice(orderIndex, 1);
                this.checkLevelUp();
                this.updateUI();
                this.showNotification(`‚úÖ –ó–∞–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω! +${order.reward} BYN`);
            },

            // –†–ê–°–ß–ï–¢ –†–ï–ô–¢–ò–ù–ì–ê
            calculateRating(reward) {
                const base = 1;
                const bonus = reward > 1000 ? 1 : 0;
                const restMultiplier = this.state.rest / 100;
                const streakBonus = this.state.streak > 20 ? 0.5 : this.state.streak > 10 ? 0.25 : 0;
                return Math.floor((base + bonus + streakBonus) * restMultiplier);
            },

            // –ü–†–û–í–ï–†–ö–ê –ü–û–í–´–®–ï–ù–ò–Ø –£–†–û–í–ù–Ø
            checkLevelUp() {
                const nextLevel = this.levels.find(level => level.level > this.state.level);
                if (nextLevel && this.state.rating >= nextLevel.ratingBonus) {
                    this.state.level = nextLevel.level;
                    this.showNotification(`üéâ –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å! –î–æ—Å—Ç—É–ø–Ω–æ ${nextLevel.maxEmployees} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`);
                }
            },

            // –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï –°–û–¢–†–£–î–ù–ò–ö–ê
            assignEmployee(stageIndex) {
                if (this.state.employees.length === 0) {
                    this.showModal('employees-modal');
                    return;
                }

                if (this.state.employeePositions[stageIndex]) {
                    // –£–±–∏—Ä–∞–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                    this.state.employeePositions[stageIndex] = null;
                } else {
                    // –ù–∞–∑–Ω–∞—á–∞–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                    const availableEmployee = this.state.employees.find((_, index) => 
                        !this.state.employeePositions.includes(index)
                    );
                    if (availableEmployee) {
                        this.state.employeePositions[stageIndex] = this.state.employees.indexOf(availableEmployee);
                    }
                }
                this.updateUI();
            },

            // –ù–ê–ô–ú –°–û–¢–†–£–î–ù–ò–ö–ê
            hireEmployee() {
                const maxEmployees = this.getMaxEmployees();
                
                if (this.state.employees.length >= maxEmployees) {
                    this.showNotification(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç: ${maxEmployees} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`);
                    return;
                }

                if (this.state.money < 1500) {
                    this.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ BYN!');
                    return;
                }

                this.state.employees.push({ type: 'basic' });
                this.state.money -= 1500;
                this.updateUI();
                this.showNotification('üë∑ –ù–æ–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–∞–Ω—è—Ç!');
            },

            // –°–õ–ï–î–£–Æ–©–ò–ô –î–ï–ù–¨
            nextDay() {
                // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ DRIVE
                this.state.drive = this.state.maxDrive + (this.state.employees.length * 80);
                
                // –í—ã–ø–ª–∞—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç
                this.paySalaries();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—Ç—ã
                this.state.gameDate.setDate(this.state.gameDate.getDate() + 1);
                this.state.currentDay++;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º—ã
                this.updateAds();
                
                this.updateUI();
                this.showNotification(`üìÖ –ù–æ–≤—ã–π –¥–µ–Ω—å! DRIVE –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω`);
            },

            // –í–´–ü–õ–ê–¢–ê –ó–ê–†–ü–õ–ê–¢
            paySalaries() {
                const salary = this.state.employees.length * 1500;
                this.state.money -= salary;
                
                if (salary > 0) {
                    this.showNotification(`üí∏ –ó–∞—Ä–ø–ª–∞—Ç–∞: ${salary} BYN`);
                }
                
                if (this.state.money < 0) {
                    this.gameOver();
                }
            },

            // –û–ë–ú–ï–ù REST –ù–ê ZEAL
            exchangeRestToZeal() {
                if (this.state.rest < 10) {
                    this.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ REST!');
                    return;
                }

                this.state.rest -= 10;
                this.state.zeal += 1;
                this.updateUI();
                this.showNotification('üîÑ –û–±–º–µ–Ω—è–Ω–æ 10 REST ‚Üí 1 ZEAL');
            },

            // –ê–ö–¢–ò–í–ê–¶–ò–Ø ZEAL
            activateZeal() {
                if (this.state.zeal < 1) {
                    this.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ZEAL!');
                    return;
                }

                const bonus = this.state.level * 2;
                this.state.zeal -= 1;
                this.state.drive += bonus;
                this.state.maxDrive += bonus;
                this.updateUI();
                this.showNotification(`üöÄ ZEAL –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! +${bonus} DRIVE`);
            },

            // –ö–û–†–ü–û–†–ê–¢–ò–í
            corporateEvent() {
                const cost = 1000;
                if (this.state.money < cost) {
                    this.showNotification(`–ù—É–∂–Ω–æ ${cost} BYN –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–∞`);
                    return;
                }

                this.state.money -= cost;
                this.state.rest = Math.min(100, this.state.rest + 30);
                this.updateUI();
                this.showNotification('üéâ –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤! REST +30');
            },

            // –ê–í–¢–û-–†–ï–ñ–ò–ú
            toggleAutoDay() {
                this.state.autoDay = !this.state.autoDay;
                
                if (this.state.autoDay) {
                    this.state.autoInterval = setInterval(() => {
                        this.nextDay();
                    }, 30000); // 30 —Å–µ–∫—É–Ω–¥
                } else {
                    clearInterval(this.state.autoInterval);
                }
                this.updateUI();
            },

            // –ü–û–õ–£–ß–ï–ù–ò–ï –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ì–û –ö–û–õ–ò–ß–ï–°–¢–í–ê –°–û–¢–†–£–î–ù–ò–ö–û–í
            getMaxEmployees() {
                const levelData = this.levels.find(l => l.level === this.state.level);
                return levelData ? levelData.maxEmployees : 1;
            },

            // –ì–ï–ù–ï–†–ê–¶–ò–Ø –ó–ê–ö–ê–ó–û–í
            generateOrders() {
                const orders = [];
                const minOrder = this.getMinOrder();
                const maxOrder = this.getMaxOrder();
                
                for (let i = 0; i < 4; i++) {
                    const reward = Math.floor(Math.random() * (maxOrder - minOrder + 1)) + minOrder;
                    const duration = 1 + Math.floor(Math.random() * 3);
                    orders.push({
                        id: Date.now() + i,
                        reward: reward,
                        duration: duration
                    });
                }
                
                this.availableOrders = orders;
                this.updateOrdersList();
            },

            // –†–ê–°–ß–ï–¢ –ú–ò–ù–ò–ú–ê–õ–¨–ù–û–ì–û –ó–ê–ö–ê–ó–ê
            getMinOrder() {
                const rating = this.state.rating;
                if (rating >= 5000) return 5000;
                if (rating >= 4000) return 2000;
                if (rating >= 3500) return 1500;
                if (rating >= 3000) return 1000;
                if (rating >= 2500) return 750;
                if (rating >= 2000) return 500;
                if (rating >= 1750) return 300;
                if (rating >= 1500) return 250;
                if (rating >= 1250) return 200;
                if (rating >= 1000) return 150;
                if (rating >= 500) return 125;
                if (rating >= 250) return 100;
                if (rating >= 100) return 75;
                return 50;
            },

            // –†–ê–°–ß–ï–¢ –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ì–û –ó–ê–ö–ê–ó–ê
            getMaxOrder() {
                const rating = this.state.rating;
                if (rating >= 5000) return 250000;
                if (rating >= 4000) return 60000;
                if (rating >= 3500) return 37500;
                if (rating >= 3000) return 20000;
                if (rating >= 2500) return 15000;
                if (rating >= 2000) return 10000;
                if (rating >= 1750) return 6000;
                if (rating >= 1500) return 5000;
                if (rating >= 1250) return 4000;
                if (rating >= 1000) return 3000;
                if (rating >= 500) return 2500;
                if (rating >= 250) return 2000;
                if (rating >= 100) return 1500;
                return 1000;
            },

            // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê
            updateUI() {
                // –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
                document.getElementById('rating').textContent = Math.floor(this.state.rating);
                document.getElementById('money').textContent = this.state.money.toLocaleString();
                document.getElementById('drive').textContent = `${this.state.drive}/${this.state.maxDrive}`;
                document.getElementById('zeal').textContent = this.state.zeal;
                
                // –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏
                document.getElementById('level').textContent = this.state.level;
                document.getElementById('employees').textContent = `${this.state.employees.length}/${this.getMaxEmployees()}`;
                document.getElementById('active-ads').textContent = this.state.activeAds.length;
                document.getElementById('streak').textContent = this.state.streak;
                
                // –û—á–µ—Ä–µ–¥–∏ —ç—Ç–∞–ø–æ–≤
                this.state.orderQueue.forEach((queue, index) => {
                    document.getElementById(`queue-${index}`).textContent = queue.length;
                });
                
                // –°–ª–æ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
                this.state.employeePositions.forEach((employee, index) => {
                    const slot = document.getElementById(`employee-slot-${index}`);
                    slot.textContent = employee !== null ? 'üë§' : '+';
                    slot.className = `employee-slot ${employee !== null ? 'has-employee' : ''}`;
                });
                
                this.updateOrdersList();
                this.updateActiveOrders();
                this.updateTimeUI();
                this.updateLevelInfo();
            },

            // –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–ü–ò–°–ö–ê –ó–ê–ö–ê–ó–û–í
            updateOrdersList() {
                const container = document.getElementById('available-orders');
                container.innerHTML = '';
                
                this.availableOrders.forEach(order => {
                    const orderElement = document.createElement('div');
                    orderElement.className = 'order-card';
                    orderElement.innerHTML = `
                        <div style="font-weight: bold; margin-bottom: 3px;">${order.reward.toLocaleString()} BYN</div>
                        <div style="font-size: 10px; color: var(--light);">${order.duration} –¥–Ω.</div>
                    `;
                    orderElement.onclick = () => this.selectOrder(order);
                    container.appendChild(orderElement);
                });
            },

            // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ê–ö–¢–ò–í–ù–´–• –ó–ê–ö–ê–ó–û–í
            updateActiveOrders() {
                const container = document.getElementById('active-orders-list');
                container.innerHTML = '';
                
                this.state.activeOrders.forEach(order => {
                    const orderElement = document.createElement('div');
                    orderElement.className = 'order-card';
                    orderElement.innerHTML = `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span style="font-weight: bold;">${order.reward.toLocaleString()} BYN</span>
                            <span style="font-size: 10px;">–≠—Ç–∞–ø: ${order.currentStage + 1}/7</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: ${(order.currentStage / 6) * 100}%"></div>
                        </div>
                    `;
                    container.appendChild(orderElement);
                });
            },

            // –û–ë–ù–û–í–õ–ï–ù–ò–ï –í–†–ï–ú–ï–ù–ò
            updateTimeUI() {
                const dateStr = this.state.gameDate.toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
                document.getElementById('current-date').textContent = dateStr;
                
                const timeStr = `${this.state.currentHour.toString().padStart(2, '0')}:00`;
                document.getElementById('game-time').textContent = timeStr;
                
                const progress = ((this.state.currentHour - 8) / 8) * 100;
                document.getElementById('day-progress').style.width = `${progress}%`;
            },

            // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–§–û–†–ú–ê–¶–ò–ò –û –£–†–û–í–ù–ï
            updateLevelInfo() {
                const nextLevel = this.levels.find(level => level.level > this.state.level);
                const currentLevel = this.levels.find(level => level.level === this.state.level);
                
                if (nextLevel) {
                    const progress = (this.state.rating / nextLevel.ratingBonus) * 100;
                    document.getElementById('level-progress').textContent = `${Math.min(100, Math.floor(progress))}%`;
                    document.getElementById('level-progress-bar').style.width = `${Math.min(100, progress)}%`;
                }
                
                document.getElementById('current-level').textContent = this.state.level;
            },

            // –û–ë–ù–û–í–õ–ï–ù–ò–ï –†–ï–ö–õ–ê–ú–´
            updateAds() {
                // –£–¥–∞–ª—è–µ–º –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—É—é —Ä–µ–∫–ª–∞–º—É
                this.state.activeAds = this.state.activeAds.filter(ad => 
                    ad.endDate > this.state.gameDate
                );
            },

            // –ü–û–ö–ê–ó –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
            showNotification(message) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            },

            // –ü–û–ö–ê–ó –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê
            showModal(modalId) {
                document.getElementById(modalId).style.display = 'block';
            },

            // –°–ö–†–´–¢–ò–ï –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê
            hideModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
            },

            // –ö–û–ù–ï–¶ –ò–ì–†–´
            gameOver() {
                this.showNotification('üíÄ –ë–ê–ù–ö–†–û–¢–°–¢–í–û! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.');
                this.resetGame();
            },

            // –°–ë–†–û–° –ò–ì–†–´
            resetGame() {
                this.state = {
                    money: 2000,
                    rating: 1,
                    drive: 80,
                    maxDrive: 80,
                    zeal: 0,
                    rest: 100,
                    currentDay: 1,
                    gameDate: new Date('2025-09-01'),
                    employees: [],
                    activeOrders: [],
                    orderQueue: Array(7).fill().map(() => []),
                    employeePositions: Array(7).fill(null),
                    activeAds: [],
                    level: 1,
                    streak: 0,
                    autoDay: false,
                    currentHour: 8,
                    upgrades: {
                        efficiency: 1,
                        driveCost: 1
                    }
                };
                this.init();
            },

            // –°–û–•–†–ê–ù–ï–ù–ò–ï –ò–ì–†–´
            async saveGame() {
                try {
                    await localforage.setItem('typographyMagnate', this.state);
                } catch (error) {
                    console.log('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                }
            },

            // –ó–ê–ì–†–£–ó–ö–ê –ò–ì–†–´
            async loadGame() {
                try {
                    const saved = await localforage.getItem('typographyMagnate');
                    if (saved) {
                        this.state = saved;
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—ä–µ–∫—Ç Date
                        this.state.gameDate = new Date(this.state.gameDate);
                    }
                } catch (error) {
                    console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                }
            }
        };

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´
        window.addEventListener('load', () => {
            game.init();
        });

        // –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï
        window.addEventListener('beforeunload', () => {
            game.saveGame();
        });
    </script>
</body>
</html>
