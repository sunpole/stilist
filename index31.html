<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>5 –≠–ª–µ–º–µ–Ω—Ç–æ–≤: –°–µ–º–µ–π–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    * {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      font-family: 'Roboto', sans-serif;
    }
    body {
      overflow: hidden;
      touch-action: manipulation;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f2 100%);
      height: 100vh;
      margin: 0;
      padding: 10px;
    }
    .game-container {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 20px);
    }
    .setup-screen, .game-screen, .result-screen {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .player-inputs {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 15px;
      overflow-y: auto;
      flex-grow: 1;
    }
    .player-input {
      display: flex;
      flex-direction: column;
    }
    .player-color {
      width: 100%;
      height: 30px;
      border-radius: 5px;
      margin-bottom: 5px;
    }
    .choices {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 15px 0;
    }
    .choice-btn {
      background: white;
      border: 2px solid #5c6bc0;
      border-radius: 12px;
      padding: 12px 5px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .choice-btn:active {
      transform: scale(0.96);
      background: #5c6bc0;
      color: white;
    }
    .choice-emoji {
      font-size: 24px;
      margin-bottom: 5px;
    }
    .current-player {
      font-size: 20px;
      font-weight: 500;
      margin: 10px 0;
      padding: 8px;
      border-radius: 8px;
      background-color: #e8eaf6;
    }
    .result-item {
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 5px;
    }
    .btn-custom {
      background: #5c6bc0;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px;
      font-weight: 500;
      margin-top: 10px;
    }
    @media (orientation: portrait) {
      .choices {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (max-width: 400px) {
      .choice-btn {
        font-size: 14px;
        padding: 8px 2px;
      }
      .choice-emoji {
        font-size: 20px;
      margin-bottom: 3px;
      }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <!-- –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div id="setupScreen" class="setup-screen">
      <h2 class="text-center mb-4">5 –≠–ª–µ–º–µ–Ω—Ç–æ–≤</h2>
      <div class="mb-3">
        <label for="playerCount" class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ (2-10):</label>
        <input type="number" id="playerCount" class="form-control" min="2" max="10" value="2">
      </div>
      <div class="player-inputs" id="playerInputs">
        <!-- –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
      <button id="startGameBtn" class="btn-custom">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã -->
    <div id="gameScreen" class="game-screen" style="display: none;">
      <div id="currentPlayerDisplay" class="current-player text-center"></div>
      <div class="choices">
        <button class="choice-btn" data-choice="–∫–∞–º–µ–Ω—å">
          <span class="choice-emoji">ü™®</span>
          –ö–∞–º–µ–Ω—å
        </button>
        <button class="choice-btn" data-choice="–Ω–æ–∂–Ω–∏—Ü—ã">
          <span class="choice-emoji">‚úÇÔ∏è</span>
          –ù–æ–∂–Ω–∏—Ü—ã
        </button>
        <button class="choice-btn" data-choice="–±—É–º–∞–≥–∞">
          <span class="choice-emoji">üìÑ</span>
          –ë—É–º–∞–≥–∞
        </button>
        <button class="choice-btn" data-choice="—Ç—Ä–∞–≤–∞">
          <span class="choice-emoji">üåø</span>
          –¢—Ä–∞–≤–∞
        </button>
        <button class="choice-btn" data-choice="—Å–æ–ª–Ω—Ü–µ">
          <span class="choice-emoji">‚òÄÔ∏è</span>
          –°–æ–ª–Ω—Ü–µ
        </button>
      </div>
      <button id="pauseBtn" class="btn-custom">–ü–∞—É–∑–∞</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div id="resultScreen" class="result-screen" style="display: none;">
      <h3 class="text-center mb-3">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—É–Ω–¥–∞</h3>
      <div id="roundResults" class="mb-3">
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
      </div>
      <button id="nextRoundBtn" class="btn-custom">–°–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥</button>
      <button id="newGameBtn" class="btn-custom mt-2">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã (–∫—Ç–æ –∫–æ–≥–æ –ø–æ–±–µ–∂–¥–∞–µ—Ç)
    const rules = {
      '–∫–∞–º–µ–Ω—å': ['–Ω–æ–∂–Ω–∏—Ü—ã', '—Ç—Ä–∞–≤–∞'],
      '–Ω–æ–∂–Ω–∏—Ü—ã': ['–±—É–º–∞–≥–∞', '—Ç—Ä–∞–≤–∞'],
      '–±—É–º–∞–≥–∞': ['–∫–∞–º–µ–Ω—å', '—Å–æ–ª–Ω—Ü–µ'],
      '—Ç—Ä–∞–≤–∞': ['–±—É–º–∞–≥–∞', '—Å–æ–ª–Ω—Ü–µ'],
      '—Å–æ–ª–Ω—Ü–µ': ['–∫–∞–º–µ–Ω—å', '–Ω–æ–∂–Ω–∏—Ü—ã']
    };

    // –¶–≤–µ—Ç–∞ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤
    const playerColors = [
      '#FF5252', '#FF4081', '#E040FB', '#7C4DFF', '#536DFE',
      '#448AFF', '#40C4FF', '#18FFFF', '#64FFDA', '#69F0AE'
    ];

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let gameState = {
      players: [],
      currentPlayerIndex: 0,
      choices: {},
      roundHistory: [],
      winners: [],
      gameActive: true
    };

    // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
    const elements = {
      setupScreen: document.getElementById('setupScreen'),
      gameScreen: document.getElementById('gameScreen'),
      resultScreen: document.getElementById('resultScreen'),
      playerCount: document.getElementById('playerCount'),
      playerInputs: document.getElementById('playerInputs'),
      startGameBtn: document.getElementById('startGameBtn'),
      currentPlayerDisplay: document.getElementById('currentPlayerDisplay'),
      choiceBtns: document.querySelectorAll('.choice-btn'),
      pauseBtn: document.getElementById('pauseBtn'),
      roundResults: document.getElementById('roundResults'),
      nextRoundBtn: document.getElementById('nextRoundBtn'),
      newGameBtn: document.getElementById('newGameBtn')
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
    function initGame() {
      elements.playerCount.addEventListener('change', updatePlayerInputs);
      elements.startGameBtn.addEventListener('click', startGame);
      elements.pauseBtn.addEventListener('click', pauseGame);
      elements.nextRoundBtn.addEventListener('click', startNextRound);
      elements.newGameBtn.addEventListener('click', newGame);
      
      elements.choiceBtns.forEach(btn => {
        btn.addEventListener('click', () => makeChoice(btn.dataset.choice));
      });

      updatePlayerInputs();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤
    function updatePlayerInputs() {
      const count = parseInt(elements.playerCount.value);
      if (count < 2) elements.playerCount.value = 2;
      if (count > 10) elements.playerCount.value = 10;
      
      const actualCount = parseInt(elements.playerCount.value);
      elements.playerInputs.innerHTML = '';
      
      for (let i = 0; i < actualCount; i++) {
        const div = document.createElement('div');
        div.className = 'player-input';
        div.innerHTML = `
          <div class="player-color" style="background-color: ${playerColors[i]}"></div>
          <input type="text" class="form-control" placeholder="–ò–≥—Ä–æ–∫ ${i+1}" maxlength="10">
        `;
        elements.playerInputs.appendChild(div);
      }
    }

    // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
    function startGame() {
      const count = parseInt(elements.playerCount.value);
      gameState.players = [];
      
      const inputs = elements.playerInputs.querySelectorAll('input');
      for (let i = 0; i < count; i++) {
        const name = inputs[i].value.trim() || `–ò–≥—Ä–æ–∫ ${i+1}`;
        gameState.players.push({
          id: i,
          name: name,
          color: playerColors[i],
          active: true
        });
      }
      
      gameState.currentPlayerIndex = 0;
      gameState.choices = {};
      gameState.winners = [];
      
      elements.setupScreen.style.display = 'none';
      elements.gameScreen.style.display = 'flex';
      updateCurrentPlayerDisplay();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
    function updateCurrentPlayerDisplay() {
      const player = gameState.players[gameState.currentPlayerIndex];
      elements.currentPlayerDisplay.textContent = player.name;
      elements.currentPlayerDisplay.style.backgroundColor = player.color + '40';
      elements.currentPlayerDisplay.style.color = player.color;
    }

    // –í—ã–±–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞
    function makeChoice(choice) {
      if (!gameState.gameActive) return;
      
      const player = gameState.players[gameState.currentPlayerIndex];
      gameState.choices[player.id] = choice;
      
      // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∞–∫—Ç–∏–≤–Ω–æ–º—É –∏–≥—Ä–æ–∫—É
      do {
        gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
      } while (!gameState.players[gameState.currentPlayerIndex].active && 
               gameState.currentPlayerIndex !== 0);
      
      // –ï—Å–ª–∏ –≤—Å–µ —Å–¥–µ–ª–∞–ª–∏ –≤—ã–±–æ—Ä - –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      if (Object.keys(gameState.choices).length === gameState.players.filter(p => p.active).length) {
        showResults();
      } else {
        updateCurrentPlayerDisplay();
      }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—É–Ω–¥–∞
    function showResults() {
      gameState.gameActive = false;
      elements.gameScreen.style.display = 'none';
      elements.resultScreen.style.display = 'flex';
      
      const activePlayers = gameState.players.filter(p => p.active);
      const results = calculateResults();
      gameState.winners = results.winners;
      
      let html = '';
      activePlayers.forEach(player => {
        const choice = gameState.choices[player.id];
        const isWinner = results.winners.some(w => w.id === player.id);
        
        html += `
          <div class="result-item" style="background-color: ${player.color}20; color: ${player.color}; 
                 ${isWinner ? 'font-weight: bold; border-left: 4px solid ' + player.color : ''}">
            ${player.name}: ${getEmoji(choice)} ${choice}
            ${isWinner ? ' (–ü–æ–±–µ–¥–∏—Ç–µ–ª—å)' : ''}
          </div>
        `;
      });
      
      if (results.isDraw) {
        html += `<div class="text-center mt-2">–ù–∏—á—å—è! –í—Å–µ –ø–æ–∫–∞–∑–∞–ª–∏ —Ä–∞–∑–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã.</div>`;
      }
      
      elements.roundResults.innerHTML = html;
      
      // –ï—Å–ª–∏ –æ–¥–∏–Ω –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –∏–ª–∏ –Ω–∏—á—å—è - –∫–Ω–æ–ø–∫–∞ "–ù–æ–≤–∞—è –∏–≥—Ä–∞"
      if (results.winners.length === 1 || results.isDraw) {
        elements.nextRoundBtn.style.display = 'none';
        elements.newGameBtn.style.display = 'block';
      } else {
        elements.nextRoundBtn.style.display = 'block';
        elements.newGameBtn.style.display = 'none';
      }
    }

    // –í—ã—á–∏—Å–ª–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—É–Ω–¥–∞
    function calculateResults() {
      const activePlayers = gameState.players.filter(p => p.active);
      const choices = activePlayers.map(p => gameState.choices[p.id]);
      const uniqueChoices = [...new Set(choices)];
      
      // –ï—Å–ª–∏ –≤—Å–µ –≤—ã–±—Ä–∞–ª–∏ —Ä–∞–∑–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã - –Ω–∏—á—å—è
      if (uniqueChoices.length === activePlayers.length) {
        return { winners: [], isDraw: true };
      }
      
      // –ù–∞—Ö–æ–¥–∏–º –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
      const winners = [];
      for (const player of activePlayers) {
        const playerChoice = gameState.choices[player.id];
        let isWinner = true;
        
        for (const otherPlayer of activePlayers) {
          if (player.id === otherPlayer.id) continue;
          
          const otherChoice = gameState.choices[otherPlayer.id];
          if (!rules[playerChoice] || !rules[playerChoice].includes(otherChoice)) {
            isWinner = false;
            break;
          }
        }
        
        if (isWinner) {
          winners.push(player);
        }
      }
      
      return { winners, isDraw: false };
    }

    // –ù–∞—á–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥ (—Ç–æ–ª—å–∫–æ —Å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º–∏)
    function startNextRound() {
      // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—Å–µ—Ö, –∫—Ä–æ–º–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
      gameState.players.forEach(player => {
        player.active = gameState.winners.some(w => w.id === player.id);
      });
      
      gameState.currentPlayerIndex = 0;
      gameState.choices = {};
      gameState.gameActive = true;
      
      // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–≤–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
      while (!gameState.players[gameState.currentPlayerIndex].active) {
        gameState.currentPlayerIndex++;
      }
      
      elements.resultScreen.style.display = 'none';
      elements.gameScreen.style.display = 'flex';
      updateCurrentPlayerDisplay();
    }

    // –ù–æ–≤–∞—è –∏–≥—Ä–∞
    function newGame() {
      elements.resultScreen.style.display = 'none';
      elements.setupScreen.style.display = 'flex';
    }

    // –ü–∞—É–∑–∞
    function pauseGame() {
      gameState.gameActive = !gameState.gameActive;
      elements.pauseBtn.textContent = gameState.gameActive ? '–ü–∞—É–∑–∞' : '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
    }

    // –ü–æ–ª—É—á–∏—Ç—å emoji –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞
    function getEmoji(choice) {
      const emojis = {
        '–∫–∞–º–µ–Ω—å': 'ü™®',
        '–Ω–æ–∂–Ω–∏—Ü—ã': '‚úÇÔ∏è',
        '–±—É–º–∞–≥–∞': 'üìÑ',
        '—Ç—Ä–∞–≤–∞': 'üåø',
        '—Å–æ–ª–Ω—Ü–µ': '‚òÄÔ∏è'
      };
      return emojis[choice] || choice;
    }

    // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
    initGame();
  </script>
</body>
</html>
