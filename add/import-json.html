<!-- modules/import-json.html -->
<style>
  .import-json {
    font-family: Arial, sans-serif;
    padding: 1rem;
    border: 1px solid #ddd;
    border-radius: 8px;
    background: #f9f9f9;
    max-width: 800px;
    margin: 0 auto;
  }
  
  .import-methods {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
  }
  
  .import-btn {
    background: #4a6fa5;
    color: white;
    border: none;
    padding: 10px;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.3s;
  }
  
  .import-btn:hover {
    background: #3a5a8f;
  }
  
  textarea {
    width: 100%;
    min-height: 200px;
    margin: 1rem 0;
    font-family: monospace;
  }
  
  .file-info {
    padding: 0.5rem;
    background: #eef;
    border-radius: 4px;
    margin-bottom: 1rem;
  }
  
  .status-bar {
    height: 6px;
    background: #e0e0e0;
    border-radius: 3px;
    margin-top: 1rem;
    overflow: hidden;
  }
  
  .status-progress {
    height: 100%;
    background: #4CAF50;
    width: 0%;
    transition: width 0.3s;
  }
</style>

<div class="import-json">
  <h2>–ò–º–ø–æ—Ä—Ç JSON</h2>
  
  <div class="import-methods">
    <button class="import-btn" id="file-btn">–° —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ üìÅ</button>
    <button class="import-btn" id="project-btn">–í –ø—Ä–æ–µ–∫—Ç–µ üîç</button>
    <button class="import-btn" id="url-btn">–ü–æ —Å—Å—ã–ª–∫–µ üåê</button>
    <button class="import-btn" id="text-btn">–ö–∞–∫ —Ç–µ–∫—Å—Ç ‚úèÔ∏è</button>
  </div>
  
  <div class="file-info" id="file-info">
    –§–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
  </div>
  
  <textarea id="json-textarea" placeholder='–í—Å—Ç–∞–≤—å—Ç–µ JSON –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª...'></textarea>
  
  <div class="status-bar">
    <div class="status-progress" id="status-progress"></div>
  </div>
  
  <div id="status-text">–ì–æ—Ç–æ–≤–æ –∫ –∑–∞–≥—Ä—É–∑–∫–µ</div>
</div>

<script>
  let currentJson = null;
  const statusProgress = document.getElementById('status-progress');
  const statusText = document.getElementById('status-text');
  const fileInfo = document.getElementById('file-info');
  const textarea = document.getElementById('json-textarea');

  // 1. –ò–º–ø–æ—Ä—Ç –∏–∑ —Ñ–∞–π–ª–∞
  document.getElementById('file-btn').addEventListener('click', () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = e => {
      const startTime = performance.now();
      const file = e.target.files[0];
      if (!file) return;
      
      updateStatus('–ó–∞–≥—Ä—É–∑–∫–∞...', 30);
      
      const reader = new FileReader();
      reader.onload = e => {
        try {
          currentJson = JSON.parse(e.target.result);
          updateFileInfo(`–§–∞–π–ª: ${file.name} (${(file.size/1024).toFixed(1)} KB) | –°–ø–æ—Å–æ–±: –° —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞`);
          textarea.value = JSON.stringify(currentJson, null, 2);
          
          const loadTime = (performance.now() - startTime).toFixed(1);
          updateStatus(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞ ${loadTime} –º—Å`, 100);
        } catch (err) {
          updateStatus('–û—à–∏–±–∫–∞: –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON', 0);
        }
      };
      
      reader.readAsText(file);
    };
    
    input.click();
  });

  // 2. –ü–æ–∏—Å–∫ JSON –≤ –ø—Ä–æ–µ–∫—Ç–µ (—ç–º—É–ª—è—Ü–∏—è)
  document.getElementById('project-btn').addEventListener('click', async () => {
    updateStatus('–ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤...', 20);
    
    // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å fetch –∫ API –∏–ª–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
    setTimeout(() => {
      const mockFiles = [
        {name: "data.json", size: 1024},
        {name: "config.json", size: 512}
      ];
      
      if (mockFiles.length > 0) {
        const selectedFile = mockFiles[0]; // –ë–µ—Ä—ë–º –ø–µ—Ä–≤—ã–π —Ñ–∞–π–ª –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
        currentJson = {mock: "–≠—Ç–æ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ. –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç fetch('data.json')"};
        
        updateFileInfo(`–§–∞–π–ª: ${selectedFile.name} (${selectedFile.size} B) | –°–ø–æ—Å–æ–±: –í –ø—Ä–æ–µ–∫—Ç–µ`);
        textarea.value = JSON.stringify(currentJson, null, 2);
        updateStatus(`–ù–∞–π–¥–µ–Ω–æ ${mockFiles.length} —Ñ–∞–π–ª–æ–≤`, 100);
      } else {
        updateStatus('JSON-—Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 0);
      }
    }, 800);
  });

  // 3. –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ URL
  document.getElementById('url-btn').addEventListener('click', async () => {
    const url = prompt("–í–≤–µ–¥–∏—Ç–µ URL JSON-—Ñ–∞–π–ª–∞:", "https://example.com/data.json");
    if (!url) return;
    
    updateStatus('–ó–∞–≥—Ä—É–∑–∫–∞...', 30);
    const startTime = performance.now();
    
    try {
      const response = await fetch(url);
      if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ HTTP: " + response.status);
      
      currentJson = await response.json();
      updateFileInfo(`URL: ${url} | –°–ø–æ—Å–æ–±: –ü–æ —Å—Å—ã–ª–∫–µ`);
      textarea.value = JSON.stringify(currentJson, null, 2);
      
      const loadTime = (performance.now() - startTime).toFixed(1);
      updateStatus(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞ ${loadTime} –º—Å`, 100);
    } catch (err) {
      updateStatus('–û—à–∏–±–∫–∞: ' + err.message, 0);
    }
  });

  // 4. –í–≤–æ–¥ –≤—Ä—É—á–Ω—É—é
  document.getElementById('text-btn').addEventListener('click', () => {
    try {
      if (!textarea.value.trim()) throw new Error("–í–≤–µ–¥–∏—Ç–µ JSON");
      currentJson = JSON.parse(textarea.value);
      updateFileInfo(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ –≤—Ä—É—á–Ω—É—é | –°–ø–æ—Å–æ–±: –¢–µ–∫—Å—Ç`);
      updateStatus("–í–∞–ª–∏–¥–Ω—ã–π JSON", 100);
    } catch (err) {
      updateStatus('–û—à–∏–±–∫–∞: ' + err.message, 0);
    }
  });

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
  function updateStatus(message, percent) {
    statusText.textContent = message;
    statusProgress.style.width = percent + '%';
    statusProgress.style.backgroundColor = percent === 100 ? '#4CAF50' : '#2196F3';
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–µ
  function updateFileInfo(info) {
    fileInfo.textContent = info;
    fileInfo.style.animation = 'none';
    void fileInfo.offsetWidth; // –¢—Ä–∏–≥–≥–µ—Ä —Ä–µ—Ñ–ª–æ—É
    fileInfo.style.animation = 'highlight 0.5s';
  }

  // –ê–Ω–∏–º–∞—Ü–∏—è highlight
  const style = document.createElement('style');
  style.textContent = `
    @keyframes highlight {
      from { background: #aaffaa; }
      to { background: #eef; }
    }
  `;
  document.head.appendChild(style);
</script>
