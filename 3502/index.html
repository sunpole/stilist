<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä 6 –ø–æ–ª–∏–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</title>
    
    <!-- Open Graph —Ç–µ–≥–∏ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π -->
    <meta property="og:title" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ–ª–∏–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π">
    <meta property="og:description" content="–†–∞—Å—á–µ—Ç 6 –æ–ø–µ—Ä–∞—Ü–∏–π –£–§-–ª–∞–∫–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ñ–æ–ª—å–≥–∏—Ä–æ–≤–∞–Ω–∏—è. –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF –∏ TXT.">
    <meta property="og:image" content="https://sunpole.github.io/stilist/350/preview-poly.jpg">
    <meta property="og:url" content="https://sunpole.github.io/stilist/350/polygraphic.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="–ü–æ–ª–∏–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä">
    
    <!-- Twitter Card —Ç–µ–≥–∏ -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ–ª–∏–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π">
    <meta name="twitter:description" content="–†–∞—Å—á–µ—Ç 6 –æ–ø–µ—Ä–∞—Ü–∏–π –£–§-–ª–∞–∫–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ñ–æ–ª—å–≥–∏—Ä–æ–≤–∞–Ω–∏—è. –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF –∏ TXT.">
    <meta name="twitter:image" content="https://sunpole.github.io/stilist/350/preview-poly.jpg">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: #f0f2f5;
            padding: 10px;
            font-size: 13px;
            line-height: 1.3;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        /* –®–∞–ø–∫–∞ */
        .header {
            background: #2c3e50;
            color: white;
            padding: 12px 15px;
            text-align: center;
        }
        
        h1 {
            font-size: 16px;
            margin-bottom: 3px;
        }
        
        .subtitle {
            font-size: 11px;
            opacity: 0.8;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .content {
            padding: 15px;
        }
        
        /* –°–µ—Ç–∫–∞ —Å –¥–≤—É–º—è –∫–æ–ª–æ–Ω–∫–∞–º–∏ –Ω–∞ –ü–ö */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* –ë–ª–æ–∫–∏ */
        .block {
            margin-bottom: 15px;
        }
        
        .block-title {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
        }
        
        /* –§–æ—Ä–º–∞ –¥–∞–Ω–Ω—ã—Ö */
        .form-row {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 8px;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .form-row label {
            font-size: 12px;
            color: #555;
        }
        
        .form-input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 12px;
        }
        
        /* –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ */
        .add-op {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ddd;
            margin-bottom: 15px;
        }
        
        .add-row {
            display: grid;
            grid-template-columns: 1fr 70px 70px 80px;
            gap: 8px;
            align-items: center;
            margin-bottom: 8px;
        }
        
        @media (max-width: 480px) {
            .add-row {
                grid-template-columns: 1fr 70px;
                gap: 6px;
            }
        }
        
        select.form-input {
            font-size: 11px;
            padding: 5px 6px;
            height: 32px;
        }
        
        .add-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 7px 10px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
            height: 32px;
        }
        
        .add-btn:hover {
            background: #219653;
        }
        
        /* –¢–∞–±–ª–∏—Ü–∞ –æ–ø–µ—Ä–∞—Ü–∏–π */
        .ops-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }
        
        .ops-table th {
            background: #ecf0f1;
            padding: 8px 6px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 1px solid #ddd;
        }
        
        .ops-table td {
            padding: 6px;
            border-bottom: 1px solid #eee;
        }
        
        .ops-table tr:hover td {
            background: #f9f9f9;
        }
        
        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .delete-btn:hover {
            background: #c0392b;
        }
        
        /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */
        .results {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            border: 1px solid #ddd;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dotted #ddd;
        }
        
        .result-row:last-child {
            border-bottom: none;
        }
        
        .total {
            background: #2ecc71;
            color: white;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .total-value {
            font-size: 18px;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ */
        .export-btns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .export-btn {
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        .pdf-btn {
            background: #e74c3c;
            color: white;
        }
        
        .pdf-btn:hover {
            background: #c0392b;
        }
        
        .txt-btn {
            background: #3498db;
            color: white;
        }
        
        .txt-btn:hover {
            background: #2980b9;
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π */
        .empty-msg {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-style: italic;
            font-size: 12px;
        }
        
        /* –§—É—Ç–µ—Ä */
        footer {
            text-align: center;
            padding: 10px;
            border-top: 1px solid #ddd;
            color: #7f8c8d;
            font-size: 11px;
        }
        
        /* –£—Ç–∏–ª–∏—Ç—ã */
        .text-right {
            text-align: right;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mb-10 {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ–ª–∏–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</h1>
            <div class="subtitle">6 –æ–ø–µ—Ä–∞—Ü–∏–π –£–§-–ª–∞–∫–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ñ–æ–ª—å–≥–∏—Ä–æ–≤–∞–Ω–∏—è</div>
        </div>
        
        <div class="content">
            <div class="main-grid">
                <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
                <div>
                    <!-- –î–∞–Ω–Ω—ã–µ -->
                    <div class="block">
                        <div class="block-title">–î–∞–Ω–Ω—ã–µ</div>
                        <div class="form-row">
                            <label>–§–ò–û:</label>
                            <input type="text" id="fio" class="form-input" placeholder="–ò–≤–∞–Ω–æ–≤ –ò.–ò.">
                        </div>
                        <div class="form-row">
                            <label>–î–∞—Ç–∞:</label>
                            <input type="date" id="date" class="form-input">
                        </div>
                        <div class="form-row">
                            <label>–¢–ö:</label>
                            <input type="text" id="tk" class="form-input" placeholder="–¢–ö-00001" value="–¢–ö-00001">
                        </div>
                        <div class="form-row">
                            <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                            <input type="text" id="desc" class="form-input" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞">
                        </div>
                    </div>
                    
                    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
                    <div class="block">
                        <div class="block-title">–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</div>
                        <div class="add-op">
                            <div class="add-row">
                                <select id="op-select" class="form-input">
                                    <option value="0">–£–§–ª_0 - —É—Ñ-–ª–∞–∫ –ø—Ä–∏–ª–∞–¥–∫–∞ (7.000000 —Ä—É–±/—à—Ç)</option>
                                    <option value="1">–£–§–ª_1 - —É—Ñ-–ª–∞–∫ &lt;B3 (0.093333 —Ä—É–±/—à—Ç)</option>
                                    <option value="2">–£–§–ª_2 - —É—Ñ-–ª–∞–∫ &gt;B3 (0.140000 —Ä—É–±/—à—Ç)</option>
                                    <option value="3">–£–§–ª+—Ñ - —Ñ–æ–ª—å–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–∞–¥–∫–∞ (4.666667 —Ä—É–±/—à—Ç)</option>
                                    <option value="4">–£–§–ª—Ñ1 - —Ñ–æ–ª—å–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ê4 (0.042500 —Ä—É–±/—à—Ç)</option>
                                    <option value="5">–£–§–ª—Ñ2 - —Ñ–æ–ª—å–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ê3 (0.070833 —Ä—É–±/—à—Ç)</option>
                                </select>
                                <input type="number" id="op-qty" class="form-input" min="1" value="1" placeholder="—à—Ç">
                                <input type="text" id="op-tk" class="form-input" placeholder="–¢–ö">
                                <button id="add-btn" class="add-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –û–ø–µ—Ä–∞—Ü–∏–∏ -->
                    <div class="block">
                        <div class="block-title">–û–ø–µ—Ä–∞—Ü–∏–∏</div>
                        <div style="max-height: 300px; overflow-y: auto;">
                            <table class="ops-table" id="ops-table">
                                <thead>
                                    <tr>
                                        <th style="width: 30px;">‚Ññ</th>
                                        <th>–ö–æ–¥</th>
                                        <th style="width: 60px;">–¢–ö</th>
                                        <th style="width: 50px;">–ö–æ–ª-–≤–æ</th>
                                        <th style="width: 70px;">–¶–µ–Ω–∞</th>
                                        <th style="width: 70px;">–°—É–º–º–∞</th>
                                        <th style="width: 30px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="ops-list">
                                    <tr id="empty-row">
                                        <td colspan="7" class="empty-msg">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <button id="clear-btn" class="add-btn" style="background: #e74c3c; margin-top: 10px; width: 100%; display: none;">
                            –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
                        </button>
                    </div>
                </div>
                
                <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
                <div>
                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
                    <div class="block">
                        <div class="block-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</div>
                        <div class="results">
                            <div class="result-row">
                                <span>–ö–æ–ª-–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π:</span>
                                <span id="res-count">0</span>
                            </div>
                            <div class="result-row">
                                <span>–í—Å–µ–≥–æ —à—Ç—É–∫:</span>
                                <span id="res-qty">0</span>
                            </div>
                            <div class="result-row">
                                <span>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞:</span>
                                <span id="res-avg">0.00 —Ä—É–±</span>
                            </div>
                            <div class="result-row">
                                <span>–ú–∞–∫—Å. —Å—É–º–º–∞:</span>
                                <span id="res-max">0.00 —Ä—É–±</span>
                            </div>
                        </div>
                        
                        <div class="total">
                            <span>–ò–¢–û–ì–û:</span>
                            <span class="total-value" id="res-total">0.00 —Ä—É–±</span>
                        </div>
                    </div>
                    
                    <!-- –≠–∫—Å–ø–æ—Ä—Ç -->
                    <div class="block">
                        <div class="block-title">–≠–∫—Å–ø–æ—Ä—Ç</div>
                        <div class="export-btns">
                            <button class="export-btn pdf-btn" id="export-pdf">
                                üìÑ PDF
                            </button>
                            <button class="export-btn txt-btn" id="export-txt">
                                üìù TXT
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <div>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ–ª–∏–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</div>
        </footer>
    </div>

    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è jsPDF
        window.jsPDF = window.jspdf.jsPDF;
        
        // –í–ê–ñ–ù–û: –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑ 6 –æ–ø–µ—Ä–∞—Ü–∏–π
        const operationsData = [
            { id: 0, code: "–£–§–ª_0", name: "—É—Ñ-–ª–∞–∫ –ø—Ä–∏–ª–∞–¥–∫–∞", price: 7.000000, norm: "2 —à—Ç/—á–∞—Å" },
            { id: 1, code: "–£–§–ª_1", name: "—É—Ñ-–ª–∞–∫ –ª–∏—Å—Ç–æ–ø—Ä–æ–≥–æ–Ω <B3", price: 0.093333, norm: "150 —à—Ç/—á–∞—Å" },
            { id: 2, code: "–£–§–ª_2", name: "—É—Ñ-–ª–∞–∫ –ª–∏—Å—Ç–æ–ø—Ä–æ–≥–æ–Ω >B3", price: 0.140000, norm: "100 —à—Ç/—á–∞—Å" },
            { id: 3, code: "–£–§–ª+—Ñ", name: "—Ñ–æ–ª—å–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–∞–¥–∫–∞", price: 4.666667, norm: "3 —à—Ç/—á–∞—Å" },
            { id: 4, code: "–£–§–ª—Ñ1", name: "—Ñ–æ–ª—å–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –ª–∞–∫—É –ê4", price: 0.042500, norm: "200 —à—Ç/—á–∞—Å" },
            { id: 5, code: "–£–§–ª—Ñ2", name: "—Ñ–æ–ª—å–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –ª–∞–∫—É –ê3", price: 0.070833, norm: "120 —à—Ç/—á–∞—Å" }
        ];
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let operations = [];
        let opCounter = 1;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log("=== –ó–ê–ì–†–£–ó–ö–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ===");
            console.log("–í—Å–µ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:", operationsData.length);
            
            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            document.getElementById('add-btn').addEventListener('click', addOperation);
            document.getElementById('clear-btn').addEventListener('click', clearAll);
            document.getElementById('export-pdf').addEventListener('click', exportPDF);
            document.getElementById('export-txt').addEventListener('click', exportTXT);
            document.getElementById('tk').addEventListener('input', updateTkField);
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å select - –í–ê–ñ–ù–û!
            const select = document.getElementById('op-select');
            const optionCount = select.options.length;
            console.log("–ü—Ä–æ–≤–µ—Ä–∫–∞ select:");
            console.log("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ option –≤ select:", optionCount);
            
            if (optionCount !== 6) {
                console.error("–û–®–ò–ë–ö–ê: –í select –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 6 –æ–ø—Ü–∏–π, –∞ —Å–µ–π—á–∞—Å:", optionCount);
                console.log("–°–æ–¥–µ—Ä–∂–∏–º–æ–µ select:", select.innerHTML);
                
                // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–ø—Ü–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
                restoreSelectOptions();
            } else {
                console.log("‚úì Select —Å–æ–¥–µ—Ä–∂–∏—Ç 6 –æ–ø—Ü–∏–π - OK");
                for (let i = 0; i < select.options.length; i++) {
                    console.log(`  ${i}. ${select.options[i].text}`);
                }
            }
            
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage
            loadFromStorage();
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
            localStorage.removeItem('poly_calc_old_version');
        });
        
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–ø—Ü–∏–∏ select –µ—Å–ª–∏ –æ–Ω–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã
        function restoreSelectOptions() {
            const select = document.getElementById('op-select');
            console.log("–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–π select...");
            
            // –û—á–∏—â–∞–µ–º select
            select.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ 6 –æ–ø—Ü–∏–π
            const options = [
                {value: 0, text: "–£–§–ª_0 - —É—Ñ-–ª–∞–∫ –ø—Ä–∏–ª–∞–¥–∫–∞ (7.000000 —Ä—É–±/—à—Ç)"},
                {value: 1, text: "–£–§–ª_1 - —É—Ñ-–ª–∞–∫ <B3 (0.093333 —Ä—É–±/—à—Ç)"},
                {value: 2, text: "–£–§–ª_2 - —É—Ñ-–ª–∞–∫ >B3 (0.140000 —Ä—É–±/—à—Ç)"},
                {value: 3, text: "–£–§–ª+—Ñ - —Ñ–æ–ª—å–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–∞–¥–∫–∞ (4.666667 —Ä—É–±/—à—Ç)"},
                {value: 4, text: "–£–§–ª—Ñ1 - —Ñ–æ–ª—å–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ê4 (0.042500 —Ä—É–±/—à—Ç)"},
                {value: 5, text: "–£–§–ª—Ñ2 - —Ñ–æ–ª—å–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ê3 (0.070833 —Ä—É–±/—à—Ç)"}
            ];
            
            options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt.value;
                option.textContent = opt.text;
                select.appendChild(option);
            });
            
            console.log("‚úì –û–ø—Ü–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã. –¢–µ–ø–µ—Ä—å –æ–ø—Ü–∏–π:", select.options.length);
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ –¢–ö
        function updateTkField() {
            const tk = document.getElementById('tk').value;
            document.getElementById('op-tk').value = tk;
        }
        
        // –î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
        function addOperation() {
            const type = parseInt(document.getElementById('op-select').value);
            const qty = parseInt(document.getElementById('op-qty').value);
            let tk = document.getElementById('op-tk').value.trim();
            
            console.log("–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ - –≤—ã–±—Ä–∞–Ω —Ç–∏–ø:", type, "–Ω–∞–∑–≤–∞–Ω–∏–µ:", operationsData[type]?.code);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∏
            if (isNaN(type) || type < 0 || type > 5) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é –∏–∑ —Å–ø–∏—Å–∫–∞ (0-5)');
                return;
            }
            
            if (!qty || qty < 1) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ');
                document.getElementById('op-qty').focus();
                return;
            }
            
            if (!tk) {
                tk = document.getElementById('tk').value || '–¢–ö-00001';
            }
            
            const op = operationsData[type];
            
            if (!op) {
                alert('–û—à–∏–±–∫–∞: –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
            const newOp = {
                id: opCounter++,
                code: op.code,
                name: op.name,
                price: op.price,
                quantity: qty,
                tk: tk,
                total: parseFloat((op.price * qty).toFixed(6))
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤
            operations.push(newOp);
            console.log("‚úì –û–ø–µ—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞. –í—Å–µ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–π:", operations.length);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateOpsTable();
            updateResults();
            saveToStorage();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            document.getElementById('op-qty').value = 1;
        }
        
        // –£–¥–∞–ª–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
        function deleteOperation(id) {
            operations = operations.filter(op => op.id !== id);
            updateOpsTable();
            updateResults();
            saveToStorage();
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
        function clearAll() {
            if (operations.length === 0) return;
            if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏?')) {
                operations = [];
                opCounter = 1;
                updateOpsTable();
                updateResults();
                saveToStorage();
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –æ–ø–µ—Ä–∞—Ü–∏–π
        function updateOpsTable() {
            const tbody = document.getElementById('ops-list');
            const clearBtn = document.getElementById('clear-btn');
            
            if (operations.length === 0) {
                tbody.innerHTML = '<tr id="empty-row"><td colspan="7" class="empty-msg">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</td></tr>';
                clearBtn.style.display = 'none';
                return;
            }
            
            clearBtn.style.display = 'block';
            
            let html = '';
            operations.forEach((op, index) => {
                html += `
                    <tr>
                        <td class="text-center">${index + 1}</td>
                        <td><strong>${op.code}</strong><br><small>${op.name}</small></td>
                        <td>${op.tk}</td>
                        <td class="text-center">${op.quantity} —à—Ç</td>
                        <td class="text-right">${op.price.toFixed(6)} —Ä—É–±</td>
                        <td class="text-right" style="color: #2ecc71; font-weight: 600;">${op.total.toFixed(6)} —Ä—É–±</td>
                        <td class="text-center">
                            <button class="delete-btn" onclick="deleteOperation(${op.id})" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        function updateResults() {
            if (operations.length === 0) {
                document.getElementById('res-count').textContent = '0';
                document.getElementById('res-qty').textContent = '0';
                document.getElementById('res-avg').textContent = '0.00 —Ä—É–±';
                document.getElementById('res-max').textContent = '0.00 —Ä—É–±';
                document.getElementById('res-total').textContent = '0.00 —Ä—É–±';
                return;
            }
            
            const count = operations.length;
            const totalQty = operations.reduce((sum, op) => sum + op.quantity, 0);
            const totalSum = operations.reduce((sum, op) => sum + op.total, 0);
            const avgPrice = totalSum / count;
            const maxPrice = Math.max(...operations.map(op => op.total));
            
            document.getElementById('res-count').textContent = count;
            document.getElementById('res-qty').textContent = totalQty;
            document.getElementById('res-avg').textContent = avgPrice.toFixed(6) + ' —Ä—É–±';
            document.getElementById('res-max').textContent = maxPrice.toFixed(6) + ' —Ä—É–±';
            document.getElementById('res-total').textContent = totalSum.toFixed(6) + ' —Ä—É–±';
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage
        function saveToStorage() {
            try {
                const data = {
                    operations: operations,
                    counter: opCounter,
                    fio: document.getElementById('fio').value,
                    date: document.getElementById('date').value,
                    desc: document.getElementById('desc').value,
                    tk: document.getElementById('tk').value
                };
                localStorage.setItem('poly_calc', JSON.stringify(data));
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage
        function loadFromStorage() {
            try {
                const saved = localStorage.getItem('poly_calc');
                if (!saved) {
                    console.log("–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö");
                    return;
                }
                
                const data = JSON.parse(saved);
                operations = data.operations || [];
                opCounter = data.counter || 1;
                
                if (data.fio) document.getElementById('fio').value = data.fio;
                if (data.date) document.getElementById('date').value = data.date;
                if (data.desc) document.getElementById('desc').value = data.desc;
                if (data.tk) document.getElementById('tk').value = data.tk;
                
                updateTkField();
                updateOpsTable();
                updateResults();
                
                console.log("‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", operations.length);
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
                localStorage.removeItem('poly_calc'); // –£–¥–∞–ª—è–µ–º –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            }
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF
        function exportPDF() {
            if (operations.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é');
                return;
            }
            
            const fio = document.getElementById('fio').value || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            const date = document.getElementById('date').value || new Date().toISOString().split('T')[0];
            const desc = document.getElementById('desc').value || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            const tk = document.getElementById('tk').value || '–¢–ö-00001';
            
            const doc = new jsPDF();
            
            // –ó–∞–≥–æ–ª–æ–≤–æ–∫
            doc.setFontSize(14);
            doc.setTextColor(26, 35, 126);
            doc.text('–†–ê–ü–û–†–¢–ò–ß–ö–ê –ü–û–õ–ò–ì–†–ê–§–ò–ß–ï–°–ö–ò–• –û–ü–ï–†–ê–¶–ò–ô', 105, 15, null, null, 'center');
            
            // –î–∞–Ω–Ω—ã–µ
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            doc.text(`–§–ò–û: ${fio}`, 20, 25);
            doc.text(`–î–∞—Ç–∞: ${date}`, 20, 32);
            doc.text(`–û–ø–∏—Å–∞–Ω–∏–µ: ${desc}`, 20, 39);
            doc.text(`–¢–ö: ${tk}`, 20, 46);
            
            // –¢–∞–±–ª–∏—Ü–∞
            let y = 55;
            doc.setFillColor(240, 240, 240);
            doc.rect(20, y, 170, 8, 'F');
            doc.setFontSize(9);
            doc.text('‚Ññ', 25, y + 6);
            doc.text('–ö–æ–¥ –æ–ø–µ—Ä–∞—Ü–∏–∏', 35, y + 6);
            doc.text('–¢–ö', 90, y + 6);
            doc.text('–ö–æ–ª-–≤–æ', 120, y + 6);
            doc.text('–¶–µ–Ω–∞/—à—Ç', 140, y + 6);
            doc.text('–°—É–º–º–∞', 170, y + 6);
            
            y += 10;
            doc.setFontSize(8);
            
            operations.forEach((op, index) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                
                doc.text((index + 1).toString(), 25, y + 6);
                doc.text(op.code, 35, y + 6);
                doc.text(op.tk, 90, y + 6);
                doc.text(`${op.quantity} —à—Ç`, 120, y + 6);
                doc.text(`${op.price.toFixed(6)} —Ä—É–±`, 140, y + 6);
                doc.text(`${op.total.toFixed(6)} —Ä—É–±`, 170, y + 6);
                
                y += 10;
            });
            
            // –ò—Ç–æ–≥
            const total = operations.reduce((sum, op) => sum + op.total, 0);
            y = Math.max(y + 10, 260);
            doc.setFontSize(12);
            doc.setTextColor(0, 100, 0);
            doc.text(`–ò–¢–û–ì–û: ${total.toFixed(6)} —Ä—É–±`, 20, y);
            
            // –ü–æ–¥–ø–∏—Å–∏
            y += 15;
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            doc.text('–ü–æ–¥–ø–∏—Å—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è: ___________________', 20, y);
            doc.text('–î–∞—Ç–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è: ' + new Date().toLocaleDateString('ru-RU'), 120, y);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º
            doc.save(`—Ä–∞–ø–æ—Ä—Ç–∏—á–∫–∞_${date}.pdf`);
            console.log("‚úì PDF —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω");
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –≤ TXT
        function exportTXT() {
            if (operations.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é');
                return;
            }
            
            const fio = document.getElementById('fio').value || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            const date = document.getElementById('date').value || new Date().toISOString().split('T')[0];
            const desc = document.getElementById('desc').value || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            const tk = document.getElementById('tk').value || '–¢–ö-00001';
            
            let content = '–†–ê–ü–û–†–¢–ò–ß–ö–ê –ü–û–õ–ò–ì–†–ê–§–ò–ß–ï–°–ö–ò–• –û–ü–ï–†–ê–¶–ò–ô\n';
            content += '='.repeat(60) + '\n\n';
            content += `–§–ò–û: ${fio}\n`;
            content += `–î–∞—Ç–∞: ${date}\n`;
            content += `–û–ø–∏—Å–∞–Ω–∏–µ: ${desc}\n`;
            content += `–¢–ö: ${tk}\n\n`;
            content += '–°–ü–ò–°–û–ö –û–ü–ï–†–ê–¶–ò–ô:\n';
            content += '-'.repeat(60) + '\n\n';
            
            let total = 0;
            operations.forEach((op, index) => {
                content += `${index + 1}. ${op.code} - ${op.name}\n`;
                content += `   –¢–ö: ${op.tk}\n`;
                content += `   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${op.quantity} —à—Ç\n`;
                content += `   –¶–µ–Ω–∞ –∑–∞ —à—Ç: ${op.price.toFixed(6)} —Ä—É–±\n`;
                content += `   –°—É–º–º–∞: ${op.total.toFixed(6)} —Ä—É–±\n\n`;
                total += op.total;
            });
            
            content += '='.repeat(60) + '\n';
            content += `–ò–¢–û–ì–û: ${total.toFixed(6)} —Ä—É–±\n`;
            content += '='.repeat(60) + '\n\n';
            
            content += `–î–∞—Ç–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è: ${new Date().toLocaleDateString('ru-RU')}\n`;
            content += '–ü–æ–¥–ø–∏—Å—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è: ___________________\n';
            
            // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `—Ä–∞–ø–æ—Ä—Ç–∏—á–∫–∞_${date}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            console.log("‚úì TXT —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω");
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        console.log("‚úì Script loaded. Operations data count:", operationsData.length);
        console.log("‚úì Available operations:", operationsData.map(op => op.code).join(', '));
    </script>
</body>
</html>
