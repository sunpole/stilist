<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ò–≥—Ä–∞: –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏—è</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f8f9fa; }
    .stats { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:15px; }
    .stats span { background:#fff; padding:5px 10px; border-radius:5px; box-shadow:0 1px 2px rgba(0,0,0,.1);}
    .equipment-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(100px,1fr)); gap:8px; }
    .cell { border:1px dashed #ccc; height:80px; display:flex; align-items:center; justify-content:center; font-size:12px; position:relative; cursor:pointer; background:#fff; border-radius:5px; }
    .cell.broken { background:#f8d7da; }
    .tooltip-inner { max-width:200px; }
    @media (max-width:768px){
      body{font-size:14px;}
      .stats{flex-direction:column;text-align:center;}
      .cell{height:60px;font-size:11px;}
      .btn{padding:4px 6px;font-size:12px;}
    }
    @media (max-width:480px){
      body{font-size:12px;}
      .modal-content{font-size:12px;}
      .cell{height:50px;font-size:10px;}
    }
  </style>
</head>
<body class="container-fluid p-3">

  <h3 class="mb-3">üì¶ –ò–≥—Ä–∞ ¬´–¢–∏–ø–æ–≥—Ä–∞—Ñ–∏—è¬ª</h3>

  <div class="stats">
    <span id="money">üí∞ –î–µ–Ω—å–≥–∏: 100</span>
    <span id="materials">üì¶ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã: 0/50</span>
    <span id="orders">üìù –ó–∞–∫–∞–∑—ã: 0/100</span>
    <span id="ad">üì¢ –†–µ–∫–ª–∞–º–∞: 0</span>
    <span id="quality">‚≠ê –ö–∞—á–µ—Å—Ç–≤–æ: 0</span>
  </div>

  <div class="mb-3">
    <button class="btn btn-primary" id="buyMaterialsBtn" title="–ö—É–ø–∏—Ç—å 10 –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∑–∞ 100‚ÇΩ">–ó–∞–∫—É–ø–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã</button>
    <button class="btn btn-success" id="findOrdersBtn" title="–ò—Å–∫–∞—Ç—å –∑–∞–∫–∞–∑—ã –≤—Ä—É—á–Ω—É—é (1 –ø–æ–ø—ã—Ç–∫–∞)">–ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤</button>
    <button class="btn btn-warning" id="repairAllBtn" title="–†–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë —Å–ª–æ–º–∞–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∑–∞ 50‚ÇΩ">–†–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë</button>
  </div>

  <div class="row">
    <div class="col-md-8">
      <h5>üè≠ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–æ–Ω–∞</h5>
      <div class="equipment-grid" id="grid"></div>
    </div>
    <div class="col-md-4">
      <h5>üõí –ú–∞–≥–∞–∑–∏–Ω</h5>
      <div id="shop" class="list-group"></div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ====== –ë–∞–ª–∞–Ω—Å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ======
    const BALANCE = {
      materialPrice: 10,
      orderPrice: 50,
      orderSpawnBase: 0.2, // –±–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–∫–∞–∑–æ–≤
      maxOrders: 100,
      maxMaterialsBase: 50
    };

    // ====== –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã ======
    const gameState = {
      money: 100,
      materials: 0,
      orders: 0,
      ad: 0,
      quality: 0,
      productionAccumulator: 0,
      lastUpdate: Date.now(),
      maxMaterials: BALANCE.maxMaterialsBase
    };

    // ====== –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ ======
    const equipmentTypes = {
      printer: { name:"–ü—Ä–∏–Ω—Ç–µ—Ä", cost:100, type:"production", speed:0.5, breakdownRisk:0.001, desc:"–ü–µ—á–∞—Ç–∞–µ—Ç –∑–∞–∫–∞–∑—ã. –¢—Ä–µ–±—É–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª—ã."},
      warehouse: { name:"–°–∫–ª–∞–¥", cost:200, type:"storage", capacity:50, desc:"–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤."},
      adUnit: { name:"–†–µ–∫–ª–∞–º–∞", cost:150, type:"ad", boost:0.1, desc:"–£—Å–∫–æ—Ä—è–µ—Ç –ø–æ—è–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤."},
      quality: { name:"–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞", cost:120, type:"quality", bonus:1, desc:"–ü–æ–≤—ã—à–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –∑–∞–∫–∞–∑–æ–≤."}
    };

    const grid = [];
    const gridSize = 12; // 12 –∫–ª–µ—Ç–æ–∫

    // ====== –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å ======
    const moneyEl = document.getElementById("money");
    const matEl = document.getElementById("materials");
    const ordEl = document.getElementById("orders");
    const adEl = document.getElementById("ad");
    const qualEl = document.getElementById("quality");
    const gridEl = document.getElementById("grid");
    const shopEl = document.getElementById("shop");

    function updateUI(){
      moneyEl.textContent = `üí∞ –î–µ–Ω—å–≥–∏: ${gameState.money}`;
      matEl.textContent = `üì¶ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã: ${gameState.materials}/${gameState.maxMaterials}`;
      ordEl.textContent = `üìù –ó–∞–∫–∞–∑—ã: ${gameState.orders}/${BALANCE.maxOrders}`;
      adEl.textContent = `üì¢ –†–µ–∫–ª–∞–º–∞: ${gameState.ad}`;
      qualEl.textContent = `‚≠ê –ö–∞—á–µ—Å—Ç–≤–æ: ${gameState.quality}`;
    }

    function renderGrid(){
      gridEl.innerHTML="";
      grid.forEach((cell,idx)=>{
        const d=document.createElement("div");
        d.className="cell";
        if(cell){
          d.innerHTML = cell.type.name;
          d.title = cell.type.desc;
          d.setAttribute("aria-label",cell.type.desc);
          if(cell.broken) d.classList.add("broken");
        } else {
          d.textContent = "+";
          d.title="–°–≤–æ–±–æ–¥–Ω–∞—è —è—á–µ–π–∫–∞";
        }
        gridEl.appendChild(d);
      });
      for(let i=grid.length;i<gridSize;i++){
        const d=document.createElement("div");
        d.className="cell";
        d.textContent="+";
        d.title="–°–≤–æ–±–æ–¥–Ω–∞—è —è—á–µ–π–∫–∞";
        gridEl.appendChild(d);
      }
    }

    function renderShop(){
      shopEl.innerHTML="";
      Object.entries(equipmentTypes).forEach(([k,v])=>{
        const b=document.createElement("button");
        b.className="list-group-item list-group-item-action";
        b.textContent=`${v.name} ‚Äî ${v.cost}‚ÇΩ`;
        b.title=v.desc;
        b.onclick=()=>buyEquipment(k);
        shopEl.appendChild(b);
      });
    }

    // ====== –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ ======
    function buyMaterials(){
      if(gameState.money>=BALANCE.materialPrice*10 && gameState.materials+10<=gameState.maxMaterials){
        gameState.money-=BALANCE.materialPrice*10;
        gameState.materials+=10;
        updateUI();
      }
    }

    function findOrders(){
      if(gameState.orders<BALANCE.maxOrders){
        gameState.orders+=Math.floor(1+Math.random()*3+gameState.ad);
        if(gameState.orders>BALANCE.maxOrders) gameState.orders=BALANCE.maxOrders;
        updateUI();
      }
    }

    function buyEquipment(key){
      const t=equipmentTypes[key];
      if(gameState.money>=t.cost){
        if(grid.length<gridSize){
          gameState.money-=t.cost;
          grid.push({type:t, broken:false, wear:0});
          if(t.type==="storage") gameState.maxMaterials+=t.capacity;
          if(t.type==="ad") gameState.ad+=t.boost;
          if(t.type==="quality") gameState.quality+=t.bonus;
          updateUI(); renderGrid();
        }
      }
    }

    function repairAll(){
      grid.forEach(c=>{ if(c && c.broken){ if(gameState.money>=50){ gameState.money-=50;c.broken=false;} }});
      updateUI(); renderGrid();
    }

    // ====== –¶–∏–∫–ª ======
    function gameLoop(){
      const now=Date.now();
      const delta=(now-gameState.lastUpdate)/1000;
      gameState.lastUpdate=now;

      // –°–ø–∞–≤–Ω –∑–∞–∫–∞–∑–æ–≤
      if(Math.random()<BALANCE.orderSpawnBase*delta+gameState.ad*delta){
        if(gameState.orders<BALANCE.maxOrders) gameState.orders++;
      }

      // –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ
      grid.forEach(c=>{
        if(c && c.type.type==="production" && !c.broken){
          gameState.productionAccumulator+=c.type.speed*delta;
          if(Math.random()<c.type.breakdownRisk*delta) c.broken=true;
        }
      });

      // –ö–æ–Ω–≤–µ—Ä—Å–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –≤ –∑–∞–∫–∞–∑—ã
      const canDo=Math.floor(Math.min(gameState.productionAccumulator, gameState.orders, gameState.materials));
      if(canDo>0){
        gameState.productionAccumulator-=canDo;
        gameState.orders-=canDo;
        gameState.materials-=canDo;
        gameState.money+=canDo*BALANCE.orderPrice;
      }

      updateUI(); renderGrid();
    }

    // ====== –°—Ç–∞—Ä—Ç ======
    document.getElementById("buyMaterialsBtn").onclick=buyMaterials;
    document.getElementById("findOrdersBtn").onclick=findOrders;
    document.getElementById("repairAllBtn").onclick=repairAll;

    renderShop(); renderGrid(); updateUI();
    setInterval(gameLoop,100);
  </script>
</body>
</html>
