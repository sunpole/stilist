<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∞–≥—Ä–∞–¥ - POE Style</title>
    <style>
        :root {
            --bg-dark: #1a1a1a;
            --bg-darker: #121212;
            --text-main: #e0e0e0;
            --text-highlight: #f8b700;
            --border-color: #444;
            --poe-orange: #af6025;
            --poe-blue: #3f6e9a;
            --white: #ffffff;
            --gray: #999999;
            --blue: #3f6e9a;
            --yellow: #ffd700;
            --pink: #ff69b4;
            --purple: #9370db;
            --gold: #daa520;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Fontin SmallCaps', 'Arial Narrow', Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: var(--text-highlight);
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .books-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .book {
            width: 80px;
            height: 100px;
            background-color: var(--bg-darker);
            border: 2px solid;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            padding: 5px;
        }

        .book:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .book.active {
            border-width: 3px;
            box-shadow: 0 0 15px currentColor;
        }

        .book-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .book-name {
            font-size: 0.8rem;
        }

        .book-chance {
            font-size: 0.7rem;
            margin-top: 3px;
            color: var(--text-highlight);
        }

        .normal { border-color: var(--white); color: var(--white); }
        .precious { border-color: var(--gray); color: var(--gray); }
        .magic { border-color: var(--blue); color: var(--blue); }
        .rare { border-color: var(--yellow); color: var(--yellow); }
        .unique { border-color: var(--pink); color: var(--pink); }
        .mythic { border-color: var(--purple); color: var(--purple); }
        .legendary { border-color: var(--gold); color: var(--gold); }

        .generate-btn {
            display: block;
            margin: 0 auto 30px;
            padding: 12px 30px;
            background-color: var(--poe-orange);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: bold;
        }

        .generate-btn:hover {
            background-color: #d87c30;
            transform: scale(1.05);
        }

        .chests-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .chest {
            width: 100px;
            height: 100px;
            background-color: var(--bg-darker);
            border: 2px solid var(--text-highlight);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .chest:hover {
            transform: translateY(-5px);
        }

        .chest-icon {
            font-size: 3rem;
            color: var(--text-highlight);
        }

        .rewards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .reward {
            width: 60px;
            height: 60px;
            background-color: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 5px;
        }

        .reward-icon {
            font-size: 1.5rem;
            margin-bottom: 3px;
        }

        .reward-name {
            font-size: 0.6rem;
        }

        .reward-value {
            font-size: 0.6rem;
            color: var(--text-highlight);
        }

        .total-value {
            text-align: center;
            font-size: 1.5rem;
            color: var(--text-highlight);
            margin: 20px 0;
        }

        .animation {
            animation: pulse 0.5s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @media (max-width: 600px) {
            .book {
                width: 60px;
                height: 80px;
                font-size: 0.7rem;
            }
            
            .book-icon {
                font-size: 1.5rem;
            }
            
            .chest {
                width: 80px;
                height: 80px;
            }
            
            .chest-icon {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∞–≥—Ä–∞–¥</h1>
        
        <div class="books-container" id="books-container">
            <!-- Books will be added here by JavaScript -->
        </div>
        
        <button class="generate-btn" id="generate-btn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>
        
        <div class="chests-container" id="chests-container">
            <!-- Chests will be added here when generated -->
        </div>
        
        <div class="total-value" id="total-value"></div>
    </div>

    <script>
        // Book data
        const books = [
            { id: 1, name: "–û–±—ã—á–Ω–∞—è", chance: 1, color: "normal", icon: "üìò" },
            { id: 2, name: "–¶–µ–Ω–Ω–∞—è", chance: 2, color: "precious", icon: "üìó" },
            { id: 3, name: "–ú–∞–≥–∏—á–µ—Å–∫–∞—è", chance: 5, color: "magic", icon: "üìô" },
            { id: 4, name: "–†–µ–¥–∫–∞—è", chance: 12, color: "rare", icon: "üìí" },
            { id: 5, name: "–£–Ω–∏–∫–∞–ª—å–Ω–∞—è", chance: 15, color: "unique", icon: "üìï" },
            { id: 6, name: "–ú–∏—Ñ–∏—á–µ—Å–∫–∞—è", chance: 20, color: "mythic", icon: "üìì" },
            { id: 7, name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è", chance: 25, color: "legendary", icon: "üìî" }
        ];

        // Reward data (value in clay)
        const rewards = [
            { id: 1, name: "–ì–ª–∏–Ω–∞", value: 1, icon: "üü´", chance: 30 },
            { id: 2, name: "–î—Ä–µ–≤–µ—Å–∏–Ω–∞", value: 5, icon: "üå≤", chance: 25 },
            { id: 3, name: "–ñ–µ–ª–µ–∑–æ", value: 25, icon: "‚öôÔ∏è", chance: 20 },
            { id: 4, name: "–°–µ—Ä–µ–±—Ä–æ", value: 125, icon: "üíç", chance: 15 },
            { id: 5, name: "–ö–∏—Ä–ø–∏—á", value: 500, icon: "üß±", chance: 10 },
            { id: 6, name: "–î–æ—Å–∫–∏", value: 1000, icon: "ü™µ", chance: 8 },
            { id: 7, name: "–ì–≤–æ–∑–¥–∏", value: 2500, icon: "üìå", chance: 6 },
            { id: 8, name: "–ü—Ä–æ–≤–æ–ª–æ–∫–∞", value: 5000, icon: "üßµ", chance: 5 },
            { id: 9, name: "–°—Ç–µ–∫–ª–æ", value: 10000, icon: "ü™û", chance: 4 },
            { id: 10, name: "–ë—Ä–æ–Ω–∑–∞", value: 25000, icon: "üü§", chance: 3 },
            { id: 11, name: "–°—Ç–∞–ª—å", value: 50000, icon: "‚öîÔ∏è", chance: 2 },
            { id: 12, name: "–ú–µ–¥—å", value: 100000, icon: "üî∂", chance: 1.5 },
            { id: 13, name: "–õ–∞—Ç—É–Ω—å", value: 250000, icon: "üü†", chance: 1 },
            { id: 14, name: "–û–ª–æ–≤–æ", value: 500000, icon: "‚ö™", chance: 0.8 },
            { id: 15, name: "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã", value: 1000000, icon: "‚öíÔ∏è", chance: 0.6 },
            { id: 16, name: "–ü–æ—Å—É–¥–∞", value: 2500000, icon: "üçΩÔ∏è", chance: 0.4 },
            { id: 17, name: "–û—Ä—É–∂–∏–µ", value: 5000000, icon: "üó°Ô∏è", chance: 0.3 },
            { id: 18, name: "–£–∫—Ä–∞—à–µ–Ω–∏—è", value: 10000000, icon: "üíé", chance: 0.2 },
            { id: 19, name: "–ß–∞—Å—ã", value: 25000000, icon: "‚è±Ô∏è", chance: 0.1 },
            { id: 20, name: "–ó–µ—Ä–∫–∞–ª–∞", value: 50000000, icon: "ü™û", chance: 0.07 },
            { id: 21, name: "–ú–µ—Ö–∞–Ω–∏–∑–º—ã", value: 100000000, icon: "‚öôÔ∏è", chance: 0.05 },
            { id: 22, name: "–•—Ä—É—Å—Ç–∞–ª—å", value: 250000000, icon: "‚ú®", chance: 0.03 },
            { id: 23, name: "–ó–æ–ª–æ—Ç–æ", value: 500000000, icon: "üëë", chance: 0.02 },
            { id: 24, name: "–ü–ª–∞—Ç–∏–Ω–∞", value: 1000000000, icon: "üî±", chance: 0.01 },
            { id: 25, name: "–ê–ª–º–∞–∑", value: 20000000000, icon: "üí†", chance: 0.005 }
        ];

        // Special diamond rewards
        const diamondRewards = [
            { count: 5, chance: 0.0001 },
            { count: 4, chance: 0.0002 },
            { count: 3, chance: 0.0006 },
            { count: 2, chance: 0.0015 },
            { count: 1, chance: 0.005 }
        ];

        // DOM elements
        const booksContainer = document.getElementById('books-container');
        const generateBtn = document.getElementById('generate-btn');
        const chestsContainer = document.getElementById('chests-container');
        const totalValueElement = document.getElementById('total-value');

        // Current selected book
        let selectedBook = books[0];
        let currentChests = [];
        let currentRewards = [];

        // Format number with commas
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Populate books
        function populateBooks() {
            booksContainer.innerHTML = '';
            
            books.forEach(book => {
                const bookElement = document.createElement('div');
                bookElement.className = `book ${book.color} ${book.id === selectedBook.id ? 'active' : ''}`;
                bookElement.innerHTML = `
                    <div class="book-icon">${book.icon}</div>
                    <div class="book-name">${book.name}</div>
                    <div class="book-chance">+${book.chance}%</div>
                `;
                
                bookElement.addEventListener('click', () => {
                    selectedBook = book;
                    populateBooks();
                    clearResults();
                });
                
                booksContainer.appendChild(bookElement);
            });
        }

        // Clear previous results
        function clearResults() {
            chestsContainer.innerHTML = '';
            totalValueElement.textContent = '';
            currentChests = [];
            currentRewards = [];
        }

        // Generate random number between min and max
        function randomBetween(min, max) {
            return Math.random() * (max - min) + min;
        }

        // Get random reward based on chances
        function getRandomReward(bookMultiplier) {
            // First check for diamond reward (special case)
            const diamondRoll = Math.random() * 100;
            let diamondChanceSum = 0;
            
            for (const dr of diamondRewards) {
                diamondChanceSum += dr.chance * bookMultiplier;
                if (diamondRoll < diamondChanceSum) {
                    return Array(dr.count).fill(rewards.find(r => r.id === 25));
                }
            }
            
            // Normal reward selection
            const totalChance = rewards.reduce((sum, r) => sum + r.chance, 0);
            let roll = Math.random() * totalChance * bookMultiplier;
            
            // Cap the roll to prevent going over normal rewards
            roll = Math.min(roll, totalChance);
            
            let chanceSum = 0;
            for (const reward of rewards) {
                chanceSum += reward.chance;
                if (roll <= chanceSum) {
                    return [reward];
                }
            }
            
            return [rewards[0]]; // Fallback to clay
        }

        // Generate chests
        function generateChests() {
            clearResults();
            
            // Determine number of chests (1-3)
            const chestRoll = Math.random() * 100;
            let chestCount = 1;
            
            if (chestRoll < 3) {
                chestCount = 3;
            } else if (chestRoll < 15) {
                chestCount = 2;
            }
            
            // Create chests
            for (let i = 0; i < chestCount; i++) {
                const chestElement = document.createElement('div');
                chestElement.className = 'chest';
                chestElement.innerHTML = '<div class="chest-icon">üéÅ</div>';
                
                chestElement.addEventListener('click', () => openChest(chestElement, i));
                
                chestsContainer.appendChild(chestElement);
                currentChests.push({
                    element: chestElement,
                    opened: false,
                    rewards: []
                });
            }
        }

        // Open chest
        function openChest(chestElement, chestIndex) {
            if (currentChests[chestIndex].opened) return;
            
            chestElement.classList.add('animation');
            setTimeout(() => {
                chestElement.classList.remove('animation');
                currentChests[chestIndex].opened = true;
                
                // Determine number of rewards (1-5)
                const rewardRoll = Math.random() * 100;
                let rewardCount = 1;
                
                if (rewardRoll < 1) {
                    rewardCount = 5;
                } else if (rewardRoll < 5) {
                    rewardCount = 4;
                } else if (rewardRoll < 10) {
                    rewardCount = 3;
                } else if (rewardRoll < 40) {
                    rewardCount = 2;
                }
                
                // Calculate book multiplier (1 + chance%)
                const bookMultiplier = 1 + (selectedBook.chance / 100);
                
                // Generate rewards
                const rewardsContainer = document.createElement('div');
                rewardsContainer.className = 'rewards-container';
                
                // Check if we already have a diamond reward in other chests
                const hasDiamondReward = currentRewards.some(r => r.id === 25);
                
                for (let i = 0; i < rewardCount; i++) {
                    let reward;
                    
                    // Prevent multiple diamond rewards
                    if (hasDiamondReward) {
                        // Get normal reward if we already have diamonds
                        const totalChance = rewards.reduce((sum, r) => sum + (r.id === 25 ? 0 : r.chance), 0);
                        let roll = Math.random() * totalChance * bookMultiplier;
                        roll = Math.min(roll, totalChance);
                        
                        let chanceSum = 0;
                        for (const r of rewards) {
                            if (r.id === 25) continue;
                            chanceSum += r.chance;
                            if (roll <= chanceSum) {
                                reward = r;
                                break;
                            }
                        }
                    } else {
                        // Normal reward selection
                        reward = getRandomReward(bookMultiplier)[0];
                    }
                    
                    currentRewards.push(reward);
                    currentChests[chestIndex].rewards.push(reward);
                    
                    const rewardElement = document.createElement('div');
                    rewardElement.className = 'reward';
                    rewardElement.innerHTML = `
                        <div class="reward-icon">${reward.icon}</div>
                        <div class="reward-name">${reward.name}</div>
                        <div class="reward-value">${formatNumber(reward.value)}</div>
                    `;
                    
                    rewardsContainer.appendChild(rewardElement);
                }
                
                chestElement.parentNode.insertBefore(rewardsContainer, chestElement.nextSibling);
                
                // Calculate and display total value
                const totalValue = currentRewards.reduce((sum, r) => sum + r.value, 0);
                totalValueElement.textContent = `–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${formatNumber(totalValue)} –≥–ª–∏–Ω—ã`;
            }, 300);
        }

        // Event listeners
        generateBtn.addEventListener('click', generateChests);

        // Initialize
        populateBooks();
    </script>
</body>
</html>
