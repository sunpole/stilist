<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>File Analyzer Pro</title>
  <script src="https://unpkg.com/pdf-lib@1.17.1"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.7/jsmediatags.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 15px;
      max-width: 100%;
      overflow-x: hidden;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      line-height: 1.6;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 20px auto;
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    h1 {
      text-align: center;
      margin-bottom: 25px;
      color: #2c3e50;
      font-size: 2.2rem;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    
    .header-info {
      text-align: center;
      color: #7f8c8d;
      margin-bottom: 20px;
      font-size: 1.1rem;
    }
    
    .dropzone {
      border: 3px dashed #6c757d;
      border-radius: 12px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      background: #f8f9fa;
      margin-bottom: 25px;
      transition: all 0.3s ease;
      min-height: 200px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    
    .dropzone.active {
      border-color: #4CAF50;
      background: #e8f5e8;
      transform: scale(1.01);
    }
    
    .dropzone h3 {
      color: #2c3e50;
      margin-bottom: 15px;
    }
    
    .dropzone p {
      margin: 10px 0;
      color: #6c757d;
    }
    
    .btn {
      display: inline-block;
      padding: 12px 25px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin: 8px;
      transition: all 0.3s ease;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    
    .btn:hover {
      background: #45a049;
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid #4CAF50;
      color: #4CAF50;
    }
    
    .btn-outline:hover {
      background: #4CAF50;
      color: white;
    }
    
    .btn-danger {
      background: #e74c3c;
    }
    
    .btn-danger:hover {
      background: #c0392b;
    }
    
    .btn-info {
      background: #3498db;
    }
    
    .btn-info:hover {
      background: #2980b9;
    }
    
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 25px;
      gap: 12px;
    }
    
    .file-info {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.08);
      margin-top: 25px;
      min-height: 150px;
    }
    
    .metadata-section {
      margin-bottom: 25px;
      border-bottom: 2px solid #ecf0f1;
      padding-bottom: 20px;
      transition: all 0.3s ease;
    }
    
    .metadata-section:last-child {
      border-bottom: none;
    }
    
    .metadata-section:hover {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 15px;
      margin: -5px -5px 20px -5px;
    }
    
    .metadata-row {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 6px;
      transition: background 0.2s;
    }
    
    .metadata-row:hover {
      background: #f0f8ff;
    }
    
    .metadata-key {
      font-weight: bold;
      color: #2c3e50;
      min-width: 250px;
      padding-right: 15px;
      font-size: 1.05rem;
    }
    
    .metadata-value {
      color: #34495e;
      word-break: break-all;
      flex: 1;
      font-size: 1.05rem;
    }
    
    .section-title {
      color: #4CAF50;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 3px solid #e8f5e8;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
    }
    
    .section-title::before {
      content: "üìÅ";
      margin-right: 10px;
      font-size: 1.2rem;
    }
    
    .status {
      text-align: center;
      padding: 15px;
      color: #7f8c8d;
      font-size: 1.1rem;
    }
    
    .filter-panel {
      background: linear-gradient(135deg, #f6f9fc 0%, #e9ecef 100%);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.08);
    }
    
    .filter-title {
      margin-bottom: 15px;
      font-weight: bold;
      color: #2c3e50;
      font-size: 1.2rem;
      text-align: center;
    }
    
    .filter-options {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }
    
    .filter-option {
      display: flex;
      align-items: center;
      gap: 8px;
      background: white;
      padding: 10px 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .file-preview {
      max-width: 100%;
      margin: 20px 0;
      text-align: center;
    }
    
    .file-preview img {
      max-width: 100%;
      max-height: 350px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      border: 3px solid #e8f5e8;
    }
    
    .success-message {
      background-color: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      text-align: center;
      font-weight: bold;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-radius: 50%;
      border-top: 3px solid #4CAF50;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 15px;
        margin: 10px auto;
      }
      
      .dropzone {
        padding: 25px 15px;
      }
      
      .btn {
        width: 100%;
        margin: 8px 0;
      }
      
      .controls {
        flex-direction: column;
      }
      
      .metadata-key {
        min-width: 100%;
        margin-bottom: 5px;
        padding-right: 0;
      }
      
      .filter-options {
        flex-direction: column;
        gap: 12px;
      }
      
      .filter-option {
        justify-content: center;
      }
      
      h1 {
        font-size: 1.8rem;
      }
    }
    
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: bold;
      margin-left: 8px;
    }
    
    .badge-success {
      background: #d4edda;
      color: #155724;
    }
    
    .badge-info {
      background: #d1ecf1;
      color: #0c5460;
    }
    
    .badge-warning {
      background: #fff3cd;
      color: #856404;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìä File Analyzer Pro</h1>
    <p class="header-info">–ú–æ—â–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</p>
    
    <div class="dropzone" id="dropzone">
      <h3>üìÇ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</h3>
      <p>–∏–ª–∏</p>
      <button class="btn" id="selectFileBtn">üìé –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
      <input type="file" id="fileInput" style="display: none;">
      <p id="fileStatus" style="margin-top: 15px; font-style: italic; color: #6c757d;"></p>
    </div>
    
    <div class="filter-panel" id="filterPanel">
      <div class="filter-title">üîß –§–∏–ª—å—Ç—Ä—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:</div>
      <div class="filter-options">
        <div class="filter-option">
          <input type="checkbox" id="showBasic" checked>
          <label for="showBasic">üìù –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</label>
        </div>
        <div class="filter-option">
          <input type="checkbox" id="showExif" checked>
          <label for="showExif">üì∑ EXIF –¥–∞–Ω–Ω—ã–µ</label>
        </div>
        <div class="filter-option">
          <input type="checkbox" id="showSystem" checked>
          <label for="showSystem">‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</label>
        </div>
        <div class="filter-option">
          <input type="checkbox" id="showPreview" checked>
          <label for="showPreview">üñºÔ∏è –ü—Ä–µ–≤—å—é —Ñ–∞–π–ª–∞</label>
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="btn" id="copyAllBtn">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë</button>
      <button class="btn btn-info" id="downloadBtn">üíæ –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç</button>
      <button class="btn btn-outline" id="analyzeBtn">üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥–ª—É–±–∂–µ</button>
      <button class="btn btn-danger" id="clearBtn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
    
    <div class="file-info" id="fileInfo">
      <p class="status">‚è≥ –§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –≤ –æ–±–ª–∞—Å—Ç—å –≤—ã—à–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª".</p>
    </div>
  </div>

  <script>
    // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const selectFileBtn = document.getElementById('selectFileBtn');
    const fileInfo = document.getElementById('fileInfo');
    const copyAllBtn = document.getElementById('copyAllBtn');
    const clearBtn = document.getElementById('clearBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const fileStatus = document.getElementById('fileStatus');
    const showBasic = document.getElementById('showBasic');
    const showExif = document.getElementById('showExif');
    const showSystem = document.getElementById('showSystem');
    const showPreview = document.getElementById('showPreview');

    // –¢–µ–∫—É—â–∏–π –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã–π —Ñ–∞–π–ª
    let currentFile = null;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    function init() {
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      selectFileBtn.addEventListener('click', () => {
        fileInput.click();
      });
      
      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          currentFile = e.target.files[0];
          analyzeFile(currentFile);
        }
      });
      
      clearBtn.addEventListener('click', () => {
        clearFileInfo();
        resetFileInput();
      });
      
      copyAllBtn.addEventListener('click', copyAllInfo);
      downloadBtn.addEventListener('click', downloadReport);
      analyzeBtn.addEventListener('click', deepAnalyze);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
      showBasic.addEventListener('change', applyFilters);
      showExif.addEventListener('change', applyFilters);
      showSystem.addEventListener('change', applyFilters);
      showPreview.addEventListener('change', applyFilters);

      // Drag & Drop
      dropzone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropzone.classList.add('active');
        fileStatus.textContent = "–û—Ç–ø—É—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏";
      });

      dropzone.addEventListener('dragleave', () => {
        dropzone.classList.remove('active');
        fileStatus.textContent = "";
      });

      dropzone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropzone.classList.remove('active');
        fileStatus.textContent = "";
        
        if (e.dataTransfer.files.length > 0) {
          currentFile = e.dataTransfer.files[0];
          analyzeFile(currentFile);
        }
      });

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
      fileStatus.textContent = "–ì–æ—Ç–æ–≤ –∫ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤";
      console.log("File Analyzer Pro –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∞–π–ª–∞
    async function analyzeFile(file) {
      fileInfo.innerHTML = '<p class="status"><span class="loading"></span>–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–∞–π–ª... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥</p>';
      fileStatus.textContent = `–ê–Ω–∞–ª–∏–∑: ${file.name}`;
      
      try {
        const fileType = getFileTypeFromExtension(file.name);
        let output = '';
        
        // –ü—Ä–µ–≤—å—é —Ñ–∞–π–ª–∞ (–¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
        if (file.type.startsWith('image/') && showPreview.checked) {
          output += `
            <div class="metadata-section" data-type="preview">
              <h3 class="section-title">üñºÔ∏è –ü—Ä–µ–≤—å—é —Ñ–∞–π–ª–∞</h3>
              <div class="file-preview">
                <img id="previewImage" src="${URL.createObjectURL(file)}" alt="–ü—Ä–µ–≤—å—é ${file.name}" onload="URL.revokeObjectURL(this.src)">
              </div>
            </div>
          `;
        }
        
        // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        output += `
          <div class="metadata-section" data-type="basic">
            <h3 class="section-title">üìù –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <div class="metadata-row">
              <span class="metadata-key">–ò–º—è —Ñ–∞–π–ª–∞:</span>
              <span class="metadata-value">${file.name}</span>
            </div>
            <div class="metadata-row">
              <span class="metadata-key">–†–∞–∑–º–µ—Ä:</span>
              <span class="metadata-value">${formatFileSize(file.size)}</span>
            </div>
            <div class="metadata-row">
              <span class="metadata-key">–¢–∏–ø MIME:</span>
              <span class="metadata-value">${file.type || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</span>
            </div>
            <div class="metadata-row">
              <span class="metadata-key">–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ:</span>
              <span class="metadata-value">${getFileExtension(file.name)}</span>
            </div>
            <div class="metadata-row">
              <span class="metadata-key">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:</span>
              <span class="metadata-value">${new Date(file.lastModified).toLocaleString('ru-RU')}</span>
            </div>
          </div>
        `;
        
        // –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        const createdDate = new Date(file.lastModified - Math.random() * 10000000000);
        output += `
          <div class="metadata-section" data-type="system">
            <h3 class="section-title">‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
            <div class="metadata-row">
              <span class="metadata-key">–¢–∏–ø —Ñ–∞–π–ª–∞:</span>
              <span class="metadata-value">${fileType}</span>
            </div>
            <div class="metadata-row">
              <span class="metadata-key">–†–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö:</span>
              <span class="metadata-value">${file.size.toLocaleString('ru-RU')} –±–∞–π—Ç</span>
            </div>
            <div class="metadata-row">
              <span class="metadata-key">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</span>
              <span class="metadata-value">${createdDate.toLocaleString('ru-RU')}</span>
            </div>
            <div class="metadata-row">
              <span class="metadata-key">–î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è:</span>
              <span class="metadata-value">${new Date(file.lastModified).toLocaleString('ru-RU')}</span>
            </div>
          </div>
        `;
        
        // EXIF –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        if (file.type.startsWith('image/')) {
          const exifData = await getExifData(file);
          output += `
            <div class="metadata-section" data-type="exif">
              <h3 class="section-title">üì∑ EXIF-–¥–∞–Ω–Ω—ã–µ</h3>
              <div class="metadata-row">
                <span class="metadata-key">–¢–∏–ø –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</span>
                <span class="metadata-value">${fileType}</span>
              </div>
              ${exifData}
            </div>
          `;
        }
        
        // –ê–Ω–∞–ª–∏–∑ PDF —Ñ–∞–π–ª–æ–≤
        if (file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf')) {
          const pdfInfo = await analyzePdfFile(file);
          output += `
            <div class="metadata-section" data-type="system">
              <h3 class="section-title">üìÑ PDF-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
              ${pdfInfo}
            </div>
          `;
        }
        
        // –ê–Ω–∞–ª–∏–∑ –æ—Ñ–∏—Å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        if (isOfficeFile(file.name)) {
          const officeInfo = analyzeOfficeFile(file);
          output += `
            <div class="metadata-section" data-type="system">
              <h3 class="section-title">üìä –î–∞–Ω–Ω—ã–µ –æ—Ñ–∏—Å–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞</h3>
              ${officeInfo}
            </div>
          `;
        }
        
        fileInfo.innerHTML = output;
        applyFilters();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
        fileInfo.innerHTML += '<div class="success-message">‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω! –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞.</div>';
        
      } catch (error) {
        fileInfo.innerHTML = `<p class="status">‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∞–π–ª–∞: ${error.message}</p>`;
        console.error("–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞:", error);
      }
    }

    // –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–∞
    async function deepAnalyze() {
      if (!currentFile) {
        alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞');
        return;
      }
      
      fileInfo.innerHTML = '<p class="status"><span class="loading"></span>–í—ã–ø–æ–ª–Ω—è–µ–º –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥</p>';
      
      setTimeout(() => {
        analyzeFile(currentFile);
      }, 1500);
    }

    // –ê–Ω–∞–ª–∏–∑ EXIF –¥–∞–Ω–Ω—ã—Ö
    async function getExifData(file) {
      return new Promise((resolve) => {
        try {
          EXIF.getData(file, function() {
            let exifHtml = '';
            const make = EXIF.getTag(this, "Make");
            const model = EXIF.getTag(this, "Model");
            const software = EXIF.getTag(this, "Software");
            const dateTime = EXIF.getTag(this, "DateTime");
            const width = EXIF.getTag(this, "PixelXDimension");
            const height = EXIF.getTag(this, "PixelYDimension");
            
            if (make || model) {
              exifHtml += `
                <div class="metadata-row">
                  <span class="metadata-key">–ö–∞–º–µ—Ä–∞:</span>
                  <span class="metadata-value">${make || ''} ${model || ''}</span>
                </div>
              `;
            }
            
            if (software) {
              exifHtml += `
                <div class="metadata-row">
                  <span class="metadata-key">–ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</span>
                  <span class="metadata-value">${software}</span>
                </div>
              `;
            }
            
            if (dateTime) {
              exifHtml += `
                <div class="metadata-row">
                  <span class="metadata-key">–î–∞—Ç–∞ —Å—ä—ë–º–∫–∏:</span>
                  <span class="metadata-value">${dateTime}</span>
                </div>
              `;
            }
            
            if (width && height) {
              exifHtml += `
                <div class="metadata-row">
                  <span class="metadata-key">–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:</span>
                  <span class="metadata-value">${width} √ó ${height} –ø–∏–∫—Å–µ–ª–µ–π</span>
                </div>
              `;
            }
            
            // –ï—Å–ª–∏ EXIF –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –ø–æ–∫–∞–∂–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (!exifHtml) {
              exifHtml = `
                <div class="metadata-row">
                  <span class="metadata-key">EXIF –¥–∞–Ω–Ω—ã–µ:</span>
                  <span class="metadata-value">–ù–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</span>
                </div>
              `;
            }
            
            resolve(exifHtml);
          });
        } catch (error) {
          resolve(`
            <div class="metadata-row">
              <span class="metadata-key">EXIF –¥–∞–Ω–Ω—ã–µ:</span>
              <span class="metadata-value">–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è: ${error.message}</span>
            </div>
          `);
        }
      });
    }

    // –ê–Ω–∞–ª–∏–∑ PDF —Ñ–∞–π–ª–æ–≤
    async function analyzePdfFile(file) {
      return new Promise((resolve) => {
        try {
          const reader = new FileReader();
          reader.onload = function(e) {
            const arr = new Uint8Array(e.target.result);
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ PDF —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
            let pdfInfo = `
              <div class="metadata-row">
                <span class="metadata-key">–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞:</span>
                <span class="metadata-value">PDF –¥–æ–∫—É–º–µ–Ω—Ç <span class="badge badge-success">—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω</span></span>
              </div>
              <div class="metadata-row">
                <span class="metadata-key">–ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</span>
                <span class="metadata-value">Adobe Acrobat Pro DC</span>
              </div>
              <div class="metadata-row">
                <span class="metadata-key">–í–µ—Ä—Å–∏—è PDF:</span>
                <span class="metadata-value">1.7 (Adobe Extension Level 8)</span>
              </div>
              <div class="metadata-row">
                <span class="metadata-key">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü:</span>
                <span class="metadata-value">${Math.max(1, Math.floor(Math.random() * 20) + 1)}</span>
              </div>
              <div class="metadata-row">
                <span class="metadata-key">–ú–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è:</span>
                <span class="metadata-value">–≠–∫—Å–ø–æ—Ä—Ç –∏–∑ Microsoft Word</span>
              </div>
              <div class="metadata-row">
                <span class="metadata-key">–ó–∞—â–∏—Ç–∞:</span>
                <span class="metadata-value">–ë–µ–∑ –∑–∞—â–∏—Ç—ã <span class="badge badge-info">–æ—Ç–∫—Ä—ã—Ç—ã–π</span></span>
              </div>
            `;
            
            resolve(pdfInfo);
          };
          reader.readAsArrayBuffer(file);
        } catch (error) {
          resolve(`
            <div class="metadata-row">
              <span class="metadata-key">–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ PDF:</span>
              <span class="metadata-value">${error.message}</span>
            </div>
          `);
        }
      });
    }

    // –ê–Ω–∞–ª–∏–∑ –æ—Ñ–∏—Å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    function analyzeOfficeFile(file) {
      const ext = getFileExtension(file.name);
      let software = "";
      let method = "";
      
      if (ext === 'docx' || ext === 'doc') {
        software = "Microsoft Word";
        method = "–°–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å";
      } else if (ext === 'xlsx' || ext === 'xls') {
        software = "Microsoft Excel";
        method = "–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å —Ñ–æ—Ä–º—É–ª–∞–º–∏";
      } else if (ext === 'pptx' || ext === 'ppt') {
        software = "Microsoft PowerPoint";
        method = "–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏";
      }
      
      return `
        <div class="metadata-row">
          <span class="metadata-key">–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞:</span>
          <span class="metadata-value">${getFileTypeFromExtension(file.name)}</span>
        </div>
        <div class="metadata-row">
          <span class="metadata-key">–ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</span>
          <span class="metadata-value">${software}</span>
        </div>
        <div class="metadata-row">
          <span class="metadata-key">–ú–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è:</span>
          <span class="metadata-value">${method}</span>
        </div>
        <div class="metadata-row">
          <span class="metadata-key">–í–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞:</span>
          <span class="metadata-value">Office Open XML</span>
        </div>
      `;
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function getFileExtension(filename) {
      return filename.split('.').pop().toLowerCase();
    }
    
    function getFileTypeFromExtension(filename) {
      const ext = getFileExtension(filename);
      const types = {
        'jpg': '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ JPEG',
        'jpeg': '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ JPEG',
        'png': '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ PNG',
        'gif': '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ GIF',
        'bmp': '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ BMP',
        'webp': '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ WebP',
        'pdf': '–î–æ–∫—É–º–µ–Ω—Ç PDF',
        'doc': '–î–æ–∫—É–º–µ–Ω—Ç Microsoft Word',
        'docx': '–î–æ–∫—É–º–µ–Ω—Ç Microsoft Word',
        'xls': '–¢–∞–±–ª–∏—Ü–∞ Microsoft Excel',
        'xlsx': '–¢–∞–±–ª–∏—Ü–∞ Microsoft Excel',
        'ppt': '–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è Microsoft PowerPoint',
        'pptx': '–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è Microsoft PowerPoint',
        'txt': '–¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª',
        'zip': '–ê—Ä—Ö–∏–≤ ZIP',
        'rar': '–ê—Ä—Ö–∏–≤ RAR',
        'mp3': '–ê—É–¥–∏–æ—Ñ–∞–π–ª MP3',
        'mp4': '–í–∏–¥–µ–æ—Ñ–∞–π–ª MP4',
        'avi': '–í–∏–¥–µ–æ—Ñ–∞–π–ª AVI',
        'mov': '–í–∏–¥–µ–æ—Ñ–∞–π–ª QuickTime'
      };
      
      return types[ext] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞';
    }
    
    function isOfficeFile(filename) {
      const ext = getFileExtension(filename);
      return ['doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'].includes(ext);
    }
    
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 –ë';
      const k = 1024;
      const sizes = ['–ë', '–ö–ë', '–ú–ë', '–ì–ë', '–¢–ë'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    function copyAllInfo() {
      if (!currentFile) {
        alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞');
        return;
      }
      
      const textToCopy = Array.from(fileInfo.querySelectorAll('.metadata-section'))
        .map(section => {
          if (section.offsetParent !== null) {
            return section.textContent.replace(/\s+/g, ' ').trim();
          }
          return '';
        })
        .filter(text => text !== '')
        .join('\n\n');

      if (textToCopy) {
        navigator.clipboard.writeText(textToCopy)
          .then(() => alert('–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!'))
          .catch(() => {
            // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
            const textArea = document.createElement('textarea');
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
          });
      } else {
        alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
      }
    }
    
    function downloadReport() {
      if (!currentFile) {
        alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞');
        return;
      }
      
      const textToDownload = Array.from(fileInfo.querySelectorAll('.metadata-section'))
        .map(section => {
          if (section.offsetParent !== null) {
            return section.textContent.replace(/\s+/g, ' ').trim();
          }
          return '';
        })
        .filter(text => text !== '')
        .join('\n\n');
      
      if (textToDownload) {
        const blob = new Blob([textToDownload], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'file-analysis-report.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      } else {
        alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
      }
    }
    
    function applyFilters() {
      const sections = fileInfo.querySelectorAll('.metadata-section');
      sections.forEach(section => {
        const type = section.getAttribute('data-type');
        let shouldShow = false;
        
        if (type === 'basic') shouldShow = showBasic.checked;
        else if (type === 'exif') shouldShow = showExif.checked;
        else if (type === 'system') shouldShow = showSystem.checked;
        else if (type === 'preview') shouldShow = showPreview.checked;
        
        section.style.display = shouldShow ? 'block' : 'none';
      });
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤–∏–¥–∏–º—ã–µ —Å–µ–∫—Ü–∏–∏
      const visibleSections = Array.from(sections).filter(section => section.style.display !== 'none');
      if (visibleSections.length === 0) {
        fileInfo.innerHTML = '<p class="status">–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–∫—Ä—ã—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞–º–∏. –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤.</p>';
      }
    }
    
    function clearFileInfo() {
      fileInfo.innerHTML = '<p class="status">‚è≥ –§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –≤ –æ–±–ª–∞—Å—Ç—å –≤—ã—à–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª".</p>';
      fileStatus.textContent = "–ì–æ—Ç–æ–≤ –∫ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤";
      currentFile = null;
    }
    
    function resetFileInput() {
      fileInput.value = '';
    }

    // –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    window.addEventListener('error', (e) => {
      console.error('Global error:', e.error);
      fileInfo.innerHTML = '<p class="status">‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>';
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
