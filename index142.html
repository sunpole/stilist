<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Типография: Бизнес-симулятор 142-DEEP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --bs-primary: #0d6efd;
            --bs-success: #198754;
            --bs-warning: #ffc107;
            --bs-danger: #dc3545;
            --bs-info: #0dcaf0;
        }
        
        body {
            background: #f8f9fa;
            font-family: 'Segoe UI', system-ui, sans-serif;
            padding: 5px;
        }
        
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .stat-card {
            transition: all 0.2s;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }
        
        .building-grid {
            display: grid;
            gap: 3px;
            background: #e9ecef;
            padding: 5px;
            border-radius: 6px;
            border: 2px solid #dee2e6;
            margin-bottom: 10px;
        }
        
        .grid-cell {
            background: white;
            aspect-ratio: 1;
            border: 1px solid #adb5bd;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .grid-cell.available {
            background: #d1ecf1;
            border-color: #0dcaf0;
            border-style: dashed;
        }
        
        .grid-cell.available:hover {
            background: #bee5eb;
        }
        
        .grid-cell.unavailable {
            background: #f8f9fa;
            border-color: #dee2e6;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .equipment {
            width: 90%;
            height: 90%;
            border-radius: 3px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.6rem;
            text-align: center;
            padding: 2px;
            font-weight: 500;
        }
        
        .equipment.production { background: linear-gradient(135deg, #dc3545, #c82333); }
        .equipment.storage { background: linear-gradient(135deg, #fd7e14, #e55a00); }
        .equipment.advertising { background: linear-gradient(135deg, #198754, #146c43); }
        .equipment.quality { background: linear-gradient(135deg, #0dcaf0, #0992b7); }
        
        .equipment.broken {
            opacity: 0.7;
            background: linear-gradient(135deg, #6c757d, #495057) !important;
        }
        
        .equipment.broken::after {
            content: "⚡";
            position: absolute;
            top: 1px;
            right: 1px;
            font-size: 0.5rem;
        }
        
        .production-animation {
            animation: produce 0.5s ease-in-out;
        }
        
        @keyframes produce {
            0% { background-color: rgba(25, 135, 84, 0.3); }
            100% { background-color: transparent; }
        }
        
        .orders-queue {
            max-height: 150px;
            overflow-y: auto;
        }
        
        /* Адаптивность для мобильных устройств */
        @media (max-width: 768px) {
            body {
                font-size: 14px;
                padding: 3px;
            }
            
            .stat-card {
                margin-bottom: 5px;
                padding: 0.5rem;
            }
            
            .stat-value {
                font-size: 0.9rem;
            }
            
            .btn {
                padding: 5px 8px;
                font-size: 13px;
                margin-bottom: 3px;
            }
            
            .building-grid {
                gap: 2px;
                padding: 3px;
            }
            
            .equipment {
                font-size: 0.5rem;
            }
        }
        
        @media (max-width: 480px) {
            body {
                font-size: 12px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-content {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid game-container">
        <!-- Header -->
        <nav class="navbar navbar-light bg-light mb-2 p-2 rounded">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1">
                    <i class="bi bi-printer-fill text-primary me-2"></i>
                    Типография Pro
                </span>
                <div class="navbar-text">
                    <div class="h4 text-success mb-0" id="money">1,000 ₽</div>
                    <small class="text-muted" id="building-level">Квартира • Уровень 1</small>
                </div>
            </div>
        </nav>

        <!-- Stats Dashboard -->
        <div class="row g-1 mb-2">
            <div class="col-6 col-md-4 col-lg-2">
                <div class="card stat-card">
                    <div class="card-body text-center p-2">
                        <div class="h5 text-primary mb-0" id="stat-materials">0/100</div>
                        <small class="text-muted">Материалы</small>
                        <div class="progress mt-1" style="height: 4px;">
                            <div id="materials-bar" class="progress-bar bg-primary" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <div class="card stat-card">
                    <div class="card-body text-center p-2">
                        <div class="h5 text-warning mb-0" id="stat-orders">0</div>
                        <small class="text-muted">Заказы в работе</small>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <div class="card stat-card">
                    <div class="card-body text-center p-2">
                        <div class="h5 text-success mb-0" id="stat-income">0/мин</div>
                        <small class="text-muted">Доход</small>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <div class="card stat-card">
                    <div class="card-body text-center p-2">
                        <div class="h5 text-info mb-0" id="stat-ad">100%</div>
                        <small class="text-muted">Реклама</small>
                        <div class="progress mt-1" style="height: 4px;">
                            <div id="ad-bar" class="progress-bar bg-info" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <div class="card stat-card">
                    <div class="card-body text-center p-2">
                        <div class="h5 text-success mb-0" id="stat-quality">100%</div>
                        <small class="text-muted">Качество</small>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <div class="card stat-card">
                    <div class="card-body text-center p-2">
                        <div class="h5 text-danger mb-0" id="stat-risk">0%</div>
                        <small class="text-muted">Риск поломки</small>
                        <div class="progress mt-1" style="height: 4px;">
                            <div id="risk-bar" class="progress-bar bg-warning" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Crisis Alert -->
        <div class="row mb-2" id="crisis-alert" style="display: none;">
            <div class="col-12">
                <div class="alert alert-danger text-center py-2">
                    <h5 class="mb-1"><i class="bi bi-exclamation-triangle-fill me-2"></i>КРИЗИС!</h5>
                    <p class="mb-0" id="crisis-message"></p>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Left Column -->
            <div class="col-lg-8">
                <!-- Building Grid -->
                <div class="card stat-card mb-2">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5 class="card-title mb-0" id="current-building">Квартира</h5>
                            <button class="btn btn-warning btn-sm" id="upgrade-btn" onclick="upgradeBuilding()" disabled>
                                <i class="bi bi-arrow-up-circle me-1"></i>
                                Улучшить
                                <small id="upgrade-cost">75,000 ₽</small>
                            </button>
                        </div>
                        <div class="building-grid" id="building-grid"></div>
                    </div>
                </div>

                <!-- Control Panel -->
                <div class="card stat-card mb-2">
                    <div class="card-body">
                        <h5 class="card-title mb-2">Управление производством</h5>
                        <div class="row g-1">
                            <div class="col-6 col-md-3">
                                <button class="btn btn-primary w-100 btn-sm" onclick="buyMaterials()" 
                                        title="Закупить материалы для производства">
                                    <i class="bi bi-box-seam me-1"></i>
                                    Закупить
                                    <small class="d-block">10 ₽/ед.</small>
                                </button>
                            </div>
                            <div class="col-6 col-md-3">
                                <button class="btn btn-success w-100 btn-sm" onclick="shipOrders()" 
                                        title="Отгрузить готовые заказы и получить оплату">
                                    <i class="bi bi-truck me-1"></i>
                                    Отгрузить
                                    <small class="d-block" id="ship-value">0 ₽</small>
                                </button>
                            </div>
                            <div class="col-6 col-md-3">
                                <button class="btn btn-warning w-100 btn-sm" onclick="launchAdvertising()" 
                                        title="Запустить рекламную кампанию для привлечения клиентов">
                                    <i class="bi bi-megaphone me-1"></i>
                                    Реклама
                                    <small class="d-block" id="ad-cost">500 ₽</small>
                                </button>
                            </div>
                            <div class="col-6 col-md-3">
                                <button class="btn btn-info w-100 btn-sm" onclick="findOrders()" 
                                        title="Активно искать новые заказы">
                                    <i class="bi bi-search me-1"></i>
                                    Поиск заказов
                                    <small class="d-block" id="find-cost">100 ₽</small>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Orders Queue -->
                <div class="card stat-card">
                    <div class="card-body">
                        <h5 class="card-title mb-2">Очередь заказов</h5>
                        <div class="orders-queue" id="orders-queue">
                            <div class="text-muted text-center">Нет активных заказов</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-lg-4">
                <!-- Equipment Shop -->
                <div class="card stat-card mb-2">
                    <div class="card-body">
                        <h5 class="card-title mb-2">Магазин оборудования</h5>
                        <div class="mb-2">
                            <div class="btn-group w-100" role="group">
                                <button type="button" class="btn btn-outline-primary btn-sm active" onclick="setEquipmentCategory('all')">Все</button>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="setEquipmentCategory('production')">Производство</button>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="setEquipmentCategory('storage')">Склад</button>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="setEquipmentCategory('advertising')">Реклама</button>
                            </div>
                        </div>
                        <div id="equipment-shop"></div>
                    </div>
                </div>

                <!-- Production Stats -->
                <div class="card stat-card">
                    <div class="card-body">
                        <h5 class="card-title mb-2">Статистика производства</h5>
                        <div class="row text-center">
                            <div class="col-6 mb-2">
                                <div class="text-primary">
                                    <i class="bi bi-printer fs-4"></i>
                                    <div class="h6 mt-1" id="stat-production">0</div>
                                    <small>Производство/мин</small>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="text-success">
                                    <i class="bi bi-graph-up fs-4"></i>
                                    <div class="h6 mt-1" id="stat-multiplier">1.0x</div>
                                    <small>Множитель цены</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-warning">
                                    <i class="bi bi-box fs-4"></i>
                                    <div class="h6 mt-1" id="stat-storage">100</div>
                                    <small>Вместимость склада</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-info">
                                    <i class="bi bi-star fs-4"></i>
                                    <div class="h6 mt-1" id="stat-total-quality">100%</div>
                                    <small>Качество продукции</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Equipment Modal -->
    <div class="modal fade" id="equipmentModal" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Выбор оборудования</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-2" id="modal-location">Клетка: 0,0</p>
                    <div id="equipment-options"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="productionToast" class="toast" role="alert">
            <div class="toast-body" id="production-toast-body"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // ==================== БАЛАНС И НАСТРОЙКИ ====================
        const BALANCE = {
            // Экономика
            BASE_ORDER_PRICE: 50,
            MATERIAL_COST: 10,
            AD_COST: 500,
            FIND_ORDERS_COST: 100,
            
            // Производство
            BASE_PRODUCTION_SPEED: 1, // Единиц в минуту
            ORGANIC_ORDERS_RATE: 0.1, // Шанс появления заказа в секунду
            AD_EFFECT_DECAY: 0.05, // Снижение эффекта рекламы в секунду
            
            // Здания
            UPGRADE_COSTS: {
                apartment: 75000,
                salon: 1000000
            },
            
            // Оборудование
            EQUIPMENT: {
                'small_printer': { 
                    name: 'Мал. принтер', 
                    type: 'production', 
                    price: 200, 
                    production: 2,
                    description: 'Базовый принтер для мелких заказов',
                    breakdownRisk: 0.01
                },
                'paper_shelf': { 
                    name: 'Полка', 
                    type: 'storage', 
                    price: 100, 
                    storage: 50,
                    description: 'Увеличивает вместимость склада',
                    breakdownRisk: 0.005
                },
                'flyer_table': { 
                    name: 'Стол', 
                    type: 'advertising', 
                    price: 150, 
                    advertising: 0.1,
                    description: 'Привлекает местных клиентов',
                    breakdownRisk: 0.008
                }
            }
        };

        // ==================== ИГРОВОЕ СОСТОЯНИЕ ====================
        const gameState = {
            money: 1000,
            materials: 0,
            currentOrders: 0,
            advertisingEffect: 0.0,
            qualityMultiplier: 1.0,
            currentBuilding: 'apartment',
            selectedCell: null,
            selectedEquipment: null,
            equipmentCategory: 'all',
            brokenEquipment: [],
            activeCrisis: null,
            crisisCooldown: 0,
            totalProduced: 0,
            totalShipped: 0,
            lastUpdate: Date.now(),
            productionAccumulator: 0, // Аккумулятор для дробного производства
            organicOrdersTimer: 0,
            
            buildings: {
                apartment: {
                    name: "Квартира",
                    width: 4,
                    height: 4,
                    baseCapacity: 100,
                    equipment: [],
                    upgradeCost: BALANCE.UPGRADE_COSTS.apartment,
                    level: 1,
                    availableEquipment: ['small_printer', 'paper_shelf', 'flyer_table'],
                    availableCells: [[0,0], [0,1], [1,0], [1,1]]
                },
                salon: {
                    name: "Салон печати",
                    width: 6,
                    height: 6,
                    baseCapacity: 500,
                    equipment: [],
                    upgradeCost: BALANCE.UPGRADE_COSTS.salon,
                    level: 2,
                    availableEquipment: ['small_printer', 'paper_shelf', 'flyer_table'],
                    availableCells: 'all'
                },
                printing_house: {
                    name: "Типография",
                    width: 8,
                    height: 8,
                    baseCapacity: 2000,
                    equipment: [],
                    upgradeCost: null,
                    level: 3,
                    availableEquipment: ['small_printer', 'paper_shelf', 'flyer_table'],
                    availableCells: 'all'
                }
            }
        };

        // ==================== ОСНОВНЫЕ ФУНКЦИИ ИГРЫ ====================

        function initGame() {
            renderBuilding();
            updateEquipmentShop();
            updateUI();
            startGameLoop();
            loadGame();
            
            console.log("🎮 Игра инициализирована. Производственный цикл запущен.");
        }

        function renderBuilding() {
            const building = gameState.buildings[gameState.currentBuilding];
            const grid = document.getElementById('building-grid');
            
            grid.innerHTML = '';
            grid.style.gridTemplateColumns = `repeat(${building.width}, 1fr)`;
            grid.style.gridTemplateRows = `repeat(${building.height}, 1fr)`;
            
            for (let y = 0; y < building.height; y++) {
                for (let x = 0; x < building.width; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    
                    const isAvailable = building.availableCells === 'all' || 
                        building.availableCells.some(([ax, ay]) => ax === x && ay === y);
                    
                    if (isAvailable) {
                        cell.classList.add('available');
                        cell.onclick = () => handleCellClick(x, y);
                    } else {
                        cell.classList.add('unavailable');
                    }
                    
                    grid.appendChild(cell);
                }
            }
            
            building.equipment.forEach(eq => {
                placeEquipment(eq);
            });
            
            updateBuildingInfo();
        }

        function placeEquipment(equipment) {
            const building = gameState.buildings[gameState.currentBuilding];
            const cellIndex = equipment.y * building.width + equipment.x;
            const cell = document.getElementById('building-grid').children[cellIndex];
            
            if (cell) {
                cell.classList.remove('available');
                cell.innerHTML = '';
                
                const eqElement = document.createElement('div');
                eqElement.className = `equipment ${equipment.type} ${equipment.broken ? 'broken' : ''}`;
                eqElement.innerHTML = `
                    <i class="bi ${getEquipmentIcon(equipment.type)}"></i>
                    <div>${equipment.name}</div>
                `;
                eqElement.onclick = (e) => {
                    e.stopPropagation();
                    showEquipmentInfo(equipment);
                };
                cell.appendChild(eqElement);
            }
        }

        // ==================== ИСПРАВЛЕННАЯ ЛОГИКА ПРОИЗВОДСТВА ====================

        function startGameLoop() {
            console.log("🔄 Запуск игрового цикла...");
            
            setInterval(() => {
                const now = Date.now();
                const deltaTime = (now - gameState.lastUpdate) / 1000; // В секундах
                gameState.lastUpdate = now;
                
                // Органическое появление заказов
                gameState.organicOrdersTimer += deltaTime;
                if (gameState.organicOrdersTimer >= 1) { // Каждую секунду
                    spawnOrganicOrders();
                    gameState.organicOrdersTimer = 0;
                }
                
                // ОСНОВНОЙ ПРОИЗВОДСТВЕННЫЙ ЦИКЛ - ИСПРАВЛЕН
                const productionPerSecond = getTotalProduction() / 60; // Производство в секунду
                gameState.productionAccumulator += productionPerSecond * deltaTime;
                
                // Преобразование накопленного производства в заказы
                const ordersToProduce = Math.floor(gameState.productionAccumulator);
                if (ordersToProduce > 0 && gameState.materials >= ordersToProduce) {
                    gameState.currentOrders += ordersToProduce;
                    gameState.materials -= ordersToProduce;
                    gameState.totalProduced += ordersToProduce;
                    gameState.productionAccumulator -= ordersToProduce;
                    
                    // Визуальная обратная связь
                    const buildingGrid = document.getElementById('building-grid');
                    buildingGrid.classList.add('production-animation');
                    setTimeout(() => {
                        buildingGrid.classList.remove('production-animation');
                    }, 500);
                }
                
                // Снижение эффекта рекламы
                gameState.advertisingEffect = Math.max(0, gameState.advertisingEffect - (BALANCE.AD_EFFECT_DECAY * deltaTime));
                
                // Проверка поломок оборудования (исправленная)
                const building = gameState.buildings[gameState.currentBuilding];
                building.equipment.forEach(eq => {
                    if (!eq.broken && Math.random() < (eq.breakdownRisk * deltaTime)) {
                        eq.broken = true;
                        showNotification(`Сломано оборудование: ${eq.name}`, 'warning');
                    }
                });
                
                updateUI();
                
            }, 100); // Обновление каждые 100ms для плавности
        }

        function spawnOrganicOrders() {
            const baseChance = BALANCE.ORGANIC_ORDERS_RATE;
            const adBonus = gameState.advertisingEffect * 0.5; // Реклама увеличивает шанс
            const totalChance = baseChance + adBonus;
            
            if (Math.random() < totalChance) {
                const orderCount = 1 + Math.floor(gameState.advertisingEffect * 2); // 1-3 заказа
                gameState.currentOrders += orderCount;
                showNotification(`Поступило новых заказов: ${orderCount}`, 'info');
            }
        }

        // ==================== ИГРОВЫЕ ДЕЙСТВИЯ ====================

        function buyMaterials() {
            const storageCapacity = getTotalStorage();
            const availableSpace = storageCapacity - gameState.materials;
            const maxAffordable = Math.min(availableSpace, Math.floor(gameState.money / BALANCE.MATERIAL_COST));
            
            if (maxAffordable > 0) {
                gameState.materials += maxAffordable;
                gameState.money -= maxAffordable * BALANCE.MATERIAL_COST;
                updateUI();
                
                showNotification(`Закуплено материалов: ${maxAffordable} ед.`, 'success');
            } else {
                showNotification('Недостаточно места или денег для закупки материалов!', 'danger');
            }
        }

        function shipOrders() {
            if (gameState.currentOrders === 0) {
                showNotification('Нет заказов для отгрузки!', 'warning');
                return;
            }
            
            const orderValue = calculateOrderValue();
            gameState.money += orderValue;
            gameState.totalShipped += gameState.currentOrders;
            
            showNotification(`Отгружено заказов: ${gameState.currentOrders} на сумму ${orderValue} ₽`, 'success');
            
            gameState.currentOrders = 0;
            updateUI();
        }

        function launchAdvertising() {
            if (gameState.money >= BALANCE.AD_COST) {
                gameState.money -= BALANCE.AD_COST;
                gameState.advertisingEffect = Math.min(1.0, gameState.advertisingEffect + 0.3);
                updateUI();
                
                showNotification('Рекламная кампания запущена! Эффективность увеличена.', 'success');
            } else {
                showNotification('Недостаточно денег для запуска рекламы!', 'danger');
            }
        }

        function findOrders() {
            if (gameState.money >= BALANCE.FIND_ORDERS_COST) {
                gameState.money -= BALANCE.FIND_ORDERS_COST;
                const foundOrders = 3 + Math.floor(Math.random() * 3); // 3-5 заказов
                gameState.currentOrders += foundOrders;
                updateUI();
                
                showNotification(`Найдено заказов: ${foundOrders}`, 'success');
            } else {
                showNotification('Недостаточно денег для поиска заказов!', 'danger');
            }
        }

        // ==================== РАСЧЕТЫ ХАРАКТЕРИСТИК ====================

        function getTotalProduction() {
            const building = gameState.buildings[gameState.currentBuilding];
            const baseProduction = BALANCE.BASE_PRODUCTION_SPEED;
            const equipmentBonus = building.equipment
                .filter(eq => eq.production && !eq.broken)
                .reduce((sum, eq) => sum + eq.production, 0);
            
            return baseProduction + equipmentBonus;
        }

        function getTotalStorage() {
            const building = gameState.buildings[gameState.currentBuilding];
            const baseStorage = building.baseCapacity;
            const bonusStorage = building.equipment
                .filter(eq => eq.storage && !eq.broken)
                .reduce((sum, eq) => sum + eq.storage, 0);
            return baseStorage + bonusStorage;
        }

        function calculateOrderValue() {
            const baseValue = gameState.currentOrders * BALANCE.BASE_ORDER_PRICE;
            const advertisingBonus = 1 + gameState.advertisingEffect;
            return Math.floor(baseValue * advertisingBonus * gameState.qualityMultiplier);
        }

        // ==================== ИНТЕРФЕЙС И ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ====================

        function updateUI() {
            // Основные показатели
            document.getElementById('money').textContent = gameState.money.toLocaleString('ru-RU') + ' ₽';
            document.getElementById('stat-materials').textContent = `${gameState.materials}/${getTotalStorage()}`;
            document.getElementById('stat-orders').textContent = gameState.currentOrders;
            document.getElementById('ship-value').textContent = calculateOrderValue().toLocaleString('ru-RU') + ' ₽';
            
            // Прогресс-бары
            const storagePercent = (gameState.materials / getTotalStorage()) * 100;
            document.getElementById('materials-bar').style.width = `${storagePercent}%`;
            
            document.getElementById('ad-bar').style.width = `${gameState.advertisingEffect * 100}%`;
            document.getElementById('stat-ad').textContent = `${Math.floor(gameState.advertisingEffect * 100)}%`;
            
            // Статистика
            document.getElementById('stat-production').textContent = getTotalProduction().toFixed(1);
            document.getElementById('stat-multiplier').textContent = (1 + gameState.advertisingEffect).toFixed(1) + 'x';
            document.getElementById('stat-storage').textContent = getTotalStorage();
            
            // Очередь заказов
            updateOrdersQueue();
            
            updateUpgradeButton();
            updateEquipmentShop();
            saveGame();
        }

        function updateOrdersQueue() {
            const queue = document.getElementById('orders-queue');
            if (gameState.currentOrders > 0) {
                queue.innerHTML = `
                    <div class="alert alert-info py-2">
                        <div class="d-flex justify-content-between">
                            <span>Заказов в работе:</span>
                            <strong>${gameState.currentOrders}</strong>
                        </div>
                        <div class="small text-muted">Стоимость отгрузки: ${calculateOrderValue()} ₽</div>
                    </div>
                `;
            } else {
                queue.innerHTML = '<div class="text-muted text-center">Нет активных заказов</div>';
            }
        }

        function showNotification(message, type = 'info') {
            const toastBody = document.getElementById('production-toast-body');
            toastBody.textContent = message;
            toastBody.className = `toast-body text-white bg-${type}`;
            new bootstrap.Toast(document.getElementById('productionToast'), { delay: 3000 }).show();
        }

        // ==================== ЗАПУСК ИГРЫ ====================

        window.onload = initGame;
    </script>
</body>
</html>
