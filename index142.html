<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢–∏–ø–æ–≥—Ä–∞—Ñ–∏—è: –ë–∏–∑–Ω–µ—Å-—Å–∏–º—É–ª—è—Ç–æ—Ä 142-DEEP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --bs-primary: #0d6efd;
            --bs-success: #198754;
            --bs-warning: #ffc107;
            --bs-danger: #dc3545;
            --bs-info: #0dcaf0;
        }
        
        body {
            background: #f8f9fa;
            font-family: 'Segoe UI', system-ui, sans-serif;
            padding: 5px;
        }
        
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .stat-card {
            transition: all 0.2s;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }
        
        .building-grid {
            display: grid;
            gap: 3px;
            background: #e9ecef;
            padding: 5px;
            border-radius: 6px;
            border: 2px solid #dee2e6;
            margin-bottom: 10px;
        }
        
        .grid-cell {
            background: white;
            aspect-ratio: 1;
            border: 1px solid #adb5bd;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .grid-cell.available {
            background: #d1ecf1;
            border-color: #0dcaf0;
            border-style: dashed;
        }
        
        .grid-cell.available:hover {
            background: #bee5eb;
        }
        
        .grid-cell.unavailable {
            background: #f8f9fa;
            border-color: #dee2e6;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .equipment {
            width: 90%;
            height: 90%;
            border-radius: 3px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.6rem;
            text-align: center;
            padding: 2px;
            font-weight: 500;
        }
        
        .equipment.production { background: linear-gradient(135deg, #dc3545, #c82333); }
        .equipment.storage { background: linear-gradient(135deg, #fd7e14, #e55a00); }
        .equipment.advertising { background: linear-gradient(135deg, #198754, #146c43); }
        .equipment.quality { background: linear-gradient(135deg, #0dcaf0, #0992b7); }
        
        .equipment.broken {
            opacity: 0.7;
            background: linear-gradient(135deg, #6c757d, #495057) !important;
        }
        
        .equipment.broken::after {
            content: "‚ö°";
            position: absolute;
            top: 1px;
            right: 1px;
            font-size: 0.5rem;
        }
        
        .production-animation {
            animation: produce 0.5s ease-in-out;
        }
        
        @keyframes produce {
            0% { background-color: rgba(25, 135, 84, 0.3); }
            100% { background-color: transparent; }
        }
        
        .orders-queue {
            max-height: 150px;
            overflow-y: auto;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            body {
                font-size: 14px;
                padding: 3px;
            }
            
            .stat-card {
                margin-bottom: 5px;
                padding: 0.5rem;
            }
            
            .stat-value {
                font-size: 0.9rem;
            }
            
            .btn {
                padding: 5px 8px;
                font-size: 13px;
                margin-bottom: 3px;
            }
            
            .building-grid {
                gap: 2px;
                padding: 3px;
            }
            
            .equipment {
                font-size: 0.5rem;
            }
        }
        
        @media (max-width: 480px) {
            body {
                font-size: 12px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-content {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid game-container">
        <!-- Header -->
        <nav class="navbar navbar-light bg-light mb-2 p-2 rounded">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1">
                    <i class="bi bi-printer-fill text-primary me-2"></i>
                    –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏—è Pro
                </span>
                <div class="navbar-text">
                    <div class="h4 text-success mb-0" id="money">1,000 ‚ÇΩ</div>
                    <small class="text-muted" id="building-level">–ö–≤–∞—Ä—Ç–∏—Ä–∞ ‚Ä¢ –£—Ä–æ–≤–µ–Ω—å 1</small>
                </div>
            </div>
        </nav>

        <!-- Stats Dashboard -->
        <div class="row g-1 mb-2">
            <div class="col-6 col-md-4 col-lg-2">
                <div class="card stat-card">
                    <div class="card-body text-center p-2">
                        <div class="h5 text-primary mb-0" id="stat-materials">0/100</div>
                        <small class="text-muted">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</small>
                        <div class="progress mt-1" style="height: 4px;">
                            <div id="materials-bar" class="progress-bar bg-primary" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <div class="card stat-card">
                    <div class="card-body text-center p-2">
                        <div class="h5 text-warning mb-0" id="stat-orders">0</div>
                        <small class="text-muted">–ó–∞–∫–∞–∑—ã –≤ —Ä–∞–±–æ—Ç–µ</small>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <div class="card stat-card">
                    <div class="card-body text-center p-2">
                        <div class="h5 text-success mb-0" id="stat-income">0/–º–∏–Ω</div>
                        <small class="text-muted">–î–æ—Ö–æ–¥</small>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <div class="card stat-card">
                    <div class="card-body text-center p-2">
                        <div class="h5 text-info mb-0" id="stat-ad">100%</div>
                        <small class="text-muted">–†–µ–∫–ª–∞–º–∞</small>
                        <div class="progress mt-1" style="height: 4px;">
                            <div id="ad-bar" class="progress-bar bg-info" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <div class="card stat-card">
                    <div class="card-body text-center p-2">
                        <div class="h5 text-success mb-0" id="stat-quality">100%</div>
                        <small class="text-muted">–ö–∞—á–µ—Å—Ç–≤–æ</small>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-lg-2">
                <div class="card stat-card">
                    <div class="card-body text-center p-2">
                        <div class="h5 text-danger mb-0" id="stat-risk">0%</div>
                        <small class="text-muted">–†–∏—Å–∫ –ø–æ–ª–æ–º–∫–∏</small>
                        <div class="progress mt-1" style="height: 4px;">
                            <div id="risk-bar" class="progress-bar bg-warning" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Crisis Alert -->
        <div class="row mb-2" id="crisis-alert" style="display: none;">
            <div class="col-12">
                <div class="alert alert-danger text-center py-2">
                    <h5 class="mb-1"><i class="bi bi-exclamation-triangle-fill me-2"></i>–ö–†–ò–ó–ò–°!</h5>
                    <p class="mb-0" id="crisis-message"></p>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Left Column -->
            <div class="col-lg-8">
                <!-- Building Grid -->
                <div class="card stat-card mb-2">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5 class="card-title mb-0" id="current-building">–ö–≤–∞—Ä—Ç–∏—Ä–∞</h5>
                            <button class="btn btn-warning btn-sm" id="upgrade-btn" onclick="upgradeBuilding()" disabled>
                                <i class="bi bi-arrow-up-circle me-1"></i>
                                –£–ª—É—á—à–∏—Ç—å
                                <small id="upgrade-cost">75,000 ‚ÇΩ</small>
                            </button>
                        </div>
                        <div class="building-grid" id="building-grid"></div>
                    </div>
                </div>

                <!-- Control Panel -->
                <div class="card stat-card mb-2">
                    <div class="card-body">
                        <h5 class="card-title mb-2">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ–º</h5>
                        <div class="row g-1">
                            <div class="col-6 col-md-3">
                                <button class="btn btn-primary w-100 btn-sm" onclick="buyMaterials()" 
                                        title="–ó–∞–∫—É–ø–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞">
                                    <i class="bi bi-box-seam me-1"></i>
                                    –ó–∞–∫—É–ø–∏—Ç—å
                                    <small class="d-block">10 ‚ÇΩ/–µ–¥.</small>
                                </button>
                            </div>
                            <div class="col-6 col-md-3">
                                <button class="btn btn-success w-100 btn-sm" onclick="shipOrders()" 
                                        title="–û—Ç–≥—Ä—É–∑–∏—Ç—å –≥–æ—Ç–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã –∏ –ø–æ–ª—É—á–∏—Ç—å –æ–ø–ª–∞—Ç—É">
                                    <i class="bi bi-truck me-1"></i>
                                    –û—Ç–≥—Ä—É–∑–∏—Ç—å
                                    <small class="d-block" id="ship-value">0 ‚ÇΩ</small>
                                </button>
                            </div>
                            <div class="col-6 col-md-3">
                                <button class="btn btn-warning w-100 btn-sm" onclick="launchAdvertising()" 
                                        title="–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–µ–∫–ª–∞–º–Ω—É—é –∫–∞–º–ø–∞–Ω–∏—é –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤">
                                    <i class="bi bi-megaphone me-1"></i>
                                    –†–µ–∫–ª–∞–º–∞
                                    <small class="d-block" id="ad-cost">500 ‚ÇΩ</small>
                                </button>
                            </div>
                            <div class="col-6 col-md-3">
                                <button class="btn btn-info w-100 btn-sm" onclick="findOrders()" 
                                        title="–ê–∫—Ç–∏–≤–Ω–æ –∏—Å–∫–∞—Ç—å –Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã">
                                    <i class="bi bi-search me-1"></i>
                                    –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤
                                    <small class="d-block" id="find-cost">100 ‚ÇΩ</small>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Orders Queue -->
                <div class="card stat-card">
                    <div class="card-body">
                        <h5 class="card-title mb-2">–û—á–µ—Ä–µ–¥—å –∑–∞–∫–∞–∑–æ–≤</h5>
                        <div class="orders-queue" id="orders-queue">
                            <div class="text-muted text-center">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-lg-4">
                <!-- Equipment Shop -->
                <div class="card stat-card mb-2">
                    <div class="card-body">
                        <h5 class="card-title mb-2">–ú–∞–≥–∞–∑–∏–Ω –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</h5>
                        <div class="mb-2">
                            <div class="btn-group w-100" role="group">
                                <button type="button" class="btn btn-outline-primary btn-sm active" onclick="setEquipmentCategory('all')">–í—Å–µ</button>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="setEquipmentCategory('production')">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</button>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="setEquipmentCategory('storage')">–°–∫–ª–∞–¥</button>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="setEquipmentCategory('advertising')">–†–µ–∫–ª–∞–º–∞</button>
                            </div>
                        </div>
                        <div id="equipment-shop"></div>
                    </div>
                </div>

                <!-- Production Stats -->
                <div class="card stat-card">
                    <div class="card-body">
                        <h5 class="card-title mb-2">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</h5>
                        <div class="row text-center">
                            <div class="col-6 mb-2">
                                <div class="text-primary">
                                    <i class="bi bi-printer fs-4"></i>
                                    <div class="h6 mt-1" id="stat-production">0</div>
                                    <small>–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ/–º–∏–Ω</small>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="text-success">
                                    <i class="bi bi-graph-up fs-4"></i>
                                    <div class="h6 mt-1" id="stat-multiplier">1.0x</div>
                                    <small>–ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ü–µ–Ω—ã</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-warning">
                                    <i class="bi bi-box fs-4"></i>
                                    <div class="h6 mt-1" id="stat-storage">100</div>
                                    <small>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–∫–ª–∞–¥–∞</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-info">
                                    <i class="bi bi-star fs-4"></i>
                                    <div class="h6 mt-1" id="stat-total-quality">100%</div>
                                    <small>–ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ü–∏–∏</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Equipment Modal -->
    <div class="modal fade" id="equipmentModal" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–í—ã–±–æ—Ä –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-2" id="modal-location">–ö–ª–µ—Ç–∫–∞: 0,0</p>
                    <div id="equipment-options"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="productionToast" class="toast" role="alert">
            <div class="toast-body" id="production-toast-body"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // ==================== –ë–ê–õ–ê–ù–° –ò –ù–ê–°–¢–†–û–ô–ö–ò ====================
        const BALANCE = {
            // –≠–∫–æ–Ω–æ–º–∏–∫–∞
            BASE_ORDER_PRICE: 50,
            MATERIAL_COST: 10,
            AD_COST: 500,
            FIND_ORDERS_COST: 100,
            
            // –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ
            BASE_PRODUCTION_SPEED: 1, // –ï–¥–∏–Ω–∏—Ü –≤ –º–∏–Ω—É—Ç—É
            ORGANIC_ORDERS_RATE: 0.1, // –®–∞–Ω—Å –ø–æ—è–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –≤ —Å–µ–∫—É–Ω–¥—É
            AD_EFFECT_DECAY: 0.05, // –°–Ω–∏–∂–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ —Ä–µ–∫–ª–∞–º—ã –≤ —Å–µ–∫—É–Ω–¥—É
            
            // –ó–¥–∞–Ω–∏—è
            UPGRADE_COSTS: {
                apartment: 75000,
                salon: 1000000
            },
            
            // –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
            EQUIPMENT: {
                'small_printer': { 
                    name: '–ú–∞–ª. –ø—Ä–∏–Ω—Ç–µ—Ä', 
                    type: 'production', 
                    price: 200, 
                    production: 2,
                    description: '–ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–Ω—Ç–µ—Ä –¥–ª—è –º–µ–ª–∫–∏—Ö –∑–∞–∫–∞–∑–æ–≤',
                    breakdownRisk: 0.01
                },
                'paper_shelf': { 
                    name: '–ü–æ–ª–∫–∞', 
                    type: 'storage', 
                    price: 100, 
                    storage: 50,
                    description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–∫–ª–∞–¥–∞',
                    breakdownRisk: 0.005
                },
                'flyer_table': { 
                    name: '–°—Ç–æ–ª', 
                    type: 'advertising', 
                    price: 150, 
                    advertising: 0.1,
                    description: '–ü—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –º–µ—Å—Ç–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤',
                    breakdownRisk: 0.008
                }
            }
        };

        // ==================== –ò–ì–†–û–í–û–ï –°–û–°–¢–û–Ø–ù–ò–ï ====================
        const gameState = {
            money: 1000,
            materials: 0,
            currentOrders: 0,
            advertisingEffect: 0.0,
            qualityMultiplier: 1.0,
            currentBuilding: 'apartment',
            selectedCell: null,
            selectedEquipment: null,
            equipmentCategory: 'all',
            brokenEquipment: [],
            activeCrisis: null,
            crisisCooldown: 0,
            totalProduced: 0,
            totalShipped: 0,
            lastUpdate: Date.now(),
            productionAccumulator: 0, // –ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä –¥–ª—è –¥—Ä–æ–±–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
            organicOrdersTimer: 0,
            
            buildings: {
                apartment: {
                    name: "–ö–≤–∞—Ä—Ç–∏—Ä–∞",
                    width: 4,
                    height: 4,
                    baseCapacity: 100,
                    equipment: [],
                    upgradeCost: BALANCE.UPGRADE_COSTS.apartment,
                    level: 1,
                    availableEquipment: ['small_printer', 'paper_shelf', 'flyer_table'],
                    availableCells: [[0,0], [0,1], [1,0], [1,1]]
                },
                salon: {
                    name: "–°–∞–ª–æ–Ω –ø–µ—á–∞—Ç–∏",
                    width: 6,
                    height: 6,
                    baseCapacity: 500,
                    equipment: [],
                    upgradeCost: BALANCE.UPGRADE_COSTS.salon,
                    level: 2,
                    availableEquipment: ['small_printer', 'paper_shelf', 'flyer_table'],
                    availableCells: 'all'
                },
                printing_house: {
                    name: "–¢–∏–ø–æ–≥—Ä–∞—Ñ–∏—è",
                    width: 8,
                    height: 8,
                    baseCapacity: 2000,
                    equipment: [],
                    upgradeCost: null,
                    level: 3,
                    availableEquipment: ['small_printer', 'paper_shelf', 'flyer_table'],
                    availableCells: 'all'
                }
            }
        };

        // ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò–ì–†–´ ====================

        function initGame() {
            renderBuilding();
            updateEquipmentShop();
            updateUI();
            startGameLoop();
            loadGame();
            
            console.log("üéÆ –ò–≥—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø—É—â–µ–Ω.");
        }

        function renderBuilding() {
            const building = gameState.buildings[gameState.currentBuilding];
            const grid = document.getElementById('building-grid');
            
            grid.innerHTML = '';
            grid.style.gridTemplateColumns = `repeat(${building.width}, 1fr)`;
            grid.style.gridTemplateRows = `repeat(${building.height}, 1fr)`;
            
            for (let y = 0; y < building.height; y++) {
                for (let x = 0; x < building.width; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    
                    const isAvailable = building.availableCells === 'all' || 
                        building.availableCells.some(([ax, ay]) => ax === x && ay === y);
                    
                    if (isAvailable) {
                        cell.classList.add('available');
                        cell.onclick = () => handleCellClick(x, y);
                    } else {
                        cell.classList.add('unavailable');
                    }
                    
                    grid.appendChild(cell);
                }
            }
            
            building.equipment.forEach(eq => {
                placeEquipment(eq);
            });
            
            updateBuildingInfo();
        }

        function placeEquipment(equipment) {
            const building = gameState.buildings[gameState.currentBuilding];
            const cellIndex = equipment.y * building.width + equipment.x;
            const cell = document.getElementById('building-grid').children[cellIndex];
            
            if (cell) {
                cell.classList.remove('available');
                cell.innerHTML = '';
                
                const eqElement = document.createElement('div');
                eqElement.className = `equipment ${equipment.type} ${equipment.broken ? 'broken' : ''}`;
                eqElement.innerHTML = `
                    <i class="bi ${getEquipmentIcon(equipment.type)}"></i>
                    <div>${equipment.name}</div>
                `;
                eqElement.onclick = (e) => {
                    e.stopPropagation();
                    showEquipmentInfo(equipment);
                };
                cell.appendChild(eqElement);
            }
        }

        // ==================== –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê –ü–†–û–ò–ó–í–û–î–°–¢–í–ê ====================

        function startGameLoop() {
            console.log("üîÑ –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞...");
            
            setInterval(() => {
                const now = Date.now();
                const deltaTime = (now - gameState.lastUpdate) / 1000; // –í —Å–µ–∫—É–Ω–¥–∞—Ö
                gameState.lastUpdate = now;
                
                // –û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
                gameState.organicOrdersTimer += deltaTime;
                if (gameState.organicOrdersTimer >= 1) { // –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                    spawnOrganicOrders();
                    gameState.organicOrdersTimer = 0;
                }
                
                // –û–°–ù–û–í–ù–û–ô –ü–†–û–ò–ó–í–û–î–°–¢–í–ï–ù–ù–´–ô –¶–ò–ö–õ - –ò–°–ü–†–ê–í–õ–ï–ù
                const productionPerSecond = getTotalProduction() / 60; // –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –≤ —Å–µ–∫—É–Ω–¥—É
                gameState.productionAccumulator += productionPerSecond * deltaTime;
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –≤ –∑–∞–∫–∞–∑—ã
                const ordersToProduce = Math.floor(gameState.productionAccumulator);
                if (ordersToProduce > 0 && gameState.materials >= ordersToProduce) {
                    gameState.currentOrders += ordersToProduce;
                    gameState.materials -= ordersToProduce;
                    gameState.totalProduced += ordersToProduce;
                    gameState.productionAccumulator -= ordersToProduce;
                    
                    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                    const buildingGrid = document.getElementById('building-grid');
                    buildingGrid.classList.add('production-animation');
                    setTimeout(() => {
                        buildingGrid.classList.remove('production-animation');
                    }, 500);
                }
                
                // –°–Ω–∏–∂–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ —Ä–µ–∫–ª–∞–º—ã
                gameState.advertisingEffect = Math.max(0, gameState.advertisingEffect - (BALANCE.AD_EFFECT_DECAY * deltaTime));
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–æ–º–æ–∫ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è)
                const building = gameState.buildings[gameState.currentBuilding];
                building.equipment.forEach(eq => {
                    if (!eq.broken && Math.random() < (eq.breakdownRisk * deltaTime)) {
                        eq.broken = true;
                        showNotification(`–°–ª–æ–º–∞–Ω–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ: ${eq.name}`, 'warning');
                    }
                });
                
                updateUI();
                
            }, 100); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 100ms –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
        }

        function spawnOrganicOrders() {
            const baseChance = BALANCE.ORGANIC_ORDERS_RATE;
            const adBonus = gameState.advertisingEffect * 0.5; // –†–µ–∫–ª–∞–º–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —à–∞–Ω—Å
            const totalChance = baseChance + adBonus;
            
            if (Math.random() < totalChance) {
                const orderCount = 1 + Math.floor(gameState.advertisingEffect * 2); // 1-3 –∑–∞–∫–∞–∑–∞
                gameState.currentOrders += orderCount;
                showNotification(`–ü–æ—Å—Ç—É–ø–∏–ª–æ –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤: ${orderCount}`, 'info');
            }
        }

        // ==================== –ò–ì–†–û–í–´–ï –î–ï–ô–°–¢–í–ò–Ø ====================

        function buyMaterials() {
            const storageCapacity = getTotalStorage();
            const availableSpace = storageCapacity - gameState.materials;
            const maxAffordable = Math.min(availableSpace, Math.floor(gameState.money / BALANCE.MATERIAL_COST));
            
            if (maxAffordable > 0) {
                gameState.materials += maxAffordable;
                gameState.money -= maxAffordable * BALANCE.MATERIAL_COST;
                updateUI();
                
                showNotification(`–ó–∞–∫—É–ø–ª–µ–Ω–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤: ${maxAffordable} –µ–¥.`, 'success');
            } else {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –∏–ª–∏ –¥–µ–Ω–µ–≥ –¥–ª—è –∑–∞–∫—É–ø–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤!', 'danger');
            }
        }

        function shipOrders() {
            if (gameState.currentOrders === 0) {
                showNotification('–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –æ—Ç–≥—Ä—É–∑–∫–∏!', 'warning');
                return;
            }
            
            const orderValue = calculateOrderValue();
            gameState.money += orderValue;
            gameState.totalShipped += gameState.currentOrders;
            
            showNotification(`–û—Ç–≥—Ä—É–∂–µ–Ω–æ –∑–∞–∫–∞–∑–æ–≤: ${gameState.currentOrders} –Ω–∞ —Å—É–º–º—É ${orderValue} ‚ÇΩ`, 'success');
            
            gameState.currentOrders = 0;
            updateUI();
        }

        function launchAdvertising() {
            if (gameState.money >= BALANCE.AD_COST) {
                gameState.money -= BALANCE.AD_COST;
                gameState.advertisingEffect = Math.min(1.0, gameState.advertisingEffect + 0.3);
                updateUI();
                
                showNotification('–†–µ–∫–ª–∞–º–Ω–∞—è –∫–∞–º–ø–∞–Ω–∏—è –∑–∞–ø—É—â–µ–Ω–∞! –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∞.', 'success');
            } else {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ä–µ–∫–ª–∞–º—ã!', 'danger');
            }
        }

        function findOrders() {
            if (gameState.money >= BALANCE.FIND_ORDERS_COST) {
                gameState.money -= BALANCE.FIND_ORDERS_COST;
                const foundOrders = 3 + Math.floor(Math.random() * 3); // 3-5 –∑–∞–∫–∞–∑–æ–≤
                gameState.currentOrders += foundOrders;
                updateUI();
                
                showNotification(`–ù–∞–π–¥–µ–Ω–æ –∑–∞–∫–∞–∑–æ–≤: ${foundOrders}`, 'success');
            } else {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤!', 'danger');
            }
        }

        // ==================== –†–ê–°–ß–ï–¢–´ –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö ====================

        function getTotalProduction() {
            const building = gameState.buildings[gameState.currentBuilding];
            const baseProduction = BALANCE.BASE_PRODUCTION_SPEED;
            const equipmentBonus = building.equipment
                .filter(eq => eq.production && !eq.broken)
                .reduce((sum, eq) => sum + eq.production, 0);
            
            return baseProduction + equipmentBonus;
        }

        function getTotalStorage() {
            const building = gameState.buildings[gameState.currentBuilding];
            const baseStorage = building.baseCapacity;
            const bonusStorage = building.equipment
                .filter(eq => eq.storage && !eq.broken)
                .reduce((sum, eq) => sum + eq.storage, 0);
            return baseStorage + bonusStorage;
        }

        function calculateOrderValue() {
            const baseValue = gameState.currentOrders * BALANCE.BASE_ORDER_PRICE;
            const advertisingBonus = 1 + gameState.advertisingEffect;
            return Math.floor(baseValue * advertisingBonus * gameState.qualityMultiplier);
        }

        // ==================== –ò–ù–¢–ï–†–§–ï–ô–° –ò –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================

        function updateUI() {
            // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
            document.getElementById('money').textContent = gameState.money.toLocaleString('ru-RU') + ' ‚ÇΩ';
            document.getElementById('stat-materials').textContent = `${gameState.materials}/${getTotalStorage()}`;
            document.getElementById('stat-orders').textContent = gameState.currentOrders;
            document.getElementById('ship-value').textContent = calculateOrderValue().toLocaleString('ru-RU') + ' ‚ÇΩ';
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã
            const storagePercent = (gameState.materials / getTotalStorage()) * 100;
            document.getElementById('materials-bar').style.width = `${storagePercent}%`;
            
            document.getElementById('ad-bar').style.width = `${gameState.advertisingEffect * 100}%`;
            document.getElementById('stat-ad').textContent = `${Math.floor(gameState.advertisingEffect * 100)}%`;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('stat-production').textContent = getTotalProduction().toFixed(1);
            document.getElementById('stat-multiplier').textContent = (1 + gameState.advertisingEffect).toFixed(1) + 'x';
            document.getElementById('stat-storage').textContent = getTotalStorage();
            
            // –û—á–µ—Ä–µ–¥—å –∑–∞–∫–∞–∑–æ–≤
            updateOrdersQueue();
            
            updateUpgradeButton();
            updateEquipmentShop();
            saveGame();
        }

        function updateOrdersQueue() {
            const queue = document.getElementById('orders-queue');
            if (gameState.currentOrders > 0) {
                queue.innerHTML = `
                    <div class="alert alert-info py-2">
                        <div class="d-flex justify-content-between">
                            <span>–ó–∞–∫–∞–∑–æ–≤ –≤ —Ä–∞–±–æ—Ç–µ:</span>
                            <strong>${gameState.currentOrders}</strong>
                        </div>
                        <div class="small text-muted">–°—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–≥—Ä—É–∑–∫–∏: ${calculateOrderValue()} ‚ÇΩ</div>
                    </div>
                `;
            } else {
                queue.innerHTML = '<div class="text-muted text-center">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</div>';
            }
        }

        function showNotification(message, type = 'info') {
            const toastBody = document.getElementById('production-toast-body');
            toastBody.textContent = message;
            toastBody.className = `toast-body text-white bg-${type}`;
            new bootstrap.Toast(document.getElementById('productionToast'), { delay: 3000 }).show();
        }

        // ==================== –ó–ê–ü–£–°–ö –ò–ì–†–´ ====================

        window.onload = initGame;
    </script>
</body>
</html>
