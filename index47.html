<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢–æ—Ä–≥–æ–≤–∞—è –ò–º–ø–µ—Ä–∏—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: #0f0f23;
            color: #e0e0ff;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: fixed;
        }
        #game {
            padding: 10px;
            height: 100%;
            display: grid;
            grid-template-rows: auto auto 1fr auto;
            gap: 8px;
        }
        .header {
            background: #1a1a3a;
            padding: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }
        .currency {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .currency span {
            background: #2a2a4a;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .panels {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            overflow: hidden;
        }
        .panel {
            background: #1a1a3a;
            padding: 10px;
            border-radius: 8px;
            overflow-y: auto;
            max-height: 30vh;
        }
        .buildings-panel {
            grid-column: span 2;
        }
        button {
            background: #3a5a8a;
            color: white;
            border: none;
            padding: 8px;
            border-radius: 5px;
            margin: 3px 0;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
        }
        button:hover {
            background: #4a6a9a;
        }
        button:disabled {
            background: #333;
            cursor: not-allowed;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #2a2a4a;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .event {
            padding: 5px;
            margin: 3px 0;
            border-radius: 4px;
        }
        .positive {
            background: rgba(0, 100, 0, 0.3);
            border-left: 3px solid #0f0;
        }
        .negative {
            background: rgba(100, 0, 0, 0.3);
            border-left: 3px solid #f00;
        }
        .neutral {
            background: rgba(100, 100, 0, 0.3);
            border-left: 3px solid #ff0;
        }
        h3 {
            margin-bottom: 8px;
            color: #a0a0ff;
        }
        .resource-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        .progress-bar {
            height: 5px;
            background: #333;
            margin-top: 3px;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: #4af;
            width: 0%;
        }
        @media (max-width: 600px) {
            .panels {
                grid-template-columns: 1fr;
            }
            .buildings-panel {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>
    <div id="game">
        <div class="header">
            <div class="currency">
                <span id="gold">üí∞ –ó–æ–ª–æ—Ç–æ: 100</span>
                <span id="silver">üî∂ –°–µ—Ä–µ–±—Ä–æ: 0</span>
                <span id="gems">üíé –ö—Ä–∏—Å—Ç–∞–ª–ª—ã: 0</span>
                <span id="credits">üè¶ –ö—Ä–µ–¥–∏—Ç—ã: 0</span>
            </div>
            <span id="day">üìÖ –î–µ–Ω—å 1</span>
        </div>
        
        <div class="panels">
            <div class="panel">
                <h3>üì¶ –†–µ—Å—É—Ä—Å—ã</h3>
                <div id="resourcesList"></div>
            </div>
            
            <div class="panel">
                <h3>üè™ –†—ã–Ω–æ–∫</h3>
                <div id="marketList"></div>
            </div>
        </div>
        
        <div class="panel buildings-panel">
            <h3>üèóÔ∏è –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</h3>
            <div id="buildingsList"></div>
            <h3>‚öôÔ∏è –£–ª—É—á—à–µ–Ω–∏—è</h3>
            <div id="upgradesList"></div>
        </div>
        
        <div class="panel">
            <h3>üìú –°–æ–±—ã—Ç–∏—è</h3>
            <div id="eventsLog"></div>
        </div>
    </div>

    <script>
        // ========== –ò–ì–†–û–í–´–ï –î–ê–ù–ù–´–ï ==========
        const game = {
            day: 1,
            gold: 100,
            silver: 0,
            gems: 0,
            credits: 0,
            reputation: 50,
            
            resources: {
                grain: 0,
                ore: 0,
                wood: 0,
                tools: 0,
                luxury: 0
            },
            
            storage: {
                grain: 100,
                ore: 100,
                wood: 100,
                tools: 50,
                luxury: 20
            },
            
            buildings: {
                farm: { count: 0, cost: 100, production: 1 },
                mine: { count: 0, cost: 200, production: 1 },
                sawmill: { count: 0, cost: 150, production: 1 },
                workshop: { count: 0, cost: 500, production: 1 },
                factory: { count: 0, cost: 1000, production: 1 }
            },
            
            upgrades: {
                farm: { level: 0, cost: 200, effect: 0.5 },
                mine: { level: 0, cost: 300, effect: 0.5 },
                sawmill: { level: 0, cost: 250, effect: 0.5 },
                workshop: { level: 0, cost: 400, effect: 0.3 },
                factory: { level: 0, cost: 800, effect: 0.3 }
            },
            
            market: {
                grain: { price: 5, volatility: 2 },
                ore: { price: 10, volatility: 3 },
                wood: { price: 8, volatility: 2 },
                tools: { price: 30, volatility: 5 },
                luxury: { price: 100, volatility: 10 }
            },
            
            competitors: [
                { name: "–¢–æ—Ä–≥–æ–≤—ã–π –¥–æ–º –í–∞—Ä–ª–æ–∫–æ–≤", strength: 1 },
                { name: "–ì–∏–ª—å–¥–∏—è –°—Ç–∞–ª–∏", strength: 1 },
                { name: "–°–∏–Ω–¥–∏–∫–∞—Ç –¢–µ–Ω–µ–π", strength: 1 }
            ],
            
            events: [
                { 
                    text: "‚õàÔ∏è –ù–∞–≤–æ–¥–Ω–µ–Ω–∏–µ —É–Ω–∏—á—Ç–æ–∂–∏–ª–æ —á–∞—Å—Ç—å —É—Ä–æ–∂–∞—è!", 
                    effect: () => { game.resources.grain = Math.max(0, game.resources.grain - 5); },
                    type: "negative",
                    chance: 0.1
                },
                { 
                    text: "ü§ë –ù–∞–π–¥–µ–Ω—ã –¥—Ä–µ–≤–Ω–∏–µ —Å–æ–∫—Ä–æ–≤–∏—â–∞! +50üí∞", 
                    effect: () => { game.gold += 50; },
                    type: "positive",
                    chance: 0.05
                },
                { 
                    text: "üë®‚Äçüåæ –ú–∏–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—á–∏—Ö! –í—Å–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ +1 —É—Ä–æ–≤–µ–Ω—å –Ω–∞ –¥–µ–Ω—å.", 
                    effect: () => { 
                        Object.keys(game.buildings).forEach(b => {
                            game.buildings[b].production += 1;
                        });
                        setTimeout(() => {
                            Object.keys(game.buildings).forEach(b => {
                                game.buildings[b].production -= 1;
                            });
                        }, 10000);
                    },
                    type: "positive",
                    chance: 0.07
                },
                { 
                    text: "üí∏ –ö—Ä–∏–∑–∏—Å! –¶–µ–Ω—ã —É–ø–∞–ª–∏ –Ω–∞ 30%", 
                    effect: () => { 
                        Object.keys(game.market).forEach(item => {
                            game.market[item].price = Math.max(1, Math.floor(game.market[item].price * 0.7));
                        });
                    },
                    type: "negative",
                    chance: 0.08
                },
                { 
                    text: "üèÜ –í—ã–∏–≥—Ä–∞–ª–∏ —Ç–æ—Ä–≥–æ–≤—ã–π –∫–æ–Ω–∫—É—Ä—Å! +20 —Ä–µ–ø—É—Ç–∞—Ü–∏–∏", 
                    effect: () => { game.reputation += 20; },
                    type: "positive",
                    chance: 0.06
                }
            ],
            
            recipes: {
                tools: { ore: 2, wood: 1 },
                luxury: { tools: 1, ore: 3, wood: 2 }
            }
        };

        // ========== DOM –≠–õ–ï–ú–ï–ù–¢–´ ==========
        const elements = {
            gold: document.getElementById('gold'),
            silver: document.getElementById('silver'),
            gems: document.getElementById('gems'),
            credits: document.getElementById('credits'),
            day: document.getElementById('day'),
            resourcesList: document.getElementById('resourcesList'),
            marketList: document.getElementById('marketList'),
            buildingsList: document.getElementById('buildingsList'),
            upgradesList: document.getElementById('upgradesList'),
            eventsLog: document.getElementById('eventsLog')
        };

        // ========== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function updateUI() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∞–ª—é—Ç—ã
            elements.gold.textContent = `üí∞ –ó–æ–ª–æ—Ç–æ: ${game.gold}`;
            elements.silver.textContent = `üî∂ –°–µ—Ä–µ–±—Ä–æ: ${game.silver}`;
            elements.gems.textContent = `üíé –ö—Ä–∏—Å—Ç–∞–ª–ª—ã: ${game.gems}`;
            elements.credits.textContent = `üè¶ –ö—Ä–µ–¥–∏—Ç—ã: ${game.credits}`;
            elements.day.textContent = `üìÖ –î–µ–Ω—å ${game.day}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ—Å—É—Ä—Å—ã
            elements.resourcesList.innerHTML = Object.entries(game.resources)
                .map(([res, amount]) => `
                    <div class="resource-item">
                        <span>${res}: ${amount}/${game.storage[res]}</span>
                        <span>${getResourceValue(res)}üí∞</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${(amount / game.storage[res]) * 100}%"></div>
                    </div>
                `)
                .join('');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä—ã–Ω–æ–∫
            elements.marketList.innerHTML = Object.entries(game.market)
                .map(([item, data]) => `
                    <div class="resource-item">
                        <span>${item}: ${data.price}üí∞</span>
                        <div>
                            <button onclick="buyResource('${item}')">–ö—É–ø–∏—Ç—å</button>
                            <button onclick="sellResource('${item}')">–ü—Ä–æ–¥–∞—Ç—å</button>
                        </div>
                    </div>
                `)
                .join('');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–¥–∞–Ω–∏—è
            elements.buildingsList.innerHTML = Object.entries(game.buildings)
                .map(([name, data]) => `
                    <button onclick="buyBuilding('${name}')" 
                            ${game.gold < data.cost ? 'disabled' : ''}
                            class="tooltip">
                        ${getBuildingName(name)} (${data.count}) - ${data.cost}üí∞
                        <span class="tooltiptext">–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç ${getProductionRate(name)} ${getResourceName(name)}/–¥–µ–Ω—å</span>
                    </button>
                `)
                .join('');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —É–ª—É—á—à–µ–Ω–∏—è
            elements.upgradesList.innerHTML = Object.entries(game.upgrades)
                .map(([name, data]) => `
                    <button onclick="buyUpgrade('${name}')" 
                            ${game.gold < data.cost ? 'disabled' : ''}
                            class="tooltip">
                        –£–ª—É—á—à–∏—Ç—å ${getBuildingName(name)} (–£—Ä.${data.level + 1}) - ${data.cost}üí∞
                        <span class="tooltiptext">+${data.effect * 100}% –∫ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</span>
                    </button>
                `)
                .join('');
        }

        function getBuildingName(type) {
            const names = {
                farm: "–§–µ—Ä–º–∞",
                mine: "–®–∞—Ö—Ç–∞",
                sawmill: "–õ–µ—Å–æ–ø–∏–ª–∫–∞",
                workshop: "–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è",
                factory: "–§–∞–±—Ä–∏–∫–∞"
            };
            return names[type] || type;
        }

        function getResourceName(buildingType) {
            const mapping = {
                farm: "grain",
                mine: "ore",
                sawmill: "wood",
                workshop: "tools",
                factory: "luxury"
            };
            return mapping[buildingType] || '';
        }

        function getProductionRate(buildingType) {
            const base = game.buildings[buildingType].production;
            const multiplier = 1 + (game.upgrades[buildingType].level * game.upgrades[buildingType].effect);
            return (base * multiplier).toFixed(1);
        }

        function getResourceValue(resource) {
            return game.market[resource]?.price || 0;
        }

        // ========== –ò–ì–†–û–í–´–ï –î–ï–ô–°–¢–í–ò–Ø ==========
        function buyBuilding(type) {
            const building = game.buildings[type];
            if (game.gold >= building.cost) {
                game.gold -= building.cost;
                building.count++;
                building.cost = Math.floor(building.cost * 1.15);
                updateUI();
            }
        }

        function buyUpgrade(type) {
            const upgrade = game.upgrades[type];
            if (game.gold >= upgrade.cost) {
                game.gold -= upgrade.cost;
                upgrade.level++;
                upgrade.cost = Math.floor(upgrade.cost * 1.5);
                updateUI();
            }
        }

        function buyResource(type) {
            const price = game.market[type].price;
            if (game.gold >= price && game.resources[type] < game.storage[type]) {
                game.gold -= price;
                game.resources[type]++;
                updateUI();
            }
        }

        function sellResource(type) {
            if (game.resources[type] > 0) {
                game.gold += game.market[type].price;
                game.resources[type]--;
                updateUI();
            }
        }

        // ========== –ü–†–û–ò–ó–í–û–î–°–¢–í–û –ò –†–´–ù–û–ö ==========
        function produceResources() {
            Object.entries(game.buildings).forEach(([type, data]) => {
                const resource = getResourceName(type);
                if (!resource) return;
                
                const production = data.count * data.production * (1 + game.upgrades[type].level * game.upgrades[type].effect);
                
                // –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ—Ü–µ–ø—Ç—ã
                if (type === 'workshop' || type === 'factory') {
                    const recipe = game.recipes[resource];
                    let canProduce = true;
                    
                    Object.entries(recipe).forEach(([ingredient, amount]) => {
                        if (game.resources[ingredient] < amount * production) {
                            canProduce = false;
                        }
                    });
                    
                    if (canProduce) {
                        Object.entries(recipe).forEach(([ingredient, amount]) => {
                            game.resources[ingredient] -= amount * production;
                        });
                        game.resources[resource] += production;
                    }
                } else {
                    game.resources[resource] += production;
                }
                
                // –ù–µ –ø—Ä–µ–≤—ã—à–∞–µ–º —Å–∫–ª–∞–¥
                game.resources[resource] = Math.min(game.resources[resource], game.storage[resource]);
            });
        }

        function updateMarket() {
            Object.entries(game.market).forEach(([item, data]) => {
                // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
                const change = (Math.random() * 2 - 1) * data.volatility;
                data.price = Math.max(1, Math.floor(data.price + change));
                
                // –í–ª–∏—è–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
                game.competitors.forEach(comp => {
                    if (Math.random() < 0.1) {
                        data.price += (Math.random() > 0.5 ? 1 : -1) * comp.strength;
                    }
                });
            });
        }

        // ========== –°–û–ë–´–¢–ò–Ø –ò –ö–û–ù–ö–£–†–ï–ù–¢–´ ==========
        function triggerRandomEvent() {
            game.events.forEach(event => {
                if (Math.random() < event.chance) {
                    event.effect();
                    logEvent(event.text, event.type);
                }
            });
        }

        function updateCompetitors() {
            if (game.day % 5 === 0) {
                game.competitors.forEach(comp => {
                    comp.strength += 0.1;
                });
            }
        }

        function logEvent(text, type) {
            const eventElement = document.createElement('div');
            eventElement.className = `event ${type}`;
            eventElement.textContent = text;
            elements.eventsLog.prepend(eventElement);
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π
            if (elements.eventsLog.children.length > 5) {
                elements.eventsLog.removeChild(elements.eventsLog.lastChild);
            }
        }

        // ========== –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ==========
        function gameLoop() {
            game.day++;
            
            // –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ —Ä–µ—Å—É—Ä—Å–æ–≤
            produceResources();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞
            updateMarket();
            
            // –°–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
            triggerRandomEvent();
            
            // –†–∞–∑–≤–∏—Ç–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
            updateCompetitors();
            
            // –ö—Ä–µ–¥–∏—Ç—ã –∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã
            if (game.day % 10 === 0) {
                game.credits += 10;
                if (game.credits > 0) {
                    game.gold += game.credits * 2;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π
            checkGameState();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            updateUI();
        }

        function checkGameState() {
            // –ü–æ—Ä–∞–∂–µ–Ω–∏–µ
            if (game.gold < -100) {
                alert(`üíÄ –ë–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–æ! –í–∞—à–∞ –∏–º–ø–µ—Ä–∏—è –ø–∞–ª–∞ –Ω–∞ ${game.day} –¥–µ–Ω—å.`);
                resetGame();
            }
            
            // –ü–æ–±–µ–¥–∞
            if (game.gold >= 10000) {
                alert(`üèÜ –ü–æ–±–µ–¥–∞! –í—ã —Å–æ–∑–¥–∞–ª–∏ –≤–µ–ª–∏–∫—É—é —Ç–æ—Ä–≥–æ–≤—É—é –∏–º–ø–µ—Ä–∏—é –∑–∞ ${game.day} –¥–Ω–µ–π!`);
                resetGame();
            }
        }

        function resetGame() {
            // –°–±—Ä–æ—Å –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π
            game.day = 1;
            game.gold = 100;
            game.silver = 0;
            game.gems = 0;
            game.credits = 0;
            game.reputation = 50;
            
            // –°–±—Ä–æ—Å —Ä–µ—Å—É—Ä—Å–æ–≤
            Object.keys(game.resources).forEach(k => game.resources[k] = 0);
            
            // –°–±—Ä–æ—Å –∑–¥–∞–Ω–∏–π
            Object.entries(game.buildings).forEach(([k, v]) => {
                v.count = 0;
                v.cost = v.cost / Math.pow(1.15, v.count);
            });
            
            // –°–±—Ä–æ—Å —É–ª—É—á—à–µ–Ω–∏–π
            Object.entries(game.upgrades).forEach(([k, v]) => {
                v.level = 0;
                v.cost = v.cost / Math.pow(1.5, v.level);
            });
            
            // –°–±—Ä–æ—Å —Ä—ã–Ω–∫–∞
            const defaultPrices = {
                grain: 5,
                ore: 10,
                wood: 8,
                tools: 30,
                luxury: 100
            };
            Object.entries(defaultPrices).forEach(([k, v]) => {
                game.market[k].price = v;
            });
            
            // –°–±—Ä–æ—Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
            game.competitors.forEach(comp => comp.strength = 1);
            
            // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–∞ —Å–æ–±—ã—Ç–∏–π
            elements.eventsLog.innerHTML = '';
            
            updateUI();
        }

        // ========== –ó–ê–ü–£–°–ö –ò–ì–†–´ ==========
        updateUI();
        setInterval(gameLoop, 10000); // 10 —Å–µ–∫—É–Ω–¥ = 1 –¥–µ–Ω—å
    </script>
</body>
</html>
