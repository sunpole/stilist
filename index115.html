<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Dungeon Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #2a3c6c);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .screen {
            display: none;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        .active {
            display: block;
        }
        
        .role-selection {
            text-align: center;
        }
        
        .roles {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0;
        }
        
        .role-card {
            background: rgba(40, 40, 80, 0.8);
            border-radius: 10px;
            padding: 20px;
            width: 180px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .role-card:hover {
            transform: translateY(-5px);
            border-color: #ffd700;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }
        
        .role-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .role-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .role-desc {
            font-size: 14px;
            color: #ccc;
        }
        
        .game-ui {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }
        
        .battle-area {
            background: rgba(20, 20, 40, 0.8);
            border-radius: 10px;
            padding: 15px;
            height: 500px;
            position: relative;
            overflow: hidden;
        }
        
        #gameCanvas {
            width: 100%;
            height: 100%;
            background: #0a0a1a;
            border-radius: 5px;
        }
        
        .party-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .party-member {
            display: flex;
            align-items: center;
            background: rgba(40, 40, 80, 0.8);
            border-radius: 5px;
            padding: 10px;
        }
        
        .member-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .tank { background: #8B4513; }
        .healer { background: #32CD32; }
        .support { background: #9370DB; }
        .mage { background: #DC143C; }
        .archer { background: #FF8C00; }
        
        .member-stats {
            flex-grow: 1;
        }
        
        .stat-bar {
            height: 10px;
            border-radius: 5px;
            background: #333;
            margin: 5px 0;
            overflow: hidden;
        }
        
        .health-bar {
            background: linear-gradient(to right, #FF0000, #FF4500);
            height: 100%;
            transition: width 0.3s;
        }
        
        .mana-bar {
            background: linear-gradient(to right, #1E90FF, #00BFFF);
            height: 100%;
            transition: width 0.3s;
        }
        
        .abilities {
            background: rgba(20, 20, 40, 0.8);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .abilities-title {
            text-align: center;
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .ability-slots {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .ability {
            background: rgba(40, 40, 80, 0.8);
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        
        .ability:hover:not(.on-cooldown) {
            border-color: #ffd700;
            background: rgba(60, 60, 100, 0.8);
        }
        
        .ability-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .ability-name {
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        .ability-cost {
            font-size: 10px;
            color: #1E90FF;
        }
        
        .on-cooldown {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .cooldown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            border-radius: 5px;
        }
        
        .game-info {
            background: rgba(20, 20, 40, 0.8);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .dungeon-info {
            background: rgba(40, 40, 80, 0.8);
            border-radius: 5px;
            padding: 10px;
        }
        
        .event-log {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-size: 14px;
        }
        
        .event {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid #ffd700;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .shop {
            text-align: center;
        }
        
        .shop-items {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .shop-item {
            background: rgba(40, 40, 80, 0.8);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .shop-item:hover {
            border-color: #ffd700;
            transform: translateY(-5px);
        }
        
        .item-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .item-name {
            font-size: 18px;
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .item-desc {
            font-size: 14px;
            color: #ccc;
            margin-bottom: 10px;
        }
        
        .item-cost {
            font-size: 16px;
            color: #32CD32;
        }
        
        .currency {
            text-align: center;
            font-size: 24px;
            margin: 20px 0;
            color: #ffd700;
        }
        
        button {
            background: linear-gradient(to bottom, #ffd700, #ff8c00);
            border: none;
            border-radius: 5px;
            color: #1a2a6c;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>RPG Dungeon Simulator</h1>
        
        <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏ -->
        <div id="roleSelection" class="screen active">
            <div class="role-selection">
                <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é —Ä–æ–ª—å</h2>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å, –∫–æ—Ç–æ—Ä—É—é –±—É–¥–µ—Ç–µ –∏–≥—Ä–∞—Ç—å. –û—Å—Ç–∞–ª—å–Ω—ã–µ —á–ª–µ–Ω—ã –≥—Ä—É–ø–ø—ã –±—É–¥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –ò–ò.</p>
                
                <div class="roles">
                    <div class="role-card" data-role="tank">
                        <div class="role-icon">üõ°Ô∏è</div>
                        <div class="role-name">–¢–∞–Ω–∫</div>
                        <div class="role-desc">–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∞–≥–≥—Ä–æ –≤—Ä–∞–≥–æ–≤, –∑–∞—â–∏—â–∞–π—Ç–µ —Å–æ—é–∑–Ω–∏–∫–æ–≤</div>
                    </div>
                    
                    <div class="role-card" data-role="healer">
                        <div class="role-icon">‚ù§Ô∏è</div>
                        <div class="role-name">–•–∏–ª–µ—Ä</div>
                        <div class="role-desc">–õ–µ—á–∏—Ç–µ —Å–æ—é–∑–Ω–∏–∫–æ–≤, –≤–æ—Å–∫—Ä–µ—à–∞–π—Ç–µ –ø–∞–≤—à–∏—Ö</div>
                    </div>
                    
                    <div class="role-card" data-role="support">
                        <div class="role-icon">‚ú®</div>
                        <div class="role-name">–°–∞–ø–ø–æ—Ä—Ç</div>
                        <div class="role-desc">–ë–∞—Ñ—Ñ–∞–π—Ç–µ –≥—Ä—É–ø–ø—É, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –º–∞–Ω—É</div>
                    </div>
                    
                    <div class="role-card" data-role="mage">
                        <div class="role-icon">üî•</div>
                        <div class="role-name">–ú–∞–≥</div>
                        <div class="role-desc">–ù–∞–Ω–æ—Å–∏—Ç–µ –º–∞–≥–∏—á–µ—Å–∫–∏–π —É—Ä–æ–Ω, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ –≤—Ä–∞–≥–æ–≤</div>
                    </div>
                    
                    <div class="role-card" data-role="archer">
                        <div class="role-icon">üèπ</div>
                        <div class="role-name">–õ—É—á–Ω–∏–∫</div>
                        <div class="role-desc">–ù–∞–Ω–æ—Å–∏—Ç–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —É—Ä–æ–Ω –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏</div>
                    </div>
                </div>
                
                <button id="startGame">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>
        </div>
        
        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div id="gameScreen" class="screen">
            <div class="game-ui">
                <div class="battle-area">
                    <canvas id="gameCanvas"></canvas>
                </div>
                
                <div class="game-info">
                    <div class="dungeon-info">
                        <h3>–¢–µ–∫—É—â–∏–π –¥–∞–Ω–∂: <span id="currentDungeon">–õ–µ—Å –¢–µ–Ω–µ–π</span></h3>
                        <p>–í–æ–ª–Ω–∞: <span id="currentWave">1</span>/5</p>
                        <p>–í—Ä–∞–≥–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å: <span id="enemiesLeft">5</span></p>
                    </div>
                    
                    <div class="party-info">
                        <div class="party-member">
                            <div class="member-icon tank">–¢</div>
                            <div class="member-stats">
                                <div>–¢–∞–Ω–∫</div>
                                <div class="stat-bar">
                                    <div class="health-bar" style="width: 100%"></div>
                                </div>
                                <div class="stat-bar">
                                    <div class="mana-bar" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="party-member">
                            <div class="member-icon healer">–•</div>
                            <div class="member-stats">
                                <div>–•–∏–ª–µ—Ä</div>
                                <div class="stat-bar">
                                    <div class="health-bar" style="width: 100%"></div>
                                </div>
                                <div class="stat-bar">
                                    <div class="mana-bar" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="party-member">
                            <div class="member-icon support">–°</div>
                            <div class="member-stats">
                                <div>–°–∞–ø–ø–æ—Ä—Ç</div>
                                <div class="stat-bar">
                                    <div class="health-bar" style="width: 100%"></div>
                                </div>
                                <div class="stat-bar">
                                    <div class="mana-bar" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="party-member">
                            <div class="member-icon mage">–ú</div>
                            <div class="member-stats">
                                <div>–ú–∞–≥</div>
                                <div class="stat-bar">
                                    <div class="health-bar" style="width: 100%"></div>
                                </div>
                                <div class="stat-bar">
                                    <div class="mana-bar" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="party-member">
                            <div class="member-icon archer">–õ</div>
                            <div class="member-stats">
                                <div>–õ—É—á–Ω–∏–∫</div>
                                <div class="stat-bar">
                                    <div class="health-bar" style="width: 100%"></div>
                                </div>
                                <div class="stat-bar">
                                    <div class="mana-bar" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="event-log" id="eventLog">
                        <div class="event">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –õ–µ—Å –¢–µ–Ω–µ–π!</div>
                        <div class="event">–í–∞—à–∞ –≥—Ä—É–ø–ø–∞ –≥–æ—Ç–æ–≤–∞ –∫ –±–æ—é.</div>
                    </div>
                </div>
            </div>
            
            <div class="abilities">
                <h3 class="abilities-title">–í–∞—à–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏</h3>
                <div class="ability-slots" id="abilitySlots">
                    <!-- –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button id="nextDungeon" disabled>–°–ª–µ–¥—É—é—â–∏–π –¥–∞–Ω–∂</button>
                <button id="openShop">–ú–∞–≥–∞–∑–∏–Ω —É–ª—É—á—à–µ–Ω–∏–π</button>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –º–∞–≥–∞–∑–∏–Ω–∞ -->
        <div id="shopScreen" class="screen">
            <div class="shop">
                <h2>–ú–∞–≥–∞–∑–∏–Ω —É–ª—É—á—à–µ–Ω–∏–π</h2>
                <div class="currency">–í–∞–ª—é—Ç–∞: <span id="currencyAmount">100</span> –∑–æ–ª–æ—Ç—ã—Ö</div>
                
                <div class="shop-items" id="shopItems">
                    <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                
                <button id="backToGame">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∏–≥—Ä–µ</button>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –ø–æ—Ä–∞–∂–µ–Ω–∏—è -->
        <div id="gameOverScreen" class="screen">
            <div style="text-align: center;">
                <h2>–ü–æ—Ä–∞–∂–µ–Ω–∏–µ!</h2>
                <p>–í–∞—à–∞ –≥—Ä—É–ø–ø–∞ –ø–∞–ª–∞ –≤ –±–æ—é.</p>
                <p>–í—ã –ø—Ä–æ—à–ª–∏ <span id="dungeonsCompleted">0</span> –¥–∞–Ω–∂–µ–π</p>
                <button id="restartGame">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
            </div>
        </div>
    </div>

    <script>
        // –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
        const ROLES = {
            TANK: 'tank',
            HEALER: 'healer',
            SUPPORT: 'support',
            MAGE: 'mage',
            ARCHER: 'archer'
        };

        const DUNGEONS = [
            { name: "–õ–µ—Å –¢–µ–Ω–µ–π", waves: 3, enemiesPerWave: 3, reward: 50 },
            { name: "–ü–µ—â–µ—Ä—ã –ì–æ–±–ª–∏–Ω–æ–≤", waves: 4, enemiesPerWave: 4, reward: 75 },
            { name: "–ó–∞–º–æ–∫ –ù–µ–∂–∏—Ç–∏", waves: 5, enemiesPerWave: 5, reward: 100 },
            { name: "–õ–æ–≥–æ–≤–æ –î—Ä–∞–∫–æ–Ω–∞", waves: 6, enemiesPerWave: 6, reward: 150 }
        ];

        let gameState = {
            playerRole: null,
            party: {},
            enemies: [],
            currentDungeon: 0,
            currentWave: 0,
            currency: 100,
            gameActive: false,
            abilities: {},
            abilityCooldowns: {},
            playerAbilities: [],
            eventLog: [],
            gameLoopInterval: null
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏
            const roleCards = document.querySelectorAll('.role-card');
            roleCards.forEach(card => {
                card.addEventListener('click', function() {
                    roleCards.forEach(c => c.style.borderColor = 'transparent');
                    this.style.borderColor = '#ffd700';
                    gameState.playerRole = this.getAttribute('data-role');
                });
            });

            // –ö–Ω–æ–ø–∫–∞ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã
            document.getElementById('startGame').addEventListener('click', function() {
                if (!gameState.playerRole) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å!');
                    return;
                }
                startGame();
            });

            // –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.getElementById('nextDungeon').addEventListener('click', nextDungeon);
            document.getElementById('openShop').addEventListener('click', openShop);
            document.getElementById('backToGame').addEventListener('click', backToGame);
            document.getElementById('restartGame').addEventListener('click', restartGame);
        });

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        function startGame() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä—É–ø–ø—ã
            initParty();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –∏–≥—Ä–æ–∫–∞
            initPlayerAbilities();
            
            // –ù–∞—á–∞–ª–æ –ø–µ—Ä–≤–æ–≥–æ –¥–∞–Ω–∂–∞
            startDungeon(0);
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤
            switchScreen('gameScreen');
            
            // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
            gameState.gameActive = true;
            gameState.gameLoopInterval = setInterval(gameLoop, 100);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä—É–ø–ø—ã
        function initParty() {
            gameState.party = {
                tank: { 
                    name: '–¢–∞–Ω–∫', 
                    health: 100, 
                    maxHealth: 100, 
                    mana: 50, 
                    maxMana: 50, 
                    role: ROLES.TANK,
                    alive: true,
                    position: { x: 100, y: 250 }
                },
                healer: { 
                    name: '–•–∏–ª–µ—Ä', 
                    health: 70, 
                    maxHealth: 70, 
                    mana: 100, 
                    maxMana: 100, 
                    role: ROLES.HEALER,
                    alive: true,
                    position: { x: 200, y: 250 }
                },
                support: { 
                    name: '–°–∞–ø–ø–æ—Ä—Ç', 
                    health: 60, 
                    maxHealth: 60, 
                    mana: 120, 
                    maxMana: 120, 
                    role: ROLES.SUPPORT,
                    alive: true,
                    position: { x: 300, y: 250 }
                },
                mage: { 
                    name: '–ú–∞–≥', 
                    health: 50, 
                    maxHealth: 50, 
                    mana: 150, 
                    maxMana: 150, 
                    role: ROLES.MAGE,
                    alive: true,
                    position: { x: 400, y: 250 }
                },
                archer: { 
                    name: '–õ—É—á–Ω–∏–∫', 
                    health: 60, 
                    maxHealth: 60, 
                    mana: 80, 
                    maxMana: 80, 
                    role: ROLES.ARCHER,
                    alive: true,
                    position: { x: 500, y: 250 }
                }
            };
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≥—Ä—É–ø–ø—ã
            updatePartyUI();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –∏–≥—Ä–æ–∫–∞
        function initPlayerAbilities() {
            const abilitiesContainer = document.getElementById('abilitySlots');
            abilitiesContainer.innerHTML = '';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
            let abilities = [];
            
            switch(gameState.playerRole) {
                case ROLES.TANK:
                    abilities = [
                        { id: 'taunt', name: '–ü—Ä–æ–≤–æ–∫–∞—Ü–∏—è', icon: 'üó£Ô∏è', cost: 10, cooldown: 10, description: '–ü—Ä–∏–Ω—É–∂–¥–∞–µ—Ç –≤—Å–µ—Ö –≤—Ä–∞–≥–æ–≤ –∞—Ç–∞–∫–æ–≤–∞—Ç—å —Ç–∞–Ω–∫–∞' },
                        { id: 'shield', name: '–©–∏—Ç', icon: 'üõ°Ô∏è', cost: 15, cooldown: 15, description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É –Ω–∞ 50% –Ω–∞ 5 —Å–µ–∫—É–Ω–¥' },
                        { id: 'strike', name: '–£–¥–∞—Ä', icon: '‚öîÔ∏è', cost: 5, cooldown: 3, description: '–ù–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω –æ–¥–Ω–æ–º—É –≤—Ä–∞–≥—É' },
                        { id: 'challenge', name: '–í—ã–∑–æ–≤', icon: 'üëä', cost: 20, cooldown: 20, description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —É–≥—Ä–æ–∑—É –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ' }
                    ];
                    break;
                case ROLES.HEALER:
                    abilities = [
                        { id: 'heal', name: '–õ–µ—á–µ–Ω–∏–µ', icon: '‚ù§Ô∏è', cost: 15, cooldown: 3, description: '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –æ–¥–Ω–æ–º—É —Å–æ—é–∑–Ω–∏–∫—É' },
                        { id: 'groupHeal', name: '–ì—Ä—É–ø–ø–æ–≤–æ–µ –ª–µ—á–µ–Ω–∏–µ', icon: 'üíñ', cost: 30, cooldown: 10, description: '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –≤—Å–µ–π –≥—Ä—É–ø–ø–µ' },
                        { id: 'resurrect', name: '–í–æ—Å–∫—Ä–µ—à–µ–Ω–∏–µ', icon: '‚≠ê', cost: 50, cooldown: 30, description: '–í–æ—Å–∫—Ä–µ—à–∞–µ—Ç –ø–∞–≤—à–µ–≥–æ —Å–æ—é–∑–Ω–∏–∫–∞' },
                        { id: 'barrier', name: '–ë–∞—Ä—å–µ—Ä', icon: 'üî∞', cost: 25, cooldown: 15, description: '–°–æ–∑–¥–∞–µ—Ç —â–∏—Ç, –ø–æ–≥–ª–æ—â–∞—é—â–∏–π —É—Ä–æ–Ω' }
                    ];
                    break;
                case ROLES.SUPPORT:
                    abilities = [
                        { id: 'buffAttack', name: '–ë–∞—Ñ—Ñ –∞—Ç–∞–∫–∏', icon: 'üìà', cost: 20, cooldown: 15, description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∞—Ç–∞–∫—É –≥—Ä—É–ø–ø—ã –Ω–∞ 20%' },
                        { id: 'buffDefense', name: '–ë–∞—Ñ—Ñ –∑–∞—â–∏—Ç—ã', icon: 'üìä', cost: 20, cooldown: 15, description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É –≥—Ä—É–ø–ø—ã –Ω–∞ 20%' },
                        { id: 'restoreMana', name: '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞–Ω—ã', icon: 'üîã', cost: 10, cooldown: 20, description: '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–∞–Ω—É –≤—Å–µ–π –≥—Ä—É–ø–ø–µ' },
                        { id: 'resurrect', name: '–í–æ—Å–∫—Ä–µ—à–µ–Ω–∏–µ', icon: '‚≠ê', cost: 40, cooldown: 25, description: '–í–æ—Å–∫—Ä–µ—à–∞–µ—Ç –ø–∞–≤—à–µ–≥–æ —Å–æ—é–∑–Ω–∏–∫–∞' }
                    ];
                    break;
                case ROLES.MAGE:
                    abilities = [
                        { id: 'fireball', name: '–û–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä', icon: 'üî•', cost: 20, cooldown: 5, description: '–ù–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω –æ–≥–Ω–µ–º –æ–¥–Ω–æ–º—É –≤—Ä–∞–≥—É' },
                        { id: 'frostbolt', name: '–õ–µ–¥—è–Ω–∞—è —Å—Ç—Ä–µ–ª–∞', icon: '‚ùÑÔ∏è', cost: 15, cooldown: 4, description: '–ù–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω –∏ –∑–∞–º–µ–¥–ª—è–µ—Ç –≤—Ä–∞–≥–∞' },
                        { id: 'lightning', name: '–ú–æ–ª–Ω–∏—è', icon: '‚ö°', cost: 30, cooldown: 8, description: '–ù–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –≤—Ä–∞–≥–∞–º' },
                        { id: 'dodge', name: '–£–≤–æ—Ä–æ—Ç', icon: 'üåÄ', cost: 10, cooldown: 10, description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —à–∞–Ω—Å —É–∫–ª–æ–Ω–µ–Ω–∏—è –Ω–∞ 50%' }
                    ];
                    break;
                case ROLES.ARCHER:
                    abilities = [
                        { id: 'shot', name: '–í—ã—Å—Ç—Ä–µ–ª', icon: 'üèπ', cost: 5, cooldown: 2, description: '–ë–∞–∑–æ–≤—ã–π –≤—ã—Å—Ç—Ä–µ–ª –ø–æ –≤—Ä–∞–≥—É' },
                        { id: 'multishot', name: '–ó–∞–ª–ø', icon: 'üéØ', cost: 15, cooldown: 6, description: '–í—ã—Å—Ç—Ä–µ–ª –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –≤—Ä–∞–≥–∞–º' },
                        { id: 'critShot', name: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –≤—ã—Å—Ç—Ä–µ–ª', icon: 'üí•', cost: 25, cooldown: 12, description: '–ú–æ—â–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª —Å –≤—ã—Å–æ–∫–∏–º —à–∞–Ω—Å–æ–º –∫—Ä–∏—Ç–∞' },
                        { id: 'dodge', name: '–£–≤–æ—Ä–æ—Ç', icon: 'üåÄ', cost: 10, cooldown: 10, description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —à–∞–Ω—Å —É–∫–ª–æ–Ω–µ–Ω–∏—è –Ω–∞ 50%' }
                    ];
                    break;
            }
            
            gameState.playerAbilities = abilities;
            
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
            abilities.forEach(ability => {
                const abilityElement = document.createElement('div');
                abilityElement.className = 'ability';
                abilityElement.setAttribute('data-ability', ability.id);
                
                abilityElement.innerHTML = `
                    <div class="ability-icon">${ability.icon}</div>
                    <div class="ability-name">${ability.name}</div>
                    <div class="ability-cost">${ability.cost} –º–∞–Ω—ã</div>
                `;
                
                abilityElement.addEventListener('click', function() {
                    useAbility(ability.id);
                });
                
                abilitiesContainer.appendChild(abilityElement);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫—É–ª–¥–∞—É–Ω
                gameState.abilityCooldowns[ability.id] = 0;
            });
        }

        // –ù–∞—á–∞—Ç—å –¥–∞–Ω–∂
        function startDungeon(dungeonIndex) {
            gameState.currentDungeon = dungeonIndex;
            gameState.currentWave = 0;
            
            const dungeon = DUNGEONS[dungeonIndex];
            document.getElementById('currentDungeon').textContent = dungeon.name;
            
            nextWave();
            
            addEvent(`–í–∞—à–∞ –≥—Ä—É–ø–ø–∞ –≤—Ö–æ–¥–∏—Ç –≤ ${dungeon.name}.`);
        }

        // –°–ª–µ–¥—É—é—â–∞—è –≤–æ–ª–Ω–∞ –≤—Ä–∞–≥–æ–≤
        function nextWave() {
            gameState.currentWave++;
            const dungeon = DUNGEONS[gameState.currentDungeon];
            
            if (gameState.currentWave > dungeon.waves) {
                // –î–∞–Ω–∂ –ø—Ä–æ–π–¥–µ–Ω
                completeDungeon();
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–∞–≥–æ–≤ –¥–ª—è –≤–æ–ª–Ω—ã
            gameState.enemies = [];
            const enemyCount = dungeon.enemiesPerWave;
            
            for (let i = 0; i < enemyCount; i++) {
                gameState.enemies.push({
                    id: i,
                    health: 30 + gameState.currentWave * 10,
                    maxHealth: 30 + gameState.currentWave * 10,
                    damage: 5 + gameState.currentWave * 2,
                    position: { x: 700 + i * 60, y: 100 + Math.random() * 300 },
                    alive: true,
                    target: null,
                    casting: null,
                    castProgress: 0
                });
            }
            
            document.getElementById('currentWave').textContent = gameState.currentWave;
            document.getElementById('enemiesLeft').textContent = gameState.enemies.length;
            document.getElementById('nextDungeon').disabled = true;
            
            addEvent(`–ü–æ—è–≤–ª—è–µ—Ç—Å—è –≤–æ–ª–Ω–∞ ${gameState.currentWave} –≤—Ä–∞–≥–æ–≤!`);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–Ω–≤–∞—Å
            drawGame();
        }

        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
        function useAbility(abilityId) {
            const ability = gameState.playerAbilities.find(a => a.id === abilityId);
            const player = gameState.party[gameState.playerRole];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—É–ª–¥–∞—É–Ω
            if (gameState.abilityCooldowns[abilityId] > 0) {
                addEvent(`–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å "${ability.name}" –µ—â–µ –Ω–∞ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–µ!`);
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞–Ω—É
            if (player.mana < ability.cost) {
                addEvent(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∞–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è "${ability.name}"!`);
                return;
            }
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
            player.mana -= ability.cost;
            gameState.abilityCooldowns[abilityId] = ability.cooldown;
            
            // –≠—Ñ—Ñ–µ–∫—Ç—ã —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç ID
            switch(abilityId) {
                case 'taunt':
                    gameState.enemies.forEach(enemy => {
                        enemy.target = 'tank';
                    });
                    addEvent(`${player.name} –∏—Å–ø–æ–ª—å–∑—É–µ—Ç "${ability.name}"! –í—Å–µ –≤—Ä–∞–≥–∏ —Ç–µ–ø–µ—Ä—å –∞—Ç–∞–∫—É—é—Ç —Ç–∞–Ω–∫–∞.`);
                    break;
                    
                case 'shield':
                    addEvent(`${player.name} –∏—Å–ø–æ–ª—å–∑—É–µ—Ç "${ability.name}"! –ó–∞—â–∏—Ç–∞ —É–≤–µ–ª–∏—á–µ–Ω–∞.`);
                    // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –∑–¥–µ—Å—å –±—ã–ª –±—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–π –±–∞—Ñ—Ñ
                    break;
                    
                case 'heal':
                    // –õ–µ—á–∏–º —Å–∞–º–æ–≥–æ —Ä–∞–Ω–µ–Ω–æ–≥–æ —Å–æ—é–∑–Ω–∏–∫–∞
                    let lowestHealth = 100;
                    let target = null;
                    
                    for (const role in gameState.party) {
                        const member = gameState.party[role];
                        if (member.alive && member.health < member.maxHealth) {
                            const healthPercent = member.health / member.maxHealth;
                            if (healthPercent < lowestHealth) {
                                lowestHealth = healthPercent;
                                target = role;
                            }
                        }
                    }
                    
                    if (target) {
                        const healAmount = 20;
                        gameState.party[target].health = Math.min(
                            gameState.party[target].maxHealth, 
                            gameState.party[target].health + healAmount
                        );
                        addEvent(`${player.name} –∏—Å–ø–æ–ª—å–∑—É–µ—Ç "${ability.name}" –Ω–∞ ${gameState.party[target].name}. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${healAmount} HP.`);
                    }
                    break;
                    
                case 'fireball':
                case 'shot':
                    // –ê—Ç–∞–∫—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—Ä–∞–≥–∞
                    const aliveEnemies = gameState.enemies.filter(e => e.alive);
                    if (aliveEnemies.length > 0) {
                        const targetEnemy = aliveEnemies[Math.floor(Math.random() * aliveEnemies.length)];
                        const damage = abilityId === 'fireball' ? 25 : 15;
                        targetEnemy.health -= damage;
                        
                        if (targetEnemy.health <= 0) {
                            targetEnemy.alive = false;
                            addEvent(`${player.name} –∏—Å–ø–æ–ª—å–∑—É–µ—Ç "${ability.name}" –∏ —É–±–∏–≤–∞–µ—Ç –≤—Ä–∞–≥–∞!`);
                        } else {
                            addEvent(`${player.name} –∏—Å–ø–æ–ª—å–∑—É–µ—Ç "${ability.name}" –∏ –Ω–∞–Ω–æ—Å–∏—Ç ${damage} —É—Ä–æ–Ω–∞ –≤—Ä–∞–≥—É.`);
                        }
                    }
                    break;
                    
                // –î—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏...
                default:
                    addEvent(`${player.name} –∏—Å–ø–æ–ª—å–∑—É–µ—Ç "${ability.name}".`);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updatePartyUI();
            updateAbilityUI();
        }

        // –ò–ò –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø–æ–π
        function updateAI() {
            for (const role in gameState.party) {
                if (role === gameState.playerRole) continue; // –ò–≥—Ä–æ–∫ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ
                
                const member = gameState.party[role];
                if (!member.alive) continue;
                
                // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –ò–ò –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
                switch(role) {
                    case ROLES.TANK:
                        // –¢–∞–Ω–∫ –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–æ–∫–∞—Ü–∏—é, –µ—Å–ª–∏ –≤—Ä–∞–≥–∏ –∞—Ç–∞–∫—É—é—Ç –Ω–µ –µ–≥–æ
                        let enemiesTargetingTank = 0;
                        gameState.enemies.forEach(enemy => {
                            if (enemy.target === 'tank') enemiesTargetingTank++;
                        });
                        
                        if (enemiesTargetingTank < gameState.enemies.length / 2 && member.mana >= 10) {
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–≤–æ–∫–∞—Ü–∏—é
                            gameState.enemies.forEach(enemy => {
                                enemy.target = 'tank';
                            });
                            member.mana -= 10;
                            addEvent(`–¢–∞–Ω–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç "–ü—Ä–æ–≤–æ–∫–∞—Ü–∏—é"!`);
                        }
                        break;
                        
                    case ROLES.HEALER:
                        // –•–∏–ª–µ—Ä –ª–µ—á–∏—Ç —Å–∞–º–æ–≥–æ —Ä–∞–Ω–µ–Ω–æ–≥–æ —Å–æ—é–∑–Ω–∏–∫–∞
                        let lowestHealth = 100;
                        let healTarget = null;
                        
                        for (const r in gameState.party) {
                            const m = gameState.party[r];
                            if (m.alive && m.health < m.maxHealth) {
                                const healthPercent = m.health / m.maxHealth;
                                if (healthPercent < lowestHealth) {
                                    lowestHealth = healthPercent;
                                    healTarget = r;
                                }
                            }
                        }
                        
                        if (healTarget && member.mana >= 15) {
                            const healAmount = 20;
                            gameState.party[healTarget].health = Math.min(
                                gameState.party[healTarget].maxHealth, 
                                gameState.party[healTarget].health + healAmount
                            );
                            member.mana -= 15;
                            addEvent(`–•–∏–ª–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç "–õ–µ—á–µ–Ω–∏–µ" –Ω–∞ ${gameState.party[healTarget].name}.`);
                        }
                        break;
                        
                    case ROLES.MAGE:
                    case ROLES.ARCHER:
                        // –î–î –∞—Ç–∞–∫—É—é—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—Ä–∞–≥–∞
                        const aliveEnemies = gameState.enemies.filter(e => e.alive);
                        if (aliveEnemies.length > 0 && member.mana >= 5) {
                            const targetEnemy = aliveEnemies[Math.floor(Math.random() * aliveEnemies.length)];
                            const damage = role === ROLES.MAGE ? 15 : 10;
                            targetEnemy.health -= damage;
                            member.mana -= 5;
                            
                            if (targetEnemy.health <= 0) {
                                targetEnemy.alive = false;
                                addEvent(`${member.name} —É–±–∏–≤–∞–µ—Ç –≤—Ä–∞–≥–∞!`);
                            } else {
                                addEvent(`${member.name} –∞—Ç–∞–∫—É–µ—Ç –≤—Ä–∞–≥–∞ –∏ –Ω–∞–Ω–æ—Å–∏—Ç ${damage} —É—Ä–æ–Ω–∞.`);
                            }
                        }
                        break;
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
        function updateEnemies() {
            for (let i = 0; i < gameState.enemies.length; i++) {
                const enemy = gameState.enemies[i];
                if (!enemy.alive) continue;
                
                // –ï—Å–ª–∏ —É –≤—Ä–∞–≥–∞ –Ω–µ—Ç —Ü–µ–ª–∏, –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ —á–ª–µ–Ω–∞ –≥—Ä—É–ø–ø—ã
                if (!enemy.target) {
                    const roles = Object.keys(gameState.party);
                    const aliveRoles = roles.filter(role => gameState.party[role].alive);
                    if (aliveRoles.length > 0) {
                        enemy.target = aliveRoles[Math.floor(Math.random() * aliveRoles.length)];
                    }
                }
                
                // –ê—Ç–∞–∫—É–µ–º —Ü–µ–ª—å
                if (enemy.target && gameState.party[enemy.target].alive) {
                    const target = gameState.party[enemy.target];
                    
                    // –ü—Ä–æ—Å—Ç–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –∞—Ç–∞–∫–∏ - –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
                    if (Math.random() < 0.05) { // 5% —à–∞–Ω—Å –∞—Ç–∞–∫–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Ü–∏–∫–ª
                        target.health -= enemy.damage;
                        addEvent(`–í—Ä–∞–≥ –∞—Ç–∞–∫—É–µ—Ç ${target.name} –∏ –Ω–∞–Ω–æ—Å–∏—Ç ${enemy.damage} —É—Ä–æ–Ω–∞.`);
                        
                        if (target.health <= 0) {
                            target.alive = false;
                            target.health = 0;
                            addEvent(`${target.name} –ø–∞–ª –≤ –±–æ—é!`);
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –º–µ—Ä—Ç–≤—ã
                            checkGameOver();
                        }
                    }
                }
            }
            
            // –£–¥–∞–ª—è–µ–º –º–µ—Ä—Ç–≤—ã—Ö –≤—Ä–∞–≥–æ–≤
            gameState.enemies = gameState.enemies.filter(enemy => enemy.alive);
            document.getElementById('enemiesLeft').textContent = gameState.enemies.length;
            
            // –ï—Å–ª–∏ –≤—Å–µ –≤—Ä–∞–≥–∏ –º–µ—Ä—Ç–≤—ã, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π –≤–æ–ª–Ω–µ
            if (gameState.enemies.length === 0) {
                setTimeout(() => {
                    nextWave();
                }, 1000);
            }
        }

        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (!gameState.gameActive) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫—É–ª–¥–∞—É–Ω—ã —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
            for (const abilityId in gameState.abilityCooldowns) {
                if (gameState.abilityCooldowns[abilityId] > 0) {
                    gameState.abilityCooldowns[abilityId]--;
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ò–ò –≥—Ä—É–ø–ø—ã
            updateAI();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–∞–≥–æ–≤
            updateEnemies();
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞–Ω—É
            for (const role in gameState.party) {
                const member = gameState.party[role];
                if (member.alive) {
                    member.mana = Math.min(member.maxMana, member.mana + 0.5);
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updatePartyUI();
            updateAbilityUI();
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–≥—Ä—É
            drawGame();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≥—Ä—É–ø–ø—ã
        function updatePartyUI() {
            for (const role in gameState.party) {
                const member = gameState.party[role];
                const memberElement = document.querySelector(`.member-icon.${role}`).closest('.party-member');
                
                const healthBar = memberElement.querySelector('.health-bar');
                const manaBar = memberElement.querySelector('.mana-bar');
                
                const healthPercent = (member.health / member.maxHealth) * 100;
                const manaPercent = (member.mana / member.maxMana) * 100;
                
                healthBar.style.width = `${healthPercent}%`;
                manaBar.style.width = `${manaPercent}%`;
                
                // –ï—Å–ª–∏ —á–ª–µ–Ω –≥—Ä—É–ø–ø—ã –º–µ—Ä—Ç–≤, –¥–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∏–ª—å
                if (!member.alive) {
                    memberElement.style.opacity = '0.5';
                } else {
                    memberElement.style.opacity = '1';
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
        function updateAbilityUI() {
            const abilityElements = document.querySelectorAll('.ability');
            
            abilityElements.forEach(element => {
                const abilityId = element.getAttribute('data-ability');
                const cooldown = gameState.abilityCooldowns[abilityId];
                const ability = gameState.playerAbilities.find(a => a.id === abilityId);
                const player = gameState.party[gameState.playerRole];
                
                if (cooldown > 0) {
                    element.classList.add('on-cooldown');
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –æ–≤–µ—Ä–ª–µ–π –∫—É–ª–¥–∞—É–Ω–∞
                    let cooldownOverlay = element.querySelector('.cooldown-overlay');
                    if (!cooldownOverlay) {
                        cooldownOverlay = document.createElement('div');
                        cooldownOverlay.className = 'cooldown-overlay';
                        element.appendChild(cooldownOverlay);
                    }
                    cooldownOverlay.textContent = cooldown;
                } else {
                    element.classList.remove('on-cooldown');
                    
                    // –£–¥–∞–ª—è–µ–º –æ–≤–µ—Ä–ª–µ–π –∫—É–ª–¥–∞—É–Ω–∞
                    const cooldownOverlay = element.querySelector('.cooldown-overlay');
                    if (cooldownOverlay) {
                        element.removeChild(cooldownOverlay);
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ö–≤–∞—Ç–∞–µ—Ç –ª–∏ –º–∞–Ω—ã
                if (player.mana < ability.cost) {
                    element.style.opacity = '0.5';
                } else {
                    element.style.opacity = '1';
                }
            });
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä—ã –Ω–∞ –∫–∞–Ω–≤–∞—Å–µ
        function drawGame() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–∞–Ω–≤–∞—Å–∞
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // –û—á–∏—â–∞–µ–º –∫–∞–Ω–≤–∞—Å
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º –≥—Ä—É–ø–ø—É
            for (const role in gameState.party) {
                const member = gameState.party[role];
                if (!member.alive) continue;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
                let color;
                switch(role) {
                    case ROLES.TANK: color = '#8B4513'; break;
                    case ROLES.HEALER: color = '#32CD32'; break;
                    case ROLES.SUPPORT: color = '#9370DB'; break;
                    case ROLES.MAGE: color = '#DC143C'; break;
                    case ROLES.ARCHER: color = '#FF8C00'; break;
                }
                
                // –†–∏—Å—É–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                ctx.fillStyle = color;
                ctx.fillRect(member.position.x, member.position.y, 40, 40);
                
                // –†–∏—Å—É–µ–º –ø–æ–ª–æ—Å–∫—É –∑–¥–æ—Ä–æ–≤—å—è
                const healthPercent = member.health / member.maxHealth;
                ctx.fillStyle = '#333';
                ctx.fillRect(member.position.x, member.position.y - 10, 40, 5);
                ctx.fillStyle = healthPercent > 0.3 ? '#FF4500' : '#FF0000';
                ctx.fillRect(member.position.x, member.position.y - 10, 40 * healthPercent, 5);
                
                // –†–∏—Å—É–µ–º –ø–æ–ª–æ—Å–∫—É –º–∞–Ω—ã
                const manaPercent = member.mana / member.maxMana;
                ctx.fillStyle = '#333';
                ctx.fillRect(member.position.x, member.position.y - 5, 40, 3);
                ctx.fillStyle = '#1E90FF';
                ctx.fillRect(member.position.x, member.position.y - 5, 40 * manaPercent, 3);
                
                // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º —Ä–æ–ª—å
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.fillText(member.name, member.position.x, member.position.y + 55);
            }
            
            // –†–∏—Å—É–µ–º –≤—Ä–∞–≥–æ–≤
            gameState.enemies.forEach(enemy => {
                if (!enemy.alive) return;
                
                // –†–∏—Å—É–µ–º –≤—Ä–∞–≥–∞
                ctx.fillStyle = '#8B0000';
                ctx.fillRect(enemy.position.x, enemy.position.y, 30, 30);
                
                // –†–∏—Å—É–µ–º –ø–æ–ª–æ—Å–∫—É –∑–¥–æ—Ä–æ–≤—å—è
                const healthPercent = enemy.health / enemy.maxHealth;
                ctx.fillStyle = '#333';
                ctx.fillRect(enemy.position.x, enemy.position.y - 10, 30, 5);
                ctx.fillStyle = healthPercent > 0.3 ? '#FF4500' : '#FF0000';
                ctx.fillRect(enemy.position.x, enemy.position.y - 10, 30 * healthPercent, 5);
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ –ª–æ–≥
        function addEvent(message) {
            const eventLog = document.getElementById('eventLog');
            const eventElement = document.createElement('div');
            eventElement.className = 'event';
            eventElement.textContent = message;
            
            eventLog.appendChild(eventElement);
            eventLog.scrollTop = eventLog.scrollHeight;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–±—ã—Ç–∏–π
            const events = eventLog.querySelectorAll('.event');
            if (events.length > 20) {
                events[0].remove();
            }
            
            gameState.eventLog.push(message);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è –ø–æ—Ä–∞–∂–µ–Ω–∏—è
        function checkGameOver() {
            let aliveCount = 0;
            for (const role in gameState.party) {
                if (gameState.party[role].alive) {
                    aliveCount++;
                }
            }
            
            if (aliveCount === 0) {
                gameOver();
            }
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–∞–Ω–∂–∞
        function completeDungeon() {
            const dungeon = DUNGEONS[gameState.currentDungeon];
            gameState.currency += dungeon.reward;
            
            addEvent(`–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø—Ä–æ—à–ª–∏ ${dungeon.name} –∏ –ø–æ–ª—É—á–∏–ª–∏ ${dungeon.reward} –∑–æ–ª–æ—Ç—ã—Ö.`);
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä—É–ø–ø—É
            for (const role in gameState.party) {
                const member = gameState.party[role];
                member.health = member.maxHealth;
                member.mana = member.maxMana;
                member.alive = true;
            }
            
            document.getElementById('nextDungeon').disabled = false;
            
            // –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–∞–Ω–∂, –Ω–∞—á–∏–Ω–∞–µ–º —Å–Ω–∞—á–∞–ª–∞ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é
            if (gameState.currentDungeon >= DUNGEONS.length - 1) {
                addEvent("–í—ã –ø—Ä–æ—à–ª–∏ –≤—Å–µ –¥–∞–Ω–∂–∏! –ù–∞—á–∏–Ω–∞–µ–º —Å–Ω–∞—á–∞–ª–∞ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é.");
                gameState.currentDungeon = 0;
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å (–∑–¥–æ—Ä–æ–≤—å–µ –∏ —É—Ä–æ–Ω –≤—Ä–∞–≥–æ–≤)
                DUNGEONS.forEach(dungeon => {
                    dungeon.enemiesPerWave += 1;
                });
            }
            
            updatePartyUI();
        }

        // –°–ª–µ–¥—É—é—â–∏–π –¥–∞–Ω–∂
        function nextDungeon() {
            gameState.currentDungeon++;
            if (gameState.currentDungeon >= DUNGEONS.length) {
                gameState.currentDungeon = 0;
            }
            
            startDungeon(gameState.currentDungeon);
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
        function openShop() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            gameState.gameActive = false;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã
            document.getElementById('currencyAmount').textContent = gameState.currency;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –º–∞–≥–∞–∑–∏–Ω —Ç–æ–≤–∞—Ä–∞–º–∏
            const shopItems = document.getElementById('shopItems');
            shopItems.innerHTML = '';
            
            const items = [
                { id: 'healthUp', name: '–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è', icon: '‚ù§Ô∏è', cost: 50, description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞ 10%' },
                { id: 'manaUp', name: '–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –º–∞–Ω—ã', icon: 'üîµ', cost: 50, description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –º–∞–Ω—É –Ω–∞ 10%' },
                { id: 'damageUp', name: '–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —É—Ä–æ–Ω–∞', icon: '‚öîÔ∏è', cost: 75, description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –Ω–∞–Ω–æ—Å–∏–º—ã–π —É—Ä–æ–Ω –Ω–∞ 10%' },
                { id: 'healingUp', name: '–£–ª—É—á—à–µ–Ω–∏–µ –ª–µ—á–µ–Ω–∏—è', icon: 'üíñ', cost: 75, description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è –Ω–∞ 15%' },
                { id: 'cooldownReduction', name: '–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏', icon: '‚è±Ô∏è', cost: 100, description: '–°–æ–∫—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º—è –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –Ω–∞ 10%' },
                { id: 'manaCostReduction', name: '–°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –º–∞–Ω—ã', icon: 'üîã', cost: 100, description: '–°–Ω–∏–∂–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –º–∞–Ω—ã —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –Ω–∞ 10%' }
            ];
            
            items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'shop-item';
                itemElement.setAttribute('data-item', item.id);
                
                itemElement.innerHTML = `
                    <div class="item-icon">${item.icon}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-desc">${item.description}</div>
                    <div class="item-cost">${item.cost} –∑–æ–ª–æ—Ç—ã—Ö</div>
                `;
                
                itemElement.addEventListener('click', function() {
                    buyItem(item.id, item.cost);
                });
                
                shopItems.appendChild(itemElement);
            });
            
            switchScreen('shopScreen');
        }

        // –ü–æ–∫—É–ø–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
        function buyItem(itemId, cost) {
            if (gameState.currency < cost) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!');
                return;
            }
            
            gameState.currency -= cost;
            document.getElementById('currencyAmount').textContent = gameState.currency;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–µ–¥–º–µ—Ç–∞
            switch(itemId) {
                case 'healthUp':
                    for (const role in gameState.party) {
                        const member = gameState.party[role];
                        member.maxHealth = Math.floor(member.maxHealth * 1.1);
                        member.health = member.maxHealth;
                    }
                    addEvent('–ó–¥–æ—Ä–æ–≤—å–µ –≤—Å–µ–π –≥—Ä—É–ø–ø—ã —É–≤–µ–ª–∏—á–µ–Ω–æ –Ω–∞ 10%!');
                    break;
                    
                case 'manaUp':
                    for (const role in gameState.party) {
                        const member = gameState.party[role];
                        member.maxMana = Math.floor(member.maxMana * 1.1);
                        member.mana = member.maxMana;
                    }
                    addEvent('–ú–∞–Ω–∞ –≤—Å–µ–π –≥—Ä—É–ø–ø—ã —É–≤–µ–ª–∏—á–µ–Ω–∞ –Ω–∞ 10%!');
                    break;
                    
                case 'damageUp':
                    // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –∑–¥–µ—Å—å –±—ã–ª –±—ã –±–∞—Ñ—Ñ —É—Ä–æ–Ω–∞
                    addEvent('–£—Ä–æ–Ω –≥—Ä—É–ø–ø—ã —É–≤–µ–ª–∏—á–µ–Ω –Ω–∞ 10%!');
                    break;
                    
                case 'healingUp':
                    // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –∑–¥–µ—Å—å –±—ã–ª –±—ã –±–∞—Ñ—Ñ –ª–µ—á–µ–Ω–∏—è
                    addEvent('–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è —É–≤–µ–ª–∏—á–µ–Ω–∞ –Ω–∞ 15%!');
                    break;
                    
                case 'cooldownReduction':
                    // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –∑–¥–µ—Å—å –±—ã–ª–æ –±—ã —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫—É–ª–¥–∞—É–Ω–æ–≤
                    addEvent('–ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π —Å–æ–∫—Ä–∞—â–µ–Ω–∞ –Ω–∞ 10%!');
                    break;
                    
                case 'manaCostReduction':
                    // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –∑–¥–µ—Å—å –±—ã–ª–æ –±—ã —Å–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –º–∞–Ω—ã
                    addEvent('–°—Ç–æ–∏–º–æ—Å—Ç—å –º–∞–Ω—ã —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π —Å–Ω–∏–∂–µ–Ω–∞ –Ω–∞ 10%!');
                    break;
            }
            
            updatePartyUI();
        }

        // –í–æ–∑–≤—Ä–∞—Ç –∫ –∏–≥—Ä–µ –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞
        function backToGame() {
            gameState.gameActive = true;
            switchScreen('gameScreen');
        }

        // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
        function gameOver() {
            gameState.gameActive = false;
            clearInterval(gameState.gameLoopInterval);
            
            document.getElementById('dungeonsCompleted').textContent = gameState.currentDungeon;
            switchScreen('gameOverScreen');
        }

        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        function restartGame() {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
            gameState = {
                playerRole: gameState.playerRole, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ä–æ–ª—å
                party: {},
                enemies: [],
                currentDungeon: 0,
                currentWave: 0,
                currency: 100,
                gameActive: false,
                abilities: {},
                abilityCooldowns: {},
                playerAbilities: [],
                eventLog: [],
                gameLoopInterval: null
            };
            
            // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–Ω–æ–≤–æ
            startGame();
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤
        function switchScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.classList.remove('active');
            });
            
            document.getElementById(screenId).classList.add('active');
        }
    </script>
</body>
</html>
