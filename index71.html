<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Adventure</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 100%;
            padding: 10px;
            background-color: #1a1a2e;
            color: #e6e6e6;
            font-size: 14px;
            line-height: 1.4;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .panel {
            background-color: #16213e;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        .stats-panel {
            grid-column: 1 / 3;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            padding: 8px;
        }
        .location-panel {
            grid-column: 1 / 3;
            text-align: center;
            padding: 8px;
        }
        button {
            background-color: #0f3460;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin: 3px;
            font-size: 12px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #1a5fb4;
        }
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        .small-button {
            padding: 3px 6px;
            font-size: 11px;
            margin: 2px;
        }
        .progress-bar {
            height: 15px;
            background-color: #333;
            border-radius: 8px;
            margin: 5px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            border-radius: 8px;
            transition: width 0.3s;
        }
        .hp-fill {
            background-color: #e94560;
        }
        .xp-fill {
            background-color: #533483;
        }
        .log {
            height: 100px;
            overflow-y: auto;
            background-color: #0f3460;
            padding: 8px;
            border-radius: 4px;
            margin-top: 8px;
            font-size: 12px;
        }
        .log p {
            margin: 3px 0;
        }
        .inventory {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }
        .item {
            background-color: #0f3460;
            padding: 6px;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            font-size: 12px;
        }
        .equipment {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }
        .equipment-slot {
            background-color: #0f3460;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            min-height: 50px;
            font-size: 12px;
        }
        .combat-log {
            color: #e94560;
            font-weight: bold;
        }
        .loot-log {
            color: #4ecca3;
            font-weight: bold;
        }
        .info-log {
            color: #533483;
            font-weight: bold;
        }
        .npc-log {
            color: #f9a826;
            font-weight: bold;
        }
        h1 {
            font-size: 18px;
            text-align: center;
            margin-bottom: 10px;
        }
        h2 {
            font-size: 16px;
            margin-bottom: 5px;
        }
        h3 {
            font-size: 14px;
            margin-bottom: 5px;
        }
        p {
            margin: 3px 0;
            font-size: 12px;
        }
        .resource {
            display: inline-block;
            margin: 2px 5px 2px 0;
            padding: 2px 5px;
            background: #0f3460;
            border-radius: 3px;
            font-size: 12px;
        }
        .auto-combat {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 5px 0;
        }
        @media (max-width: 480px) {
            .container {
                grid-template-columns: 1fr;
            }
            .stats-panel, .location-panel {
                grid-column: 1;
            }
            .inventory {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <h1>RPG Adventure</h1>
    
    <div class="stats-panel panel">
        <div>
            <h3>–ì–µ—Ä–æ–π</h3>
            <p>–£—Ä: <span id="level">1</span></p>
            <p>–û–ø—ã—Ç: <span id="xp">0</span>/<span id="nextLevelXp">100</span></p>
            <div class="progress-bar">
                <div class="progress-fill xp-fill" id="xpBar" style="width: 0%;"></div>
            </div>
        </div>
        <div>
            <h3>–ó–¥–æ—Ä–æ–≤—å–µ</h3>
            <p><span id="hp">50</span>/<span id="maxHp">50</span></p>
            <div class="progress-bar">
                <div class="progress-fill hp-fill" id="hpBar" style="width: 100%;"></div>
            </div>
            <button id="usePotionButton" class="small-button">–ó–µ–ª—å–µ</button>
        </div>
        <div>
            <h3>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
            <p>–ê—Ç–∞–∫–∞: <span id="attack">5</span></p>
            <p>–ó–∞—â–∏—Ç–∞: <span id="defense">2</span></p>
        </div>
    </div>
    
    <div class="location-panel panel">
        <h2 id="locationName">–î–µ—Ä–µ–≤–Ω—è</h2>
        <p id="locationDescription">–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ —Å–≤–æ–µ–π —Ä–æ–¥–Ω–æ–π –¥–µ—Ä–µ–≤–Ω–µ.</p>
        <div id="locationActions">
            <button id="travelButton">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ</button>
        </div>
        <div class="log" id="actionLog"></div>
    </div>
    
    <div class="panel">
        <h3>–†–µ—Å—É—Ä—Å—ã</h3>
        <div id="resources">
            <span class="resource">‚õèÔ∏è: <span id="ore">0</span></span>
            <span class="resource">ü™µ: <span id="wood">0</span></span>
            <span class="resource">ü™®: <span id="stone">0</span></span>
            <span class="resource">üî•: <span id="coal">0</span></span>
            <span class="resource">üî®: <span id="hammer">0</span></span>
            <span class="resource">‚öíÔ∏è: <span id="brand">0</span></span>
            <span class="resource">üí†: <span id="crystal">0</span></span>
            <span class="resource">‚ù§Ô∏è: <span id="potions">0</span></span>
        </div>
    </div>
    
    <div class="panel">
        <h3>–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞</h3>
        <div class="equipment">
            <div class="equipment-slot" data-slot="weapon">‚öîÔ∏è: –ù–µ—Ç</div>
            <div class="equipment-slot" data-slot="armor">üõ°Ô∏è: –ù–µ—Ç</div>
            <div class="equipment-slot" data-slot="helmet">‚õëÔ∏è: –ù–µ—Ç</div>
            <div class="equipment-slot" data-slot="boots">üë¢: –ù–µ—Ç</div>
        </div>
    </div>
    
    <div class="panel">
        <h3>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
        <div class="inventory" id="inventory"></div>
    </div>

    <script>
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´
        const CONFIG = {
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä–æ–∫–∞
            player: {
                baseHp: 50,
                baseAttack: 5,
                baseDefense: 2,
                xpMultiplier: 1.5
            },
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–∞–≥–æ–≤
            enemies: {
                forest: ['–í–æ–ª–∫', '–ö–∞–±–∞–Ω'],
                mountains: ['–û—Ä–∫', '–ì–æ–±–ª–∏–Ω'],
                cave: ['–°–∫–µ–ª–µ—Ç', '–ü–∞—É–∫'],
                lake: ['–†—ã–±–∞-–º–æ–Ω—Å—Ç—Ä', '–í–æ–¥—è–Ω–æ–π'],
                baseHp: 15,
                baseAttack: 3,
                baseDefense: 1,
                variation: 10
            },
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥—Ä–æ–ø–∞
            dropRates: {
                ore: 0.8,
                wood: 0.7,
                stone: 0.6,
                coal: 0.5,
                hammer: 0.3,
                brand: 0.2,
                crystal: 0.1,
                potion: 0.4
            },
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—Ä–∞—Ñ—Ç–∞
            crafting: {
                wooden_sword: { ore: 2, wood: 3 },
                leather_armor: { ore: 2, wood: 2, coal: 1 },
                leather_helmet: { ore: 1, wood: 2 },
                leather_boots: { ore: 1, wood: 1, coal: 1 },
                iron_sword: { ore: 5, coal: 2 },
                chain_armor: { ore: 6, coal: 3 },
                iron_helmet: { ore: 3, coal: 1 },
                iron_boots: { ore: 3, coal: 2 },
                health_potion: { wood: 2, stone: 1 }
            },
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—è
            combat: {
                fleeChance: 0.6,
                autoAttackInterval: 1500,
                potionHeal: 20
            }
        };

        // –ò–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        const game = {
            player: {
                level: 1,
                xp: 0,
                nextLevelXp: 100,
                hp: CONFIG.player.baseHp,
                maxHp: CONFIG.player.baseHp,
                attack: CONFIG.player.baseAttack,
                defense: CONFIG.player.baseDefense,
                resources: {
                    ore: 0,
                    wood: 0,
                    stone: 0,
                    coal: 0,
                    hammer: 0,
                    brand: 0,
                    crystal: 0,
                    potions: 0
                },
                inventory: [],
                equipment: {
                    weapon: null,
                    armor: null,
                    helmet: null,
                    boots: null
                }
            },
            locations: [
                {
                    id: 'village',
                    name: '–î–µ—Ä–µ–≤–Ω—è',
                    description: '–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ —Å–≤–æ–µ–π —Ä–æ–¥–Ω–æ–π –¥–µ—Ä–µ–≤–Ω–µ.',
                    actions: ['travel']
                },
                {
                    id: 'forest',
                    name: '–õ–µ—Å',
                    description: '–í—ã –≤ –≥—É—Å—Ç–æ–º –ª–µ—Å—É. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –¥–µ—Ä–µ–≤–æ.',
                    actions: ['gather', 'combat', 'return'],
                    gatherResource: 'wood',
                    enemies: CONFIG.enemies.forest
                },
                {
                    id: 'mountains',
                    name: '–ì–æ—Ä—ã',
                    description: '–í—ã –≤ –≤—ã—Å–æ–∫–∏—Ö –≥–æ—Ä–∞—Ö. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±—ã–≤–∞—Ç—å –∫–∞–º–µ–Ω—å.',
                    actions: ['gather', 'combat', 'return'],
                    gatherResource: 'stone',
                    enemies: CONFIG.enemies.mountains
                },
                {
                    id: 'cave',
                    name: '–ü–µ—â–µ—Ä–∞',
                    description: '–í—ã –≤ —Ç–µ–º–Ω–æ–π –ø–µ—â–µ—Ä–µ. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±—ã–≤–∞—Ç—å —Ä—É–¥—É.',
                    actions: ['gather', 'combat', 'return'],
                    gatherResource: 'ore',
                    enemies: CONFIG.enemies.cave
                },
                {
                    id: 'lake',
                    name: '–û–∑–µ—Ä–æ',
                    description: '–í—ã —É —Ç–∏—Ö–æ–≥–æ –æ–∑–µ—Ä–∞. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ —É–≥–æ–ª—å.',
                    actions: ['gather', 'combat', 'return'],
                    gatherResource: 'coal',
                    enemies: CONFIG.enemies.lake
                }
            ],
            currentLocation: 'village',
            currentEnemy: null,
            inCombat: false,
            autoCombat: false,
            blacksmithAvailable: false,
            items: {
                // –û—Ä—É–∂–∏–µ
                'wooden_sword': { name: '–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π –º–µ—á', type: 'weapon', attack: 3, tier: 1 },
                'iron_sword': { name: '–ñ–µ–ª–µ–∑–Ω—ã–π –º–µ—á', type: 'weapon', attack: 7, tier: 2 },
                'steel_sword': { name: '–°—Ç–∞–ª—å–Ω–æ–π –º–µ—á', type: 'weapon', attack: 12, tier: 3 },
                
                // –ë—Ä–æ–Ω—è
                'leather_armor': { name: '–ö–æ–∂–∞–Ω–∞—è –±—Ä–æ–Ω—è', type: 'armor', defense: 3, tier: 1 },
                'chain_armor': { name: '–ö–æ–ª—å—á—É–≥–∞', type: 'armor', defense: 6, tier: 2 },
                'plate_armor': { name: '–õ–∞—Ç–Ω–∞—è –±—Ä–æ–Ω—è', type: 'armor', defense: 10, tier: 3 },
                
                // –®–ª–µ–º—ã
                'leather_helmet': { name: '–ö–æ–∂–∞–Ω—ã–π —à–ª–µ–º', type: 'helmet', defense: 1, tier: 1 },
                'iron_helmet': { name: '–ñ–µ–ª–µ–∑–Ω—ã–π —à–ª–µ–º', type: 'helmet', defense: 2, tier: 2 },
                'steel_helmet': { name: '–°—Ç–∞–ª—å–Ω–æ–π —à–ª–µ–º', type: 'helmet', defense: 4, tier: 3 },
                
                // –û–±—É–≤—å
                'leather_boots': { name: '–ö–æ–∂–∞–Ω—ã–µ —Å–∞–ø–æ–≥–∏', type: 'boots', defense: 1, tier: 1 },
                'iron_boots': { name: '–ñ–µ–ª–µ–∑–Ω—ã–µ —Å–∞–ø–æ–≥–∏', type: 'boots', defense: 2, tier: 2 },
                'steel_boots': { name: '–°—Ç–∞–ª—å–Ω—ã–µ —Å–∞–ø–æ–≥–∏', type: 'boots', defense: 3, tier: 3 },
                
                // –ü—Ä–æ—á–µ–µ
                'health_potion': { name: '–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è', type: 'consumable', restore: CONFIG.combat.potionHeal }
            },
            autoAttackInterval: null
        };

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const elements = {
            level: document.getElementById('level'),
            xp: document.getElementById('xp'),
            nextLevelXp: document.getElementById('nextLevelXp'),
            xpBar: document.getElementById('xpBar'),
            hp: document.getElementById('hp'),
            maxHp: document.getElementById('maxHp'),
            hpBar: document.getElementById('hpBar'),
            attack: document.getElementById('attack'),
            defense: document.getElementById('defense'),
            locationName: document.getElementById('locationName'),
            locationDescription: document.getElementById('locationDescription'),
            locationActions: document.getElementById('locationActions'),
            actionLog: document.getElementById('actionLog'),
            ore: document.getElementById('ore'),
            wood: document.getElementById('wood'),
            stone: document.getElementById('stone'),
            coal: document.getElementById('coal'),
            hammer: document.getElementById('hammer'),
            brand: document.getElementById('brand'),
            crystal: document.getElementById('crystal'),
            potions: document.getElementById('potions'),
            inventory: document.getElementById('inventory'),
            travelButton: document.getElementById('travelButton'),
            usePotionButton: document.getElementById('usePotionButton')
        };

        // –§—É–Ω–∫—Ü–∏–∏ –∏–≥—Ä—ã
        function logMessage(message, type = 'info') {
            const logEntry = document.createElement('p');
            logEntry.innerHTML = message;
            logEntry.className = `${type}-log`;
            elements.actionLog.appendChild(logEntry);
            elements.actionLog.scrollTop = elements.actionLog.scrollHeight;
        }

        function updateStats() {
            elements.level.textContent = game.player.level;
            elements.xp.textContent = game.player.xp;
            elements.nextLevelXp.textContent = game.player.nextLevelXp;
            elements.xpBar.style.width = `${(game.player.xp / game.player.nextLevelXp) * 100}%`;
            
            elements.hp.textContent = game.player.hp;
            elements.maxHp.textContent = game.player.maxHp;
            elements.hpBar.style.width = `${(game.player.hp / game.player.maxHp) * 100}%`;
            
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å —É—á–µ—Ç–æ–º —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏
            let totalAttack = game.player.attack;
            let totalDefense = game.player.defense;
            
            for (const slot in game.player.equipment) {
                const item = game.player.equipment[slot];
                if (item) {
                    if (game.items[item].attack) totalAttack += game.items[item].attack;
                    if (game.items[item].defense) totalDefense += game.items[item].defense;
                }
            }
            
            elements.attack.textContent = totalAttack;
            elements.defense.textContent = totalDefense;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ—Å—É—Ä—Å—ã
            elements.ore.textContent = game.player.resources.ore;
            elements.wood.textContent = game.player.resources.wood;
            elements.stone.textContent = game.player.resources.stone;
            elements.coal.textContent = game.player.resources.coal;
            elements.hammer.textContent = game.player.resources.hammer;
            elements.brand.textContent = game.player.resources.brand;
            elements.crystal.textContent = game.player.resources.crystal;
            elements.potions.textContent = game.player.resources.potions;
            
            updateInventory();
            updateEquipment();
        }

        function updateInventory() {
            elements.inventory.innerHTML = '';
            
            game.player.inventory.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'item';
                
                const itemName = document.createElement('div');
                itemName.textContent = game.items[item].name;
                itemElement.appendChild(itemName);
                
                const useButton = document.createElement('button');
                useButton.textContent = '–ò—Å–ø';
                useButton.className = 'small-button';
                useButton.onclick = () => useItem(index);
                itemElement.appendChild(useButton);
                
                const sellButton = document.createElement('button');
                sellButton.textContent = '–ü—Ä–æ–¥–∞—Ç—å';
                sellButton.className = 'small-button';
                sellButton.onclick = () => sellItem(index);
                itemElement.appendChild(sellButton);
                
                elements.inventory.appendChild(itemElement);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏
            const emptySlots = 9 - game.player.inventory.length;
            for (let i = 0; i < emptySlots; i++) {
                const emptySlot = document.createElement('div');
                emptySlot.className = 'item';
                emptySlot.textContent = '–ü—É—Å—Ç–æ';
                elements.inventory.appendChild(emptySlot);
            }
        }

        function updateEquipment() {
            for (const slot in game.player.equipment) {
                const element = document.querySelector(`.equipment-slot[data-slot="${slot}"]`);
                const item = game.player.equipment[slot];
                
                element.innerHTML = '';
                
                const slotName = document.createElement('div');
                slotName.textContent = slot === 'weapon' ? '‚öîÔ∏è' : 
                                      slot === 'armor' ? 'üõ°Ô∏è' : 
                                      slot === 'helmet' ? '‚õëÔ∏è' : 'üë¢';
                element.appendChild(slotName);
                
                const itemName = document.createElement('div');
                itemName.textContent = item ? game.items[item].name : '–ù–µ—Ç';
                element.appendChild(itemName);
                
                if (item) {
                    const sellButton = document.createElement('button');
                    sellButton.textContent = '–ü—Ä–æ–¥–∞—Ç—å';
                    sellButton.className = 'small-button';
                    sellButton.onclick = () => sellEquippedItem(slot);
                    element.appendChild(sellButton);
                }
            }
        }

        function useItem(index) {
            if (index >= game.player.inventory.length) return;
            
            const itemId = game.player.inventory[index];
            const item = game.items[itemId];
            
            if (item.type === 'consumable') {
                game.player.hp = Math.min(game.player.maxHp, game.player.hp + item.restore);
                game.player.inventory.splice(index, 1);
                logMessage(`–í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ ${item.name} –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ ${item.restore} HP.`, 'combat');
                updateStats();
            } else if (['weapon', 'armor', 'helmet', 'boots'].includes(item.type)) {
                // –°–Ω–∏–º–∞–µ–º —Ç–µ–∫—É—â—É—é —ç–∫–∏–ø–∏—Ä–æ–≤–∫—É
                const currentItem = game.player.equipment[item.type];
                if (currentItem) {
                    game.player.inventory.push(currentItem);
                }
                
                // –ù–∞–¥–µ–≤–∞–µ–º –Ω–æ–≤—É—é —ç–∫–∏–ø–∏—Ä–æ–≤–∫—É
                game.player.equipment[item.type] = itemId;
                game.player.inventory.splice(index, 1);
                logMessage(`–í—ã —ç–∫–∏–ø–∏—Ä–æ–≤–∞–ª–∏ ${item.name}.`, 'info');
                updateStats();
            }
        }

        function usePotion() {
            if (game.player.resources.potions > 0) {
                game.player.resources.potions--;
                game.player.hp = Math.min(game.player.maxHp, game.player.hp + CONFIG.combat.potionHeal);
                logMessage(`–í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –∑–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ ${CONFIG.combat.potionHeal} HP.`, 'combat');
                updateStats();
            } else {
                logMessage('–£ –≤–∞—Å –Ω–µ—Ç –∑–µ–ª–∏–π –∑–¥–æ—Ä–æ–≤—å—è!', 'info');
            }
        }

        function sellItem(index) {
            if (index >= game.player.inventory.length) return;
            
            const itemId = game.player.inventory[index];
            const item = game.items[itemId];
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–µ–Ω—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏—Ä–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
            let price = 0;
            if (item.tier === 1) price = 3;
            else if (item.tier === 2) price = 7;
            else if (item.tier === 3) price = 15;
            else if (item.type === 'consumable') price = 2;
            
            // –ü—Ä–æ–¥–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç
            game.player.inventory.splice(index, 1);
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ä–µ—Å—É—Ä—Å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ–ø–ª–∞—Ç—ã
            const resources = ['ore', 'wood', 'stone', 'coal'];
            const randomResource = resources[Math.floor(Math.random() * resources.length)];
            game.player.resources[randomResource] += price;
            
            logMessage(`–í—ã –ø—Ä–æ–¥–∞–ª–∏ ${item.name} –∑–∞ ${price} ${randomResource === 'ore' ? '—Ä—É–¥—ã' : randomResource === 'wood' ? '–¥–µ—Ä–µ–≤–∞' : randomResource === 'stone' ? '–∫–∞–º–Ω—è' : '—É–≥–ª—è'}.`, 'loot');
            updateStats();
        }

        function sellEquippedItem(slot) {
            const itemId = game.player.equipment[slot];
            if (!itemId) return;
            
            const item = game.items[itemId];
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–µ–Ω—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏—Ä–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
            let price = 0;
            if (item.tier === 1) price = 5;
            else if (item.tier === 2) price = 10;
            else if (item.tier === 3) price = 20;
            
            // –ü—Ä–æ–¥–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç
            game.player.equipment[slot] = null;
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ä–µ—Å—É—Ä—Å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ–ø–ª–∞—Ç—ã
            const resources = ['ore', 'wood', 'stone', 'coal'];
            const randomResource = resources[Math.floor(Math.random() * resources.length)];
            game.player.resources[randomResource] += price;
            
            logMessage(`–í—ã –ø—Ä–æ–¥–∞–ª–∏ ${item.name} –∑–∞ ${price} ${randomResource === 'ore' ? '—Ä—É–¥—ã' : randomResource === 'wood' ? '–¥–µ—Ä–µ–≤–∞' : randomResource === 'stone' ? '–∫–∞–º–Ω—è' : '—É–≥–ª—è'}.`, 'loot');
            updateStats();
        }

        function travel() {
            // –°–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –≤—ã–±–∏—Ä–∞–µ–º –ª–æ–∫–∞—Ü–∏—é (–∫—Ä–æ–º–µ –¥–µ—Ä–µ–≤–Ω–∏)
            const availableLocations = game.locations.filter(loc => loc.id !== 'village');
            const randomLocation = availableLocations[Math.floor(Math.random() * availableLocations.length)];
            
            game.currentLocation = randomLocation.id;
            updateLocation();
            
            // –° –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 30% –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫—É–∑–Ω–µ—Ü
            game.blacksmithAvailable = Math.random() < 0.3;
            
            logMessage(`–í—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å –≤: ${randomLocation.name}.`, 'info');
            
            if (game.blacksmithAvailable) {
                logMessage('–í—ã –∑–∞–º–µ—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω—Å—Ç–≤—É—é—â–µ–≥–æ –∫—É–∑–Ω–µ—Ü–∞.', 'npc');
            }
        }

        function gatherResource() {
            const location = game.locations.find(loc => loc.id === game.currentLocation);
            if (!location || !location.gatherResource) return;
            
            const resource = location.gatherResource;
            let amount = 1;
            
            // –®–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ—Å—É—Ä—Å
            if (Math.random() < 0.3) amount++;
            
            game.player.resources[resource] += amount;
            logMessage(`–í—ã —Å–æ–±—Ä–∞–ª–∏ ${amount} ${resource === 'wood' ? '–¥–µ—Ä–µ–≤–∞' : resource === 'stone' ? '–∫–∞–º–Ω—è' : resource === 'ore' ? '—Ä—É–¥—ã' : '—É–≥–ª—è'}.`, 'loot');
            
            // –®–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
            for (const [res, chance] of Object.entries(CONFIG.dropRates)) {
                if (Math.random() < chance) {
                    game.player.resources[res]++;
                    logMessage(`–í—ã –Ω–∞—à–ª–∏ ${res === 'hammer' ? '–º–æ–ª–æ—Ç' : res === 'brand' ? '–∫–ª–µ–π–º–æ' : res === 'crystal' ? '–∫—Ä–∏—Å—Ç–∞–ª–ª' : '–∑–µ–ª—å–µ'}!`, 'loot');
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –ª–∏ –≤—Ä–∞–≥ (50% —à–∞–Ω—Å)
            if (Math.random() < 0.5) {
                startCombat();
            }
            
            updateStats();
        }

        function startCombat() {
            if (game.inCombat) return;
            
            const location = game.locations.find(loc => loc.id === game.currentLocation);
            if (!location || !location.enemies) return;
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—Ä–∞–≥–∞
            const enemyName = location.enemies[Math.floor(Math.random() * location.enemies.length)];
            
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–∞–≥–∞
            game.currentEnemy = {
                name: enemyName,
                hp: CONFIG.enemies.baseHp + Math.floor(Math.random() * CONFIG.enemies.variation),
                maxHp: CONFIG.enemies.baseHp + Math.floor(Math.random() * CONFIG.enemies.variation),
                attack: CONFIG.enemies.baseAttack + Math.floor(Math.random() * 3),
                defense: CONFIG.enemies.baseDefense + Math.floor(Math.random() * 2)
            };
            
            game.inCombat = true;
            game.autoCombat = false;
            
            logMessage(`–ù–∞ –≤–∞—Å –Ω–∞–ø–∞–ª ${enemyName}!`, 'combat');
            updateCombatUI();
        }

        function updateCombatUI() {
            if (game.inCombat) {
                elements.locationActions.innerHTML = `
                    <button id="attackButton">–ê—Ç–∞–∫–∞</button>
                    <button id="autoAttackButton">–ê–≤—Ç–æ–∞—Ç–∞–∫–∞</button>
                    <button id="fleeButton">–°–±–µ–∂–∞—Ç—å</button>
                    <div class="auto-combat">
                        <span>–ê–≤—Ç–æ–∞—Ç–∞–∫–∞: ${game.autoCombat ? '–í–ö–õ' : '–í–´–ö–õ'}</span>
                    </div>
                    <div>
                        <h3>${game.currentEnemy.name}</h3>
                        <p>HP: ${game.currentEnemy.hp}/${game.currentEnemy.maxHp}</p>
                    </div>
                `;
                
                document.getElementById('attackButton').onclick = attackEnemy;
                document.getElementById('autoAttackButton').onclick = toggleAutoAttack;
                document.getElementById('fleeButton').onclick = fleeCombat;
            } else {
                updateLocation();
            }
        }

        function attackEnemy() {
            if (!game.inCombat) return;
            performAttack();
        }

        function toggleAutoAttack() {
            game.autoCombat = !game.autoCombat;
            
            if (game.autoCombat) {
                logMessage('–ê–≤—Ç–æ–∞—Ç–∞–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞.', 'info');
                game.autoAttackInterval = setInterval(performAttack, CONFIG.combat.autoAttackInterval);
            } else {
                logMessage('–ê–≤—Ç–æ–∞—Ç–∞–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞.', 'info');
                clearInterval(game.autoAttackInterval);
            }
            updateCombatUI();
        }

        function performAttack() {
            if (!game.inCombat || !game.currentEnemy) return;
            
            // –í—ã—á–∏—Å–ª—è–µ–º —É—Ä–æ–Ω –∏–≥—Ä–æ–∫–∞
            let playerAttack = game.player.attack;
            if (game.player.equipment.weapon) {
                playerAttack += game.items[game.player.equipment.weapon].attack;
            }
            
            const playerDamage = Math.max(1, playerAttack - game.currentEnemy.defense);
            game.currentEnemy.hp -= playerDamage;
            
            logMessage(`–í—ã –Ω–∞–Ω–µ—Å–ª–∏ ${playerDamage} —É—Ä–æ–Ω–∞ ${game.currentEnemy.name}.`, 'combat');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–±–µ–∂–¥–µ–Ω –ª–∏ –≤—Ä–∞–≥
            if (game.currentEnemy.hp <= 0) {
                endCombat(true);
                return;
            }
            
            // –•–æ–¥ –≤—Ä–∞–≥–∞
            const enemyDamage = Math.max(1, game.currentEnemy.attack - game.player.defense);
            game.player.hp -= enemyDamage;
            
            logMessage(`${game.currentEnemy.name} –Ω–∞–Ω–æ—Å–∏—Ç –≤–∞–º ${enemyDamage} —É—Ä–æ–Ω–∞.`, 'combat');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–±–µ–∂–¥–µ–Ω –ª–∏ –∏–≥—Ä–æ–∫
            if (game.player.hp <= 0) {
                game.player.hp = 0;
                logMessage('–í—ã –ø–æ–±–µ–∂–¥–µ–Ω—ã! –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç–µ—Å—å –≤ –¥–µ—Ä–µ–≤–Ω—é.', 'combat');
                game.currentLocation = 'village';
                game.inCombat = false;
                game.autoCombat = false;
                clearInterval(game.autoAttackInterval);
            }
            
            updateStats();
            updateCombatUI();
        }

        function fleeCombat() {
            if (Math.random() < CONFIG.combat.fleeChance) {
                logMessage('–í–∞–º —É–¥–∞–ª–æ—Å—å —Å–±–µ–∂–∞—Ç—å!', 'combat');
                game.inCombat = false;
                game.autoCombat = false;
                clearInterval(game.autoAttackInterval);
                updateLocation();
            } else {
                logMessage('–í–∞–º –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–±–µ–∂–∞—Ç—å!', 'combat');
                
                // –í—Ä–∞–≥ –∞—Ç–∞–∫—É–µ—Ç
                const enemyDamage = Math.max(1, game.currentEnemy.attack - game.player.defense);
                game.player.hp -= enemyDamage;
                
                logMessage(`${game.currentEnemy.name} –Ω–∞–Ω–æ—Å–∏—Ç –≤–∞–º ${enemyDamage} —É—Ä–æ–Ω–∞.`, 'combat');
                
                if (game.player.hp <= 0) {
                    game.player.hp = 0;
                    logMessage('–í—ã –ø–æ–±–µ–∂–¥–µ–Ω—ã! –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç–µ—Å—å –≤ –¥–µ—Ä–µ–≤–Ω—é.', 'combat');
                    game.currentLocation = 'village';
                    game.inCombat = false;
                    game.autoCombat = false;
                    clearInterval(game.autoAttackInterval);
                }
                
                updateStats();
                updateCombatUI();
            }
        }

        function endCombat(victory) {
            if (victory) {
                const xpGain = 10 + Math.floor(Math.random() * 10);
                game.player.xp += xpGain;
                
                logMessage(`–í—ã –ø–æ–±–µ–¥–∏–ª–∏ ${game.currentEnemy.name} –∏ –ø–æ–ª—É—á–∏–ª–∏ ${xpGain} –æ–ø—ã—Ç–∞.`, 'loot');
                
                // –®–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã
                for (const [resource, chance] of Object.entries(CONFIG.dropRates)) {
                    if (Math.random() < chance) {
                        game.player.resources[resource]++;
                        logMessage(`–í—ã –Ω–∞—à–ª–∏ ${resource === 'hammer' ? '–º–æ–ª–æ—Ç' : resource === 'brand' ? '–∫–ª–µ–π–º–æ' : resource === 'crystal' ? '–∫—Ä–∏—Å—Ç–∞–ª–ª' : '–∑–µ–ª—å–µ'}!`, 'loot');
                    }
                }
                
                checkLevelUp();
            }
            
            game.inCombat = false;
            game.autoCombat = false;
            clearInterval(game.autoAttackInterval);
            updateLocation();
            updateStats();
        }

        function checkLevelUp() {
            if (game.player.xp >= game.player.nextLevelXp) {
                game.player.level++;
                game.player.xp -= game.player.nextLevelXp;
                game.player.nextLevelXp = Math.floor(game.player.nextLevelXp * CONFIG.player.xpMultiplier);
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
                game.player.maxHp += 10;
                game.player.hp = game.player.maxHp;
                game.player.attack += 2;
                game.player.defense += 1;
                
                logMessage(`–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ ${game.player.level} —É—Ä–æ–≤–Ω—è!`, 'info');
                checkLevelUp();
            }
        }

        function returnToVillage() {
            game.currentLocation = 'village';
            game.inCombat = false;
            game.autoCombat = false;
            clearInterval(game.autoAttackInterval);
            updateLocation();
            logMessage('–í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –¥–µ—Ä–µ–≤–Ω—é.', 'info');
        }

        function showBlacksmith() {
            elements.locationActions.innerHTML = `
                <h3>–ö—É–∑–Ω–µ—Ü</h3>
                <p>–ö—É–∑–Ω–µ—Ü –º–æ–∂–µ—Ç —Å–∫—Ä–∞—Ñ—Ç–∏—Ç—å –≤–∞–º –ø—Ä–µ–¥–º–µ—Ç—ã –∑–∞ —Ä–µ—Å—É—Ä—Å—ã.</p>
                <div id="blacksmithOptions"></div>
                <button onclick="updateLocation()">–ù–∞–∑–∞–¥</button>
            `;
            
            const blacksmithOptions = document.getElementById('blacksmithOptions');
            blacksmithOptions.innerHTML = '';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
            for (const [itemId, recipe] of Object.entries(CONFIG.crafting)) {
                const canCraft = Object.entries(recipe).every(([resource, amount]) => {
                    return game.player.resources[resource] >= amount;
                });
                
                const button = document.createElement('button');
                button.textContent = game.items[itemId].name;
                button.disabled = !canCraft;
                button.className = 'small-button';
                
                if (canCraft) {
                    button.onclick = () => craftItem(itemId, recipe);
                }
                
                blacksmithOptions.appendChild(button);
            }
        }

        function craftItem(itemId, recipe) {
            if (game.player.inventory.length >= 9) {
                logMessage('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ–ª–æ–Ω!', 'info');
                return;
            }
            
            // –°–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
            for (const [resource, amount] of Object.entries(recipe)) {
                game.player.resources[resource] -= amount;
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞
            game.player.inventory.push(itemId);
            
            logMessage(`–í—ã —Å–æ–∑–¥–∞–ª–∏ ${game.items[itemId].name}!`, 'loot');
            updateStats();
            showBlacksmith();
        }

        function updateLocation() {
            const location = game.locations.find(loc => loc.id === game.currentLocation);
            
            elements.locationName.textContent = location.name;
            elements.locationDescription.textContent = location.description;
            
            elements.locationActions.innerHTML = '';
            
            if (location.actions.includes('travel')) {
                const travelButton = document.createElement('button');
                travelButton.textContent = '–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ';
                travelButton.onclick = travel;
                elements.locationActions.appendChild(travelButton);
            }
            
            if (location.actions.includes('gather')) {
                const gatherButton = document.createElement('button');
                gatherButton.textContent = location.gatherResource === 'wood' ? '–°–æ–±–∏—Ä–∞—Ç—å –¥–µ—Ä–µ–≤–æ' :
                                         location.gatherResource === 'stone' ? '–î–æ–±—ã–≤–∞—Ç—å –∫–∞–º–µ–Ω—å' :
                                         location.gatherResource === 'ore' ? '–î–æ–±—ã–≤–∞—Ç—å —Ä—É–¥—É' : '–°–æ–±–∏—Ä–∞—Ç—å —É–≥–æ–ª—å';
                gatherButton.onclick = gatherResource;
                elements.locationActions.appendChild(gatherButton);
            }
            
            if (location.actions.includes('return')) {
                const returnButton = document.createElement('button');
                returnButton.textContent = '–í –¥–µ—Ä–µ–≤–Ω—é';
                returnButton.onclick = returnToVillage;
                elements.locationActions.appendChild(returnButton);
            }
            
            if (game.blacksmithAvailable) {
                const blacksmithButton = document.createElement('button');
                blacksmithButton.textContent = '–ö—É–∑–Ω–µ—Ü';
                blacksmithButton.onclick = showBlacksmith;
                elements.locationActions.appendChild(blacksmithButton);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            elements.usePotionButton.onclick = usePotion;
            updateStats();
            updateLocation();
            logMessage('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ RPG Adventure!', 'info');
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        window.onload = initGame;
    </script>
</body>
</html>
