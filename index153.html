<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–æ-–§–æ–Ω–∞—Ä–∏–∫</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        h2 {
            margin-bottom: 15px;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin: 5px 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .flashlight-btn {
            background: linear-gradient(135deg, #ffd89b, #19547b);
        }

        #location-info {
            background: #f7fafc;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            min-height: 60px;
        }

        .loading {
            color: #a0aec0;
            font-style: italic;
        }

        .coordinates {
            font-family: 'Courier New', monospace;
            background: #edf2f7;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }

        .flashlight-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .flashlight-off {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #2d3748;
            border: 4px solid #4a5568;
            transition: all 0.3s ease;
        }

        .flashlight-on {
            background: #faf089;
            border-color: #ecc94b;
            box-shadow: 0 0 50px #faf089, 0 0 100px #faf089;
        }

        .status {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            padding: 8px;
            border-radius: 8px;
            background: #f7fafc;
        }

        #location-history {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .history-item {
            background: #f7fafc;
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            border-left: 3px solid #667eea;
            font-size: 14px;
        }

        .success { color: #38a169; }
        .error { color: #e53e3e; }
        .warning { color: #dd6b20; }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç –ì–µ–æ-–§–æ–Ω–∞—Ä–∏–∫</h1>
        
        <!-- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è -->
        <div class="card">
            <h2>üìç –í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h2>
            <div id="location-info" class="loading">
                –ù–∞–∂–∏–º–∞–π—Ç–µ "–ü–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã"
            </div>
            <button id="get-location" class="btn">üó∫Ô∏è –ü–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</button>
            <button id="watch-location" class="btn">üéØ –°–ª–µ–¥–∏—Ç—å –∑–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º</button>
        </div>

        <!-- –§–æ–Ω–∞—Ä–∏–∫ -->
        <div class="card">
            <h2>üî¶ –§–æ–Ω–∞—Ä–∏–∫</h2>
            <div class="flashlight-container">
                <div id="flashlight" class="flashlight-off"></div>
            </div>
            <button id="toggle-flashlight" class="btn flashlight-btn">‚ö° –í–∫–ª—é—á–∏—Ç—å —Ñ–æ–Ω–∞—Ä–∏–∫</button>
            <div id="flashlight-status" class="status">–§–æ–Ω–∞—Ä–∏–∫ –≤—ã–∫–ª—é—á–µ–Ω</div>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–π -->
        <div class="card">
            <h2>üìù –ò—Å—Ç–æ—Ä–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–π</h2>
            <div id="location-history"></div>
            <button id="clear-history" class="btn secondary">üßπ –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
        </div>
    </div>

    <script>
        class GeoFlashlight {
            constructor() {
                this.flashlightOn = false;
                this.watchId = null;
                this.locationHistory = JSON.parse(localStorage.getItem('locationHistory')) || [];
                
                this.initializeElements();
                this.attachEventListeners();
                this.loadLocationHistory();
            }

            initializeElements() {
                this.locationInfo = document.getElementById('location-info');
                this.getLocationBtn = document.getElementById('get-location');
                this.watchLocationBtn = document.getElementById('watch-location');
                this.toggleFlashlightBtn = document.getElementById('toggle-flashlight');
                this.flashlightElement = document.getElementById('flashlight');
                this.flashlightStatus = document.getElementById('flashlight-status');
                this.locationHistoryElement = document.getElementById('location-history');
                this.clearHistoryBtn = document.getElementById('clear-history');
            }

            attachEventListeners() {
                this.getLocationBtn.addEventListener('click', () => this.getCurrentLocation());
                this.watchLocationBtn.addEventListener('click', () => this.toggleLocationWatch());
                this.toggleFlashlightBtn.addEventListener('click', () => this.toggleFlashlight());
                this.clearHistoryBtn.addEventListener('click', () => this.clearHistory());
            }

            getCurrentLocation() {
                this.updateLocationInfo('‚åõ –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ...', 'warning');
                
                if (!navigator.geolocation) {
                    this.updateLocationInfo('‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º', 'error');
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    position => this.handleLocationSuccess(position),
                    error => this.handleLocationError(error),
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            }

            handleLocationSuccess(position) {
                const { latitude, longitude, accuracy, altitude, heading, speed } = position.coords;
                const timestamp = new Date().toLocaleString();
                
                const locationData = {
                    latitude,
                    longitude,
                    accuracy: accuracy ? `–¢–æ—á–Ω–æ—Å—Ç—å: ${accuracy.toFixed(1)}–º` : '',
                    altitude: altitude ? `–í—ã—Å–æ—Ç–∞: ${altitude.toFixed(1)}–º` : '',
                    heading: heading ? `–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: ${heading}¬∞` : '',
                    speed: speed ? `–°–∫–æ—Ä–æ—Å—Ç—å: ${(speed * 3.6).toFixed(1)} –∫–º/—á` : '',
                    timestamp
                };

                const locationHTML = `
                    <div class="coordinates">
                        <strong>–®–∏—Ä–æ—Ç–∞:</strong> ${latitude.toFixed(6)}<br>
                        <strong>–î–æ–ª–≥–æ—Ç–∞:</strong> ${longitude.toFixed(6)}<br>
                        ${locationData.accuracy ? locationData.accuracy + '<br>' : ''}
                        ${locationData.altitude ? locationData.altitude + '<br>' : ''}
                        ${locationData.heading ? locationData.heading + '<br>' : ''}
                        ${locationData.speed ? locationData.speed + '<br>' : ''}
                        <strong>–í—Ä–µ–º—è:</strong> ${timestamp}
                    </div>
                `;

                this.updateLocationInfo(locationHTML, 'success');
                this.addToHistory(locationData);
            }

            handleLocationError(error) {
                let message = '';
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        message = '‚ùå –î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        message = '‚ùå –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                        break;
                    case error.TIMEOUT:
                        message = '‚ùå –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ';
                        break;
                    default:
                        message = '‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                        break;
                }
                this.updateLocationInfo(message, 'error');
            }

            toggleLocationWatch() {
                if (this.watchId) {
                    navigator.geolocation.clearWatch(this.watchId);
                    this.watchId = null;
                    this.watchLocationBtn.innerHTML = 'üéØ –°–ª–µ–¥–∏—Ç—å –∑–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º';
                    this.updateLocationInfo('üìç –°–ª–µ–∂–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'warning');
                } else {
                    this.watchLocationBtn.innerHTML = '‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ª–µ–∂–µ–Ω–∏–µ';
                    this.updateLocationInfo('üéØ –°–ª–µ–∂–µ–Ω–∏–µ –∑–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º –∞–∫—Ç–∏–≤–Ω–æ...', 'success');
                    
                    this.watchId = navigator.geolocation.watchPosition(
                        position => this.handleLocationSuccess(position),
                        error => this.handleLocationError(error),
                        {
                            enableHighAccuracy: true,
                            timeout: 5000,
                            maximumAge: 0
                        }
                    );
                }
            }

            async toggleFlashlight() {
                try {
                    if (this.flashlightOn) {
                        // –í—ã–∫–ª—é—á–∏—Ç—å —Ñ–æ–Ω–∞—Ä–∏–∫
                        if (this.mediaStream) {
                            this.mediaStream.getTracks().forEach(track => track.stop());
                            this.mediaStream = null;
                        }
                        this.flashlightElement.className = 'flashlight-off';
                        this.flashlightStatus.textContent = '–§–æ–Ω–∞—Ä–∏–∫ –≤—ã–∫–ª—é—á–µ–Ω';
                        this.flashlightStatus.className = 'status';
                        this.toggleFlashlightBtn.innerHTML = '‚ö° –í–∫–ª—é—á–∏—Ç—å —Ñ–æ–Ω–∞—Ä–∏–∫';
                        this.flashlightOn = false;
                    } else {
                        // –í–∫–ª—é—á–∏—Ç—å —Ñ–æ–Ω–∞—Ä–∏–∫
                        this.mediaStream = await navigator.mediaDevices.getUserMedia({
                            video: {
                                facingMode: 'environment',
                                torch: true
                            }
                        });
                        
                        const track = this.mediaStream.getVideoTracks()[0];
                        await track.applyConstraints({
                            advanced: [{ torch: true }]
                        });
                        
                        this.flashlightElement.className = 'flashlight-on';
                        this.flashlightStatus.textContent = 'üî¶ –§–æ–Ω–∞—Ä–∏–∫ –≤–∫–ª—é—á–µ–Ω!';
                        this.flashlightStatus.className = 'status success';
                        this.toggleFlashlightBtn.innerHTML = 'üîå –í—ã–∫–ª—é—á–∏—Ç—å —Ñ–æ–Ω–∞—Ä–∏–∫';
                        this.flashlightOn = true;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Ñ–æ–Ω–∞—Ä–∏–∫–∞:', error);
                    this.flashlightStatus.textContent = '‚ùå –§–æ–Ω–∞—Ä–∏–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∏–ª–∏ –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω';
                    this.flashlightStatus.className = 'status error';
                }
            }

            addToHistory(locationData) {
                this.locationHistory.unshift(locationData);
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é 10 –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –∑–∞–ø–∏—Å—è–º–∏
                if (this.locationHistory.length > 10) {
                    this.locationHistory = this.locationHistory.slice(0, 10);
                }
                localStorage.setItem('locationHistory', JSON.stringify(this.locationHistory));
                this.loadLocationHistory();
            }

            loadLocationHistory() {
                if (this.locationHistory.length === 0) {
                    this.locationHistoryElement.innerHTML = '<div class="loading">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>';
                    return;
                }

                this.locationHistoryElement.innerHTML = this.locationHistory.map((location, index) => `
                    <div class="history-item">
                        <strong>#${index + 1}</strong> - ${location.timestamp}<br>
                        ${location.latitude.toFixed(4)}, ${location.longitude.toFixed(4)}
                    </div>
                `).join('');
            }

            clearHistory() {
                this.locationHistory = [];
                localStorage.removeItem('locationHistory');
                this.loadLocationHistory();
            }

            updateLocationInfo(message, type = '') {
                if (typeof message === 'string') {
                    this.locationInfo.innerHTML = message;
                } else {
                    this.locationInfo.innerHTML = message;
                }
                this.locationInfo.className = type ? `coordinates ${type}` : 'coordinates';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
        document.addEventListener('DOMContentLoaded', () => {
            new GeoFlashlight();
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ API
        window.addEventListener('load', () => {
            if (!navigator.geolocation) {
                alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é!');
            }
            
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ/—Ñ–æ–Ω–∞—Ä–∏–∫—É!');
            }
        });
    </script>
</body>
</html>
